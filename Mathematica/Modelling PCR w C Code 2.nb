(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    340630,       7518]
NotebookOptionsPosition[    331572,       7272]
NotebookOutlinePosition[    334571,       7339]
CellTagsIndexPosition[    334528,       7336]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Overview", "Section",
 CellChangeTimes->{{3.66196115784527*^9, 3.661961160907152*^9}}],

Cell[CellGroupData[{

Cell["Notes", "Subsection",
 CellChangeTimes->{{3.6355146911841974`*^9, 3.6355146916941986`*^9}}],

Cell[TextData[{
 "Change log:\n",
 StyleBox["14-16 March:\tmade ku,kdu non-zero; renamed kah1->konh1, etc to \
match UI and reduce confusion with equilibrium constants. Renamed ", 
  "ItemNumbered"],
 StyleBox[Cell[BoxData[
  FormBox["p1Start", TraditionalForm]], "Item"], "ItemNumbered"],
 StyleBox[" to p1Start, etc, in order to set up for more easily explained \
variable names in custom charts. Avoid re-executing simulation just to change \
rendering options. Show konu etc for clarity & completness. Add units to \
displayed quantities.Implemented custom graphs. Fixed small bug that \
evaporated some t1, t2, p1, and p2 each cycle. Added e + d <-> ed to enzyme \
contention model.\nTo do:\t\tmake sure graph titles always show, as they \
sometimes get clipped", "ItemNumbered"]
}], "Text",
 CellChangeTimes->{{3.6353432365959234`*^9, 3.63534326854478*^9}, {
   3.6353439475238805`*^9, 3.6353439481166816`*^9}, {3.635356578071465*^9, 
   3.635356611143523*^9}, {3.6353582773605576`*^9, 3.635358351741488*^9}, {
   3.6353583890255537`*^9, 3.6353583890255537`*^9}, {3.6353584429650483`*^9, 
   3.6353584430430484`*^9}, {3.6353789039211254`*^9, 
   3.6353789284641595`*^9}, {3.6353802395765357`*^9, 3.635380251798553*^9}, {
   3.6353850306842937`*^9, 3.6353850404353075`*^9}, {3.6354307747340965`*^9, 
   3.635430806318141*^9}, 3.635470046687209*^9, {3.6355146555201473`*^9, 
   3.635514697354206*^9}, {3.6355296508019624`*^9, 3.6355296969670277`*^9}, {
   3.6355299771029243`*^9, 3.635529991783945*^9}, {3.6355381458785353`*^9, 
   3.635538161370557*^9}, {3.6355387359213657`*^9, 3.635538786236436*^9}},
 TextAlignment->Left,
 Background->RGBColor[0.94, 0.91, 0.88]]
}, Closed]],

Cell[CellGroupData[{

Cell["Miscellaneous Utilities", "Subsection",
 CellChangeTimes->{{3.6345770377895007`*^9, 3.6345770388395023`*^9}, {
  3.6348493313534465`*^9, 3.634849334721639*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"makeState", "[", "list_List", "]"}], " ", ":=", " ", 
  "list"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"readState", "[", 
   RowBox[{"state_", ",", " ", "symbol_Symbol"}], "]"}], " ", ":=", " ", 
  RowBox[{"readState", "[", 
   RowBox[{"state", ",", " ", "symbol", ",", " ", "0"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"readState", "[", 
   RowBox[{"state_", ",", " ", "symbol_Symbol", ",", " ", "default_"}], "]"}],
   " ", ":=", " ", 
  RowBox[{"symbol", " ", "/.", " ", 
   RowBox[{"(", 
    RowBox[{"state", " ", "~", "Join", "~", " ", 
     RowBox[{"{", 
      RowBox[{"symbol", " ", "\[Rule]", " ", "default"}], "}"}]}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"preempt", "[", 
   RowBox[{"new_", ",", " ", "old_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"keys", ",", " ", "replacements", ",", " ", "values"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"keys", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"old", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "~", "Join", "~", " ", 
        RowBox[{"new", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "//", " ", "Union"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"replacements", " ", "=", " ", 
      RowBox[{"FilterRules", "[", 
       RowBox[{"new", ",", " ", "keys"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"values", " ", "=", " ", 
      RowBox[{
       RowBox[{"keys", " ", "/.", " ", "replacements"}], " ", "/.", " ", 
       "old"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Rule", " ", "@@", "#"}], "&"}], " ", "/@", " ", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"keys", ",", " ", "values"}], "}"}], "]"}]}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"preempt", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"a", "\[Rule]", "b"}], ",", " ", 
     RowBox[{"e", "\[Rule]", "f"}]}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"a", "\[Rule]", "c"}], ",", " ", 
     RowBox[{"c", "\[Rule]", "d"}]}], "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"readState", "[", 
  RowBox[{
   RowBox[{"makeState", "[", 
    RowBox[{"{", 
     RowBox[{"a", "\[Rule]", " ", "7"}], "}"}], "]"}], ",", " ", "b", ",", 
   " ", "3"}], "]"}]}], "Input",
 CellChangeTimes->{{3.6345770416095057`*^9, 3.6345770867245693`*^9}, {
  3.6345775909082794`*^9, 3.6345775995982914`*^9}, {3.6345777103344483`*^9, 
  3.6345777209574633`*^9}, {3.6346724423876963`*^9, 3.6346725064113584`*^9}, {
  3.6346726854505987`*^9, 3.634672702585579*^9}, {3.6348629106201363`*^9, 
  3.634862924819948*^9}, {3.635103000661501*^9, 3.635103019809596*^9}, {
  3.635130676146448*^9, 3.635130796666342*^9}, {3.6351311334886065`*^9, 
  3.635131138407888*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Chemistry", "Subsection",
 CellChangeTimes->{{3.634849268721864*^9, 3.634849271306012*^9}}],

Cell["\<\
The main point of this section is, given a system of chemical equations, to \
be able to compute the set of differential rate equations that govern that \
system.\
\>", "Text",
 CellChangeTimes->{{3.6348504642652454`*^9, 3.634850510185872*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Notation`AutoLoadNotationPalette", "=", "False"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Needs", "[", "\"\<Notation`\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Notation", "[", 
  RowBox[{
   TemplateBox[{RowBox[{"a_", " ", 
       UnderoverscriptBox[
        TagBox[
         TagBox["\[Equilibrium]", DisplayForm], DisplayForm], "kr_", "kf_"], 
       " ", "b_"}]},
    "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
   TemplateBox[{RowBox[{"TChemicalReaction", "[", 
       RowBox[{
         RowBox[{"TChemicalExpr", "[", "a_", "]"}], ",", 
         RowBox[{"TChemicalExpr", "[", "b_", "]"}], ",", "kf_", ",", " ", 
         "kr_"}], "]"}]},
    "NotationTemplateTag"]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Notation", "[", 
  RowBox[{
   TemplateBox[{RowBox[{"a_", 
       OverscriptBox["\[RightArrow]", "k_"], "b_"}]},
    "NotationTemplateTag"], " ", "\[DoubleLongLeftRightArrow]", " ", 
   TemplateBox[{RowBox[{"TChemicalReaction", "[", 
       RowBox[{
         RowBox[{"TChemicalExpr", "[", "a_", "]"}], ",", 
         RowBox[{"TChemicalExpr", "[", "b_", "]"}], ",", "k_", ",", " ", 
         "0"}], "]"}]},
    "NotationTemplateTag"]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"AddInputAlias", "[", 
  RowBox[{"\"\<rxn\>\"", "\[Rule]", 
   TemplateBox[{OverscriptBox["\[RightArrow]", "\[Placeholder]"]},
    "NotationTemplateTag"]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"AddInputAlias", "[", 
  RowBox[{"\"\<erxn\>\"", "\[Rule]", 
   TemplateBox[{RowBox[{
       UnderoverscriptBox[
        TagBox[
         TagBox["\[Equilibrium]", DisplayForm], DisplayForm], 
        "\[Placeholder]", "\[Placeholder]"], " "}]},
    "NotationTemplateTag"]}], "]"}]}], "Input",
 CellChangeTimes->{{3.6348492985245686`*^9, 3.6348492997236376`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"chemicalReactionQ", "[", "x_", "]"}], " ", ":=", " ", 
   RowBox[{"MatchQ", "[", 
    RowBox[{"x", ",", " ", 
     RowBox[{"TChemicalReaction", "[", 
      RowBox[{"_", ",", "_", ",", "_", ",", "_"}], "]"}]}], "]"}]}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"chemicalSystemPattern", " ", "=", " ", 
    RowBox[{"{", " ", 
     RowBox[{"Repeated", "[", 
      RowBox[{"_", "?", "chemicalReactionQ"}], "]"}], " ", "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"allSpecies", "[", 
   RowBox[{"TChemicalExpr", "[", "e_", "]"}], "]"}], " ", ":=", " ", 
  RowBox[{"Variables", "[", "e", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"allSpecies", "[", 
   RowBox[{"TChemicalReaction", "[", 
    RowBox[{"r_", ",", "p_", ",", " ", "_", ",", " ", "_"}], "]"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{
   RowBox[{"allSpecies", "[", "r", "]"}], " ", "\[Union]", " ", 
   RowBox[{"allSpecies", "[", "p", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"allSpecies", "[", 
     RowBox[{"system", " ", ":", " ", "chemicalSystemPattern"}], "]"}], " ", ":=",
     " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"allSpecies", "[", "#", "]"}], " ", "&"}], " ", "/@", " ", 
       "system"}], " ", "//", " ", "Flatten"}], " ", "//", " ", "Union"}]}], 
   ";"}], " ", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"allParameters", "[", 
   RowBox[{"rxn", ":", "  ", 
    RowBox[{"TChemicalReaction", "[", 
     RowBox[{"r_", ",", "p_", ",", " ", "kf_", ",", " ", "kr_"}], "]"}]}], 
   "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Variables", "[", "kf", "]"}], ",", " ", 
      RowBox[{"Variables", "[", "kr", "]"}]}], "}"}], " ", "//", " ", 
    "Flatten"}], " ", "//", " ", "Union"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"allParameters", "[", 
     RowBox[{"system", " ", ":", " ", "chemicalSystemPattern"}], "]"}], " ", ":=",
     " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"allParameters", "[", "#", "]"}], " ", "&"}], " ", "/@", " ", 
       "system"}], " ", "//", " ", "Flatten"}], " ", "//", " ", "Union"}]}], 
   ";"}], " ", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stochiometry", "[", 
   RowBox[{
    RowBox[{"TChemicalExpr", "[", "expr_", "]"}], ",", " ", "species_"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"Coefficient", "[", 
   RowBox[{"expr", ",", " ", "species"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stochiometry", "[", 
   RowBox[{"e", ":", " ", 
    RowBox[{"TChemicalExpr", "[", "_", "]"}]}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{
     SubscriptBox["\[Nu]", "#"], "\[Rule]", 
     RowBox[{"stochiometry", "[", 
      RowBox[{"e", ",", " ", "#"}], "]"}]}], "&"}], " ", "/@", " ", 
   RowBox[{"allSpecies", "[", "e", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stochiometry", "[", 
   RowBox[{"rxn", ":", "  ", 
    RowBox[{"TChemicalReaction", "[", 
     RowBox[{"r_", ",", "p_", ",", " ", "_", ",", " ", "_"}], "]"}]}], "]"}], 
  " ", ":=", "  ", 
  RowBox[{
   RowBox[{
    RowBox[{
     SubscriptBox["\[Nu]", "#"], "\[Rule]", 
     RowBox[{
      RowBox[{"stochiometry", "[", 
       RowBox[{"p", ",", " ", "#"}], "]"}], "-", 
      RowBox[{"stochiometry", "[", 
       RowBox[{"r", ",", " ", "#"}], "]"}]}]}], " ", "&"}], " ", "/@", " ", 
   RowBox[{"allSpecies", "[", "rxn", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"stochiometry", "[", 
    RowBox[{"system", " ", ":", " ", "chemicalSystemPattern"}], "]"}], " ", ":=",
    " ", 
   RowBox[{
    RowBox[{"Function", "[", 
     RowBox[{
      RowBox[{"{", "species", "}"}], ",", " ", 
      RowBox[{
       SubscriptBox["\[Nu]", "species"], "\[Rule]", " ", 
       RowBox[{"Total", "[", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             SubscriptBox["\[Nu]", "species"], " ", "/.", 
             RowBox[{"stochiometry", "[", "#", "]"}]}], " ", "/.", " ", 
            RowBox[{
             SubscriptBox["\[Nu]", "species"], "\[Rule]", " ", "0"}]}], "&"}],
           "/@", " ", "system"}], ")"}], "]"}]}]}], "]"}], "/@", " ", 
    RowBox[{"allSpecies", "[", "system", "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rate", "[", 
   RowBox[{
    RowBox[{"e", ":", " ", 
     RowBox[{"TChemicalExpr", "[", "_", "]"}]}], ",", " ", "k_"}], "]"}], " ",
   ":=", " ", 
  RowBox[{"k", " ", "*", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Times", " ", "@@", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         SuperscriptBox["#", 
          SubscriptBox["\[Nu]", "#"]], "&"}], "/@", " ", 
        RowBox[{"allSpecies", "[", "e", "]"}]}], ")"}]}], " ", "/.", " ", 
     RowBox[{"stochiometry", "[", "e", "]"}]}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rate", "[", 
    RowBox[{"rxn", " ", ":", " ", 
     RowBox[{"TChemicalReaction", "[", 
      RowBox[{"r_", ",", "p_", ",", " ", "kf_", ",", " ", "kr_"}], "]"}]}], 
    "]"}], " ", ":=", 
   RowBox[{
    RowBox[{"rate", "[", 
     RowBox[{"r", ",", "kf"}], "]"}], " ", "-", " ", 
    RowBox[{"rate", "[", 
     RowBox[{"p", ",", "kr"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rate", "[", 
   RowBox[{
    RowBox[{"rxn", " ", ":", " ", 
     RowBox[{"TChemicalReaction", "[", 
      RowBox[{"_", ",", "_", ",", "_", ",", "_"}], "]"}]}], ",", " ", 
    "species_"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"rate", "[", "rxn", "]"}], " ", "*", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[Nu]", 
       RowBox[{"species", " "}]], "/.", " ", 
      RowBox[{"stochiometry", "[", "rxn", "]"}]}], " ", "/.", " ", 
     RowBox[{
      SubscriptBox["\[Nu]", 
       RowBox[{"species", " "}]], "\[Rule]", " ", "0"}]}], 
    ")"}]}]}]}], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"rateEqns", "[", 
   RowBox[{
    RowBox[{"rxn_", "?", "chemicalReactionQ"}], ",", " ", "t_"}], "]"}], " ", 
  ":=", " ", 
  RowBox[{"rates", "[", 
   RowBox[{
    RowBox[{"{", "rxn", "}"}], ",", " ", "t"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rateEqns", "[", 
   RowBox[{
    RowBox[{"system", " ", ":", " ", "chemicalSystemPattern"}], ",", " ", 
    "t_", ",", " ", "optionsSeq___Rule"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"options", ",", "  ", "systemSpecies", ",", " ", "exprs"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"options", " ", "=", " ", 
      RowBox[{"preempt", "[", 
       RowBox[{
        RowBox[{"{", " ", "optionsSeq", " ", "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"WasteSpecies", " ", "\[Rule]", " ", 
          RowBox[{"{", "}"}]}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"systemSpecies", " ", "=", " ", 
      RowBox[{"allSpecies", "[", "system", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"systemSpecies", " ", "=", " ", 
      RowBox[{"Intersection", "[", 
       RowBox[{"systemSpecies", ",", " ", 
        RowBox[{"Complement", "[", 
         RowBox[{"systemSpecies", ",", " ", 
          RowBox[{"(", 
           RowBox[{"WasteSpecies", " ", "/.", " ", "options"}], ")"}]}], 
         "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", "species", "}"}], ",", " ", 
        RowBox[{
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"species", "[", "t", "]"}], ",", "t"}], "]"}], " ", "==", 
         " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"rate", "[", 
               RowBox[{"#", ",", " ", "species"}], "]"}], "&"}], "/@", " ", 
             "system"}], "]"}], " ", "/.", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"#", " ", "\[Rule]", " ", 
               RowBox[{"#", "[", "t", "]"}]}], "&"}], " ", "/@", " ", 
             "systemSpecies"}], ")"}]}], ")"}]}]}], "]"}], "/@", 
      "systemSpecies"}]}]}], " ", "]"}]}]}], "Input",
 CellChangeTimes->{{3.6348494258278503`*^9, 3.634849432539234*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rateEqns", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"S", "+", " ", "G"}], " ", 
       OverscriptBox["\[RightArrow]", "k"], " ", 
       RowBox[{"P", " ", "+", " ", "W1"}]}], ",", " ", 
      RowBox[{
       RowBox[{"P", " ", "+", " ", "R"}], " ", 
       OverscriptBox["\[RightArrow]", "q"], " ", 
       RowBox[{"F", " ", "+", " ", "W2"}]}]}], "}"}], ",", " ", "\[Tau]", ",",
     " ", 
    RowBox[{"WasteSpecies", "\[Rule]", " ", 
     RowBox[{"{", 
      RowBox[{"W1", ",", " ", "W2"}], "}"}]}]}], "]"}], " ", "//", " ", 
  "TableForm"}]], "Input",
 CellChangeTimes->{{3.6348495618736315`*^9, 3.634849562265654*^9}}],

Cell[BoxData[
 RowBox[{"stochiometry", "[", 
  RowBox[{"{", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"S", "+", " ", "G"}], " ", 
     OverscriptBox["\[RightArrow]", "k"], " ", 
     RowBox[{"P", " ", "+", " ", "W1"}]}], ",", " ", 
    RowBox[{
     RowBox[{"P", " ", "+", " ", "R"}], " ", 
     OverscriptBox["\[RightArrow]", "q"], " ", 
     RowBox[{"F", " ", "+", " ", "W2"}]}], ",", " ", 
    RowBox[{
     RowBox[{"A", " ", "+", " ", "B"}], " ", 
     OverscriptBox["\[RightArrow]", "d"], "C"}]}], "}"}], "]"}]], "Input"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Conversion to C Code", "Section",
 CellChangeTimes->{{3.6617993673337083`*^9, 3.661799377022745*^9}}],

Cell[TextData[{
 "We\[CloseCurlyQuote]re going to be maniupating functions as C code. So we \
bring in ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 "\[CloseCurlyQuote]s parse tree representation for C."
}], "Text",
 CellChangeTimes->{{3.6618784988594427`*^9, 3.661878530312603*^9}}],

Cell[BoxData[
 RowBox[{"Needs", "[", "\"\<SymbolicC`\>\"", "]"}]], "Input"],

Cell[CellGroupData[{

Cell[TextData[{
 "Conversion from ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " to SymbolicC"
}], "Subsection",
 CellChangeTimes->{{3.661799876642108*^9, 3.6617998930403028`*^9}, {
   3.6617999277866354`*^9, 3.6617999307616796`*^9}, 3.661878547700926*^9}],

Cell["\<\
Surprisingly, there\[CloseCurlyQuote]s no built-in conversion from FullForm \
to SymbolicC. So we make our own. At least we have good control over what it\
\[CloseCurlyQuote]s actually doing.\
\>", "Text",
 CellChangeTimes->{{3.661878533048544*^9, 3.6618785635336337`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"note", ":", " ", 
    RowBox[{
    "CExpression", " ", "is", " ", "NOT", " ", "included", " ", "in", " ", 
     "symcQPattern"}]}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", "symcQ", "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"symcQ", "[", "_", "]"}], " ", ":=", " ", "False"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"symcQPattern", " ", "=", " ", 
     RowBox[{"(", 
      RowBox[{
      "_CComment", " ", "|", " ", "_CConstant", " ", "|", " ", 
       "_CParentheses", " ", "\n", "|", " ", "_CAssign", "  ", "|", " ", 
       "_COperator", " ", "|", " ", "_CStandardMathOperator", " ", "|", " ", 
       "_CConditional", "\n", "|", " ", "_CBlock", " ", "|", " ", "_CProgram",
        " ", "|", " ", "_CStatement", "  ", "\n", "|", " ", "_CDo", " ", "|", 
       " ", "_CFor", " ", "|", " ", "_CIf", " ", "|", " ", "_CSwitch", " ", 
       "|", " ", "_CDefault", " ", "|", " ", "_CWhile", "\n", "|", " ", 
       "_CCast", " ", "|", " ", "_CDeclare", " ", "|", " ", "_CEnum", " ", 
       "|", " ", "_CPointerType", " ", "|", " ", "_CStruct", " ", "|", " ", 
       "_CUnion", " ", "|", " ", "_CTypedef", " ", "|", " ", "_CSizeof", "\n",
        "|", " ", "_CFunction", " ", "|", " ", "_CCall", " ", "|", " ", 
       "_CReturn", " ", "|", " ", "_CBreak", " ", "|", " ", "_CContinue", " ",
        "|", " ", "_CGoto", " ", "|", " ", "_CLabel", " ", "\n", "|", " ", 
       "_CMember", " ", "|", " ", "_CPointerMember", " ", "|", " ", 
       "_CAddress", " ", "|", " ", "_CDereference", " ", "|", " ", "_CArray", 
       " ", "\n", "|", " ", "_CInclude", " ", "|", " ", "_CDefine", " ", "|", 
       " ", "_CError", " ", "|", " ", "_CLine", " ", "|", " ", "_CPragma", 
       " ", "|", " ", "_CPreprocessorElif", " ", "|", " ", 
       "_CPreprocessorElse", "\n", "|", " ", "_CPreprocessorEndif", " ", "|", 
       " ", "_CPreprocessorIf", " ", "|", " ", 
       RowBox[{"_", " ", "CPreprocessorIfdef"}], " ", "|", " ", 
       "_CPreprocessorIfndef", " ", "|", " ", "_CPreprocessorUndef"}], 
      ")"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"symcQ", "[", "symcQPattern", "]"}], " ", ":=", " ", "True"}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"freeSymcQ", "[", "expr_", "]"}], " ", ":=", " ", 
     RowBox[{"FreeQ", "[", 
      RowBox[{"expr", ",", " ", "symcQPattern"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"symcQ", "[", "#", "]"}], ",", " ", 
       RowBox[{"freeSymcQ", "[", "#", "]"}]}], "}"}], " ", "&"}], "/@", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"CMember", "[", 
       RowBox[{"a", ",", "b"}], "]"}], ",", " ", 
      RowBox[{"a", " ", "+", " ", "b"}], ",", " ", 
      RowBox[{"a", " ", "+", " ", 
       RowBox[{"CMember", "[", 
        RowBox[{"a", ",", "b"}], "]"}]}]}], " ", "}"}]}]}]}]], "Input",
 CellChangeTimes->{{3.661799932140666*^9, 3.661799932157665*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "cOperatorQ", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cOperatorQ", "[", "_", "]"}], " ", ":=", " ", "False"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cOperatorPattern", " ", "=", " ", 
   RowBox[{"(", 
    RowBox[{
    "_Minus", " ", "|", "_PreDecrement", " ", "|", " ", "_Decrement", " ", 
     "|", " ", "_PreIncrement", " ", "|", " ", "_Increment", " ", 
     "\[IndentingNewLine]", "|", " ", "_Greater", " ", "|", "_Less", " ", "|",
      "_GreaterEqual", "|", "_LessEqual", " ", "|", " ", "_Equal", " ", "|", 
     " ", "_Unequal", "\[IndentingNewLine]", "|", "_Mod", " ", "|", " ", 
     "_Divide", " ", "|", "_Times", "|", "_Subtract", "|", "_Plus", 
     "\[IndentingNewLine]", "|", " ", "_BitShiftLeft", " ", "|", 
     "_BitShiftRight", " ", "|", "_BitAnd", "|", "_BitOr", 
     "\[IndentingNewLine]", "|", "_And", "|", "_Or", "|", "_Not"}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cOperatorQ", "[", "cOperatorPattern", "]"}], " ", ":=", " ", 
   "True"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cOperatorQ", "[", "#", "]"}], "&"}], " ", "/@", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"a", " ", "+", "b"}], ",", " ", 
    RowBox[{"Power", "[", 
     RowBox[{"a", ",", "2"}], "]"}]}], "}"}], " "}]}], "Input",
 CellChangeTimes->{{3.5059456729333696`*^9, 3.5059458122103357`*^9}, {
  3.505945882111334*^9, 3.5059459745736227`*^9}, {3.5059462478102503`*^9, 
  3.505946266625327*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "cstdMathOperatorQ", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cstdMathOperatorQ", "[", "_", "]"}], " ", ":=", " ", "False"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cstdMathOperatorPattern", " ", "=", " ", 
   RowBox[{"(", 
    RowBox[{
    "_ArcCos", " ", "|", " ", "_ArcSin", "|", "_ArcTan", "|", "_Ceiling", 
     "\[IndentingNewLine]", "|", "_Cos", "|", "_Cosh", "|", "_Exp", "|", 
     "_Floor", " ", "|", " ", "_Log", "|", "_Power", "|", "_Sin", "|", 
     "_Sinh", "|", "_Sqrt", "|", "_Tan", "|", "_Tanh"}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cstdMathOperatorQ", "[", "cstdMathOperatorPattern", "]"}], " ", ":=",
    " ", "True"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cstdMathOperatorQ", "[", "#", "]"}], "&"}], " ", "/@", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Sin", "[", "x", "]"}], ",", " ", 
    RowBox[{"a", " ", "+", " ", "b"}]}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.5059460173630695`*^9, 3.505946234203472*^9}, {
  3.505946282560238*^9, 3.5059463206624174`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{
   "compile", ",", " ", "compileFuncParams", ",", " ", "compileFuncParam"}], 
   "]"}], ";", " ", 
  RowBox[{"compileIf", " ", "=", " ", "CIf"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"Power", "[", 
     RowBox[{"a_", ",", 
      RowBox[{"-", "1"}]}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"COperator", "[", 
    RowBox[{"Divide", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"compileExpression", "[", "1", "]"}], ",", 
       RowBox[{"compileExpression", "[", "a", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"Power", "[", 
     RowBox[{"a_", ",", 
      RowBox[{"-", "2"}]}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"COperator", "[", 
    RowBox[{"Divide", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"compileExpression", "[", "1", "]"}], ",", 
       RowBox[{"compileExpression", "[", 
        RowBox[{"square", "[", "a", "]"}], "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"Power", "[", 
     RowBox[{"a_", ",", "2"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"compileExpression", "[", 
    RowBox[{"square", "[", "a", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"Power", "[", 
     RowBox[{"a_", ",", "3"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"compileExpression", "[", 
    RowBox[{"cube", "[", "a", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"Power", "[", 
     RowBox[{"a_", ",", "4"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"compileExpression", "[", 
    RowBox[{"square", "[", 
     RowBox[{"square", "[", "a", "]"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"Times", "[", 
     RowBox[{"a_", ",", " ", 
      RowBox[{"Power", "[", 
       RowBox[{"b_", ",", 
        RowBox[{"-", "1"}]}], "]"}]}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"COperator", "[", 
    RowBox[{"Divide", ",", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"compileExpression", "[", "a", "]"}], ",", " ", 
       RowBox[{"compileExpression", "[", "b", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"compile", "[", 
     RowBox[{"Times", "[", 
      RowBox[{"a_", ",", 
       RowBox[{"Rational", "[", 
        RowBox[{"1", ",", " ", "b_"}], "]"}]}], "]"}], "]"}], " ", ":=", " ", 
    RowBox[{"COperator", "[", 
     RowBox[{"Divide", ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"compileExpression", "[", "a", "]"}], ",", " ", 
        RowBox[{"compileExpression", "[", "b", "]"}]}], "}"}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"Plus", "[", 
     RowBox[{"a_", ",", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"-", "1"}], ",", "b_"}], "]"}]}], "]"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"COperator", "[", 
    RowBox[{"Subtract", ",", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"compileExpression", "[", "a", "]"}], ",", " ", 
       RowBox[{"compileExpression", "[", "b", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"Plus", "[", 
     RowBox[{"a_", ",", 
      RowBox[{"-", "1"}]}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"COperator", "[", 
    RowBox[{"Subtract", ",", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"compileExpression", "[", "a", "]"}], ",", " ", 
       RowBox[{"compileExpression", "[", "1", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"Sqrt", "[", "a_", "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"compileExpression", "[", 
    RowBox[{"sqrt", "[", "a", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"Times", "[", 
     RowBox[{"1", ",", "a_"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"compileExpression", "[", "a", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"compile", "[", 
     RowBox[{"Times", "[", 
      RowBox[{
       RowBox[{"-", "1"}], ",", "a_"}], "]"}], "]"}], " ", ":=", " ", 
    RowBox[{"COperator", "[", 
     RowBox[{"Minus", ",", " ", 
      RowBox[{"{", 
       RowBox[{"compileExpression", "[", "a", "]"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"compile", "[", 
      RowBox[{"Times", "[", 
       RowBox[{"2", ",", "a_"}], "]"}], "]"}], " ", ":=", " ", 
     RowBox[{"compileExpression", "[", 
      RowBox[{"timesTwo", "[", "a", "]"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"compile", "[", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"-", "2"}], ",", "a_"}], "]"}], "]"}], " ", ":=", " ", 
     RowBox[{"compileExpression", "[", 
      RowBox[{"-", 
       RowBox[{"timesTwo", "[", "a", "]"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"compile", "[", 
      RowBox[{"Times", "[", 
       RowBox[{"4", ",", "a_"}], "]"}], "]"}], " ", ":=", " ", 
     RowBox[{"compileExpression", "[", 
      RowBox[{"timesFour", "[", "a", "]"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"compile", "[", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"-", "4"}], ",", "a_"}], "]"}], "]"}], " ", ":=", " ", 
     RowBox[{"compileExpression", "[", 
      RowBox[{"-", 
       RowBox[{"timesFour", "[", "a", "]"}]}], "]"}]}], ";"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"note", " ", "-", " ", 
     RowBox[{"we", " ", 
      RowBox[{"don", "'"}], "t", " ", "yet", " ", "have", " ", "all", " ", 
      RowBox[{"the", " ", "'"}], 
      RowBox[{"compileExpression", "'"}], "s", " ", "that", " ", "we", " ", 
      "need"}]}], ",", " ", "so"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"some", " ", "things", " ", "which", " ", "should", " ", 
     RowBox[{"be", " ", "?"}]}], ":", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"will", " ", "come", " ", "out", " ", "as", " ", "if"}], 
       "..."}], "else"}], "..."}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"Return", "[", "a_", "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"CReturn", "[", 
    RowBox[{"compileExpression", "[", "a", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"CReturn", "[", "a_", "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"CReturn", "[", 
    RowBox[{"compileExpression", "[", "a", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"CAssign", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"CAssign", "[", 
    RowBox[{
     RowBox[{"compile", "[", "a", "]"}], ",", 
     RowBox[{"compileExpression", "[", "b", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"compile", "[", "a_Symbol", "]"}], " ", ":=", " ", 
    RowBox[{"SymbolName", "[", "a", "]"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "helps", " ", "prevent", " ", "symbol", " ", "binding", " ", "problems"}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"a_", "?", "symcQ"}], "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"a", "[", 
     RowBox[{"[", "0", "]"}], "]"}], " ", "@@", " ", 
    RowBox[{"(", 
     RowBox[{"compile", " ", "/@", " ", "a"}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"a_", "?", "cOperatorQ"}], "]"}], " ", ":=", " ", 
   RowBox[{"COperator", "[", 
    RowBox[{
     RowBox[{"a", "[", 
      RowBox[{"[", "0", "]"}], "]"}], ",", " ", 
     RowBox[{"List", "@@", 
      RowBox[{"(", 
       RowBox[{"compile", " ", "/@", " ", "a"}], ")"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"a_", "?", "cstdMathOperatorQ"}], "]"}], " ", ":=", " ", 
   RowBox[{"CStandardMathOperator", "[", 
    RowBox[{
     RowBox[{"a", "[", 
      RowBox[{"[", "0", "]"}], "]"}], ",", " ", 
     RowBox[{"List", "@@", 
      RowBox[{"(", 
       RowBox[{"compile", " ", "/@", " ", "a"}], ")"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"declVar", "[", 
     RowBox[{"type_", ",", "var_"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"CDeclare", "[", 
    RowBox[{"type", ",", " ", 
     RowBox[{"compile", "[", "var", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"declVar", "[", 
     RowBox[{"type_", ",", "var_", ",", "value_"}], "]"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"CDeclare", "[", 
    RowBox[{"type", ",", 
     RowBox[{"CAssign", "[", 
      RowBox[{
       RowBox[{"compile", "[", "var", "]"}], ",", 
       RowBox[{"compileExpression", "[", "value", "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"declFunc", "[", 
     RowBox[{
     "type_", ",", " ", "name_", ",", " ", "params_", ",", " ", 
      "body__List"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"CFunction", "[", 
    RowBox[{"type", ",", " ", "name", ",", " ", 
     RowBox[{"compileFuncParams", "[", "params", "]"}], ",", " ", 
     RowBox[{"compile", " ", "/@", " ", "body"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"declFunc", "[", 
     RowBox[{
     "type_", ",", " ", "name_", ",", " ", "params_", ",", " ", "expr_"}], 
     "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"CFunction", "[", 
    RowBox[{"type", ",", " ", "name", ",", " ", 
     RowBox[{"compileFuncParams", "[", "params", "]"}], ",", 
     RowBox[{"CReturn", "[", 
      RowBox[{"compileExpression", "[", "expr", "]"}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"If", "[", 
     RowBox[{"test_", ",", "truePart_", ",", "falsePart_"}], "]"}], "]"}], 
   " ", ":=", " ", 
   RowBox[{"compileIf", "[", 
    RowBox[{
     RowBox[{"compileExpression", "[", "test", "]"}], ",", " ", 
     RowBox[{"compile", "[", "truePart", "]"}], ",", " ", 
     RowBox[{"compile", "[", "falsePart", "]"}]}], "]"}]}], " ", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"If", "[", 
     RowBox[{"test_", ",", "truePart_"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"CIf", "[", 
    RowBox[{
     RowBox[{"compileExpression", "[", "test", "]"}], ",", " ", 
     RowBox[{"compile", "[", "truePart", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"f_", "[", "params__", "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"CCall", "[", 
    RowBox[{"f", ",", " ", 
     RowBox[{"compileExpression", " ", "/@", 
      RowBox[{"{", " ", "params", " ", "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"a_", "?", "freeSymcQ"}], "]"}], " ", ":=", " ", 
   RowBox[{"CExpression", "[", "a", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", "a__", "]"}], " ", ":=", " ", 
   RowBox[{"compile", " ", "/@", " ", "a"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compileFuncParams", "[", "params_", "]"}], " ", ":=", " ", 
  RowBox[{"compileFuncParam", "/@", "params"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compileFuncParam", "[", 
    RowBox[{"{", 
     RowBox[{"type_", ",", " ", "var_"}], "}"}], "]"}], " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{"type", ",", " ", 
     RowBox[{"compile", "[", "var", "]"}]}], "}"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "the", " ", "first", " ", "param", " ", "in", " ", "these", " ", "next", 
    " ", "few", " ", "deal", " ", "with", " ", "hosted", " ", "results"}], 
   " ", "*)"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"{", 
     RowBox[{"expr__List", ",", "rules_"}], "}"}], "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"compile", "[", 
        RowBox[{"declVar", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<const\>\"", ",", " ", "\"\<double\>\""}], "}"}], ",", 
          " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], " ", "&"}], " ", "/@",
       " ", "rules"}], ")"}], "~", "Join", "~", 
    RowBox[{"{", 
     RowBox[{"compile", " ", "/@", " ", "expr"}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"compile", "[", 
    RowBox[{"{", 
     RowBox[{"expr_", ",", "rules_"}], "}"}], "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"compile", "[", 
        RowBox[{"declVar", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<const\>\"", ",", " ", "\"\<double\>\""}], "}"}], ",", 
          " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], " ", "&"}], " ", "/@",
       " ", "rules"}], ")"}], "~", "Join", "~", 
    RowBox[{"{", 
     RowBox[{"CReturn", "[", 
      RowBox[{"compileExpression", "[", "expr", "]"}], "]"}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"expr_", ",", "rules_"}], "}"}], ",", " ", "xform_"}], "]"}], 
    " ", ":=", " ", 
    RowBox[{"compile", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"xform", "[", "expr", "]"}], ",", "rules"}], "}"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"compileExpression", "[", "expr_", "]"}], " ", ":=", " ", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"compileIf", "=", "CConditional"}], "}"}], ",", " ", 
      RowBox[{"compile", "[", "expr", "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"What", " ", "is", " ", "this", " ", 
    RowBox[{"for", "?"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"postCompile", "[", "compileResult_", "]"}], " ", ":=", " ", 
   RowBox[{"compileResult", " ", "//.", " ", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"COperator", "[", 
       RowBox[{"Subtract", ",", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"COperator", "[", 
           RowBox[{"Subtract", ",", " ", 
            RowBox[{"{", 
             RowBox[{"a_", ",", " ", "b__"}], "}"}]}], "]"}], ",", " ", 
          "c__"}], "}"}]}], "]"}], " ", "\[RuleDelayed]", " ", 
      RowBox[{"COperator", "[", 
       RowBox[{"Subtract", ",", " ", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b", ",", "c"}], "}"}]}], "]"}]}], 
     "\[IndentingNewLine]", "}"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.505942727785917*^9, 3.50594280687444*^9}, {
   3.5059429531758084`*^9, 3.505942963261385*^9}, {3.5059431888402877`*^9, 
   3.505943232529786*^9}, {3.505943290555105*^9, 3.505943316547592*^9}, {
   3.5059447658724885`*^9, 3.505944773153905*^9}, {3.5059448041816797`*^9, 
   3.505944860184883*^9}, {3.505944928160771*^9, 3.505944951070081*^9}, {
   3.5059449817918386`*^9, 3.5059450317866983`*^9}, {3.5059450714579673`*^9, 
   3.5059450954703407`*^9}, {3.5059451417489877`*^9, 3.5059451449131684`*^9}, 
   3.5059451755979233`*^9, {3.5059452516622744`*^9, 3.505945289137418*^9}, {
   3.505945340496355*^9, 3.505945667284046*^9}, {3.5059458192417383`*^9, 
   3.505945847843374*^9}, {3.505946335799283*^9, 3.5059463865921884`*^9}, {
   3.5059464364350395`*^9, 3.505946468052848*^9}, {3.5059465015137615`*^9, 
   3.5059465069940753`*^9}, {3.5059470991099424`*^9, 3.505947222545002*^9}, {
   3.5059473044336863`*^9, 3.505947311339081*^9}, {3.505947346655101*^9, 
   3.505947374649702*^9}, {3.5059474754964705`*^9, 3.5059474879801846`*^9}, {
   3.5059475601933146`*^9, 3.5059476649873085`*^9}, 3.5059477398625913`*^9, {
   3.5059478591554146`*^9, 3.505947871124099*^9}, 3.5059675982694273`*^9, {
   3.5059677356452847`*^9, 3.5059677451648293`*^9}, {3.505967896568489*^9, 
   3.5059679502825613`*^9}, {3.5059679855325775`*^9, 
   3.5059681749364104`*^9}, {3.5059682123905525`*^9, 
   3.5059686780031843`*^9}, {3.5059687229897575`*^9, 3.505968741304805*^9}, {
   3.505968808069624*^9, 3.5059689098764467`*^9}, {3.505969264346721*^9, 
   3.5059693010358195`*^9}, {3.505969381891444*^9, 3.505969444484024*^9}, {
   3.5059694799730544`*^9, 3.5059695139469976`*^9}, {3.5059695735174046`*^9, 
   3.50596957570653*^9}, {3.505969742464068*^9, 3.505969792451927*^9}, {
   3.505969837893526*^9, 3.505969852370354*^9}, 3.50597093278115*^9, {
   3.50600110658573*^9, 3.5060011522263403`*^9}, 3.506001283729862*^9, {
   3.50600131744179*^9, 3.506001328642431*^9}, {3.506001395083231*^9, 
   3.506001505898569*^9}, {3.506001567033066*^9, 3.506001590545411*^9}, {
   3.5060016473266582`*^9, 3.5060016570372143`*^9}, {3.5060018217576356`*^9, 
   3.506001879449935*^9}, {3.5060020698008227`*^9, 3.506002105194847*^9}, {
   3.506002143101015*^9, 3.5060021523555446`*^9}, {3.5060021869705243`*^9, 
   3.5060021916437917`*^9}, {3.5060027020819874`*^9, 3.506002868071481*^9}, {
   3.5060029083887873`*^9, 3.506002927263867*^9}, {3.5060029601247463`*^9, 
   3.5060029833240733`*^9}, {3.506003013360791*^9, 3.5060031078781977`*^9}, 
   3.506003138094926*^9, {3.506003185150617*^9, 3.506003399092854*^9}, {
   3.5060034406202292`*^9, 3.5060034951623487`*^9}, {3.506003813539559*^9, 
   3.5060039332964087`*^9}, {3.5060040689781694`*^9, 3.506004225365114*^9}, {
   3.506004262736252*^9, 3.506004294847088*^9}, {3.5060045064101887`*^9, 
   3.5060045108674436`*^9}, {3.506004566345617*^9, 3.506004597774414*^9}, {
   3.5060046329664273`*^9, 3.50600474246069*^9}, {3.5060047878382854`*^9, 
   3.506004951017619*^9}, {3.5060050650341406`*^9, 3.5060050864053626`*^9}, {
   3.506048788079955*^9, 3.506048788608986*^9}, {3.506049648638177*^9, 
   3.506049652266384*^9}, {3.5060505689208136`*^9, 3.5060506129973345`*^9}, 
   3.5060506516495457`*^9, {3.5060506980512*^9, 3.506050707375733*^9}, {
   3.5060507602347565`*^9, 3.5060507674101667`*^9}, 3.5060508506799297`*^9, {
   3.5063028958415995`*^9, 3.5063029801285467`*^9}, {3.506303166392871*^9, 
   3.506303208169744*^9}, 3.506303243644206*^9, {3.506303281255872*^9, 
   3.5063033698328257`*^9}, 3.5063034024056826`*^9, {3.506303871331914*^9, 
   3.5063038749199204`*^9}, {3.506303914013589*^9, 3.5063039517032547`*^9}, {
   3.506304322080721*^9, 3.5063043943088465`*^9}, 3.5063046385584726`*^9, {
   3.6618862095420923`*^9, 3.661886217781087*^9}, {3.661886358445858*^9, 
   3.6618863649800158`*^9}, {3.6618865692045746`*^9, 
   3.6618865726520324`*^9}, {3.661886665813633*^9, 3.6618866700633645`*^9}, {
   3.661887205875924*^9, 3.661887299550561*^9}, {3.6618902431104736`*^9, 
   3.6618902818357058`*^9}, {3.662407270792843*^9, 3.662407288464387*^9}, {
   3.6624073200320415`*^9, 3.662407340624441*^9}, {3.662407436817973*^9, 
   3.6624074720772896`*^9}, {3.6624078371679335`*^9, 
   3.6624078602846966`*^9}, {3.662408032753974*^9, 3.66240822178251*^9}, {
   3.6624085050620084`*^9, 3.662408508629505*^9}, {3.6624086143409586`*^9, 
   3.6624086169090295`*^9}, {3.6624086693123655`*^9, 3.6624086696776075`*^9}}],

Cell["Some examples", "Text",
 CellChangeTimes->{{3.6618862258885174`*^9, 3.661886230216403*^9}}],

Cell[BoxData[{
 RowBox[{"compile", "[", 
  RowBox[{"If", "[", 
   RowBox[{"a", ",", "b", ",", "c"}], "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"compileExpression", "[", 
  RowBox[{"If", "[", 
   RowBox[{"a", ",", "b", ",", "c"}], "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compile", "[", 
   RowBox[{"declFunc", "[", 
    RowBox[{"int", ",", " ", "factorial", ",", " ", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"int", ",", " ", "n"}], "}"}], "}"}], ",", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"n", "\[Equal]", "0"}], ",", "1", ",", 
       RowBox[{"n", "*", 
        RowBox[{"factorial", "[", 
         RowBox[{"n", "-", "1"}], "]"}]}]}], "]"}]}], "]"}], "]"}], " ", "//",
   "ToCCodeString"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compile", "[", 
   RowBox[{
    RowBox[{"a", " ", "+", " ", "b", " ", "+", " ", "c", "-", " ", 
     RowBox[{"7", "*", 
      RowBox[{"Sin", "[", "d", "]"}]}]}], " ", "\[Equal]", " ", 
    RowBox[{"r", "*", "s"}]}], "]"}], " ", "//", " ", 
  "ToCCodeString"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compile", "[", 
   RowBox[{
    RowBox[{"a", " ", "*", " ", 
     RowBox[{"(", 
      RowBox[{"b", " ", "-", "c"}], ")"}]}], " ", "+", " ", 
    RowBox[{"d", " ", "*", " ", 
     RowBox[{"(", 
      RowBox[{"e", "-", "f"}], ")"}]}]}], "]"}], "  ", "//", " ", 
  "ToCCodeString"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compile", "[", 
   RowBox[{
    RowBox[{"Foo", "[", 
     RowBox[{
      RowBox[{"a", "+", "b"}], ",", 
      RowBox[{"c", "*", "d"}]}], "]"}], " ", "+", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"a", "+", "b"}], ")"}], "^", 
     RowBox[{"(", 
      RowBox[{"1", "/", "2"}], ")"}]}]}], "]"}], " ", "//", " ", 
  "ToCCodeString"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compile", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"a", "+", " ", "b"}], ")"}], " ", "/", " ", "2"}], "]"}], " ", "//",
   " ", "ToCCodeString"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compile", "[", 
   RowBox[{"Power", "[", 
    RowBox[{
     RowBox[{"a", "+", "b"}], ",", "2"}], "]"}], "]"}], " ", "//", " ", 
  "ToCCodeString"}]}], "Input",
 CellChangeTimes->{{3.6618873149941225`*^9, 3.661887331895347*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Common Subexpression Elimination", "Subsection",
 CellChangeTimes->{{3.6618786042431746`*^9, 3.661878610003361*^9}}],

Cell["We define functions to help location common subexpressions.", "Text",
 CellChangeTimes->{{3.6618786172520504`*^9, 3.6618786293980894`*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "strengthReduce", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"strengthReduce", "[", "other_", "]"}], " ", ":=", " ", "other"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"strengthReduce", "[", 
    RowBox[{"a_", "^", "2"}], "]"}], " ", ":=", " ", 
   RowBox[{"a", " ", "*", " ", "a"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"strengthReduce", "[", 
    RowBox[{"a_", "^", "3"}], "]"}], " ", ":=", " ", 
   RowBox[{"a", " ", "*", " ", "a", " ", "*", " ", "a"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"strengthReduce", "[", 
    RowBox[{"Times", "[", 
     RowBox[{"2", ",", "a_"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{"a", " ", "+", " ", "a"}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"strengthReduce", "[", 
     RowBox[{"Times", "[", 
      RowBox[{
       RowBox[{"-", "2"}], ",", "a_"}], "]"}], "]"}], " ", ":=", " ", 
    RowBox[{"-", 
     RowBox[{"(", 
      RowBox[{"a", " ", "+", " ", "a"}], ")"}]}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"strengthReduce", "[", 
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"Rational", "[", 
         RowBox[{"1", ",", " ", 
          RowBox[{"denom_", "?", "NumberQ"}]}], "]"}], ",", " ", "a_"}], 
       "]"}], "]"}], " ", ":=", " ", 
     RowBox[{"a", " ", "/", " ", "denom"}]}], ";"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"strengthReduce", "[", 
      RowBox[{"Rational", "[", 
       RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", ":=", " ", "0.5"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"strengthReduce", "[", 
      RowBox[{"Rational", "[", 
       RowBox[{"1", ",", "4"}], "]"}], "]"}], " ", ":=", " ", "0.25"}], ";"}],
    "  ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"strengthReduce", "[", 
    RowBox[{"Power", "[", 
     RowBox[{"a_", ",", "0.5"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"Sqrt", "[", "a", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"applyStrengthReduction", "[", "expr_", "]"}], " ", ":=", " ", 
    RowBox[{"strengthReduce", "[", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"strengthReduce", "[", "#", "]"}], ")"}], "&"}], ",", " ", 
       "expr", ",", " ", "Infinity"}], "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"strengthReduce", "[", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"a", "+", "b"}], ")"}], "/", "2"}], "]"}]}], "Input",
 CellChangeTimes->{{3.6618789718336315`*^9, 3.6618790144335303`*^9}, {
  3.661880362059594*^9, 3.6618803742798667`*^9}, {3.661880952151309*^9, 
  3.6618809544270043`*^9}, {3.661880986823886*^9, 3.661880990386591*^9}, {
  3.661886721424099*^9, 3.661886883901433*^9}, {3.661887040621716*^9, 
  3.661887126006007*^9}, {3.6618871807581434`*^9, 3.6618871830803223`*^9}}],

Cell["\<\
Returns a list of all the non-atomic subexpressions in the original \
expression. The list is sorted so that smaller subexpressions come first, \
producing a bottom-up search and replacement of the common subexpressions. We \
also remove duplicates from the list.\
\>", "Text",
 CellChangeTimes->{{3.505494742138603*^9, 3.5054947444877377`*^9}, {
  3.505500111404708*^9, 3.505500118854134*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"listSubExprs", "[", "exp_", "]"}], " ", ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "reaped", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"reaped", " ", "=", " ", 
      RowBox[{"Reap", "[", 
       RowBox[{"Scan", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"AtomQ", "[", "#", "]"}]}], ",", 
            RowBox[{"Sow", "[", "#", "]"}]}], "]"}], "&"}], ",", "exp", ",", 
         " ", "Infinity"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"0", "\[Equal]", 
        RowBox[{"Length", "[", 
         RowBox[{"reaped", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Sort", "[", 
        RowBox[{
         RowBox[{"reaped", " ", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"LeafCount", "[", "#1", "]"}], " ", "<", " ", 
           RowBox[{"LeafCount", "[", "#2", "]"}]}], "&"}]}], "]"}]}], 
      "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.5054943966378417`*^9, 3.505494452298025*^9}, {
   3.5055000340542836`*^9, 3.505500103068231*^9}, 3.5055001662448444`*^9, 
   3.5058512652545595`*^9, {3.5058513577268486`*^9, 3.505851441583645*^9}}],

Cell["\<\
Define a function that detects trivial subexpressions that aren\
\[CloseCurlyQuote]t worth hoisting.\
\>", "Text",
 CellChangeTimes->{{3.6618798117316504`*^9, 3.6618798509293137`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "trivialSubExpr", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"trivialSubExpr", "[", "other_", "]"}], " ", ":=", " ", 
  "False"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"trivialSubExpr", "[", "sym_Symbol", "]"}], " ", ":=", " ", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"trivialSubExpr", "[", 
   RowBox[{"Times", "[", 
    RowBox[{
     RowBox[{"-", "1"}], ",", " ", 
     RowBox[{"expr_", "?", "trivialSubExpr"}]}], "]"}], "]"}], " ", ":=", " ",
   "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"trivialSubExpr", "[", "#", "]"}], " ", "&"}], " ", "/@", " ", 
  RowBox[{"{", 
   RowBox[{"a", ",", " ", "b", " ", ",", " ", 
    RowBox[{"a", "+", " ", "b"}], ",", " ", 
    RowBox[{"-", "a"}], ",", " ", 
    RowBox[{"-", " ", 
     RowBox[{"(", 
      RowBox[{"1", "+", "2"}], ")"}]}], ",", " ", 
    RowBox[{"-", "3"}]}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.6618798546319027`*^9, 3.661879882662137*^9}, {
  3.6618799148737745`*^9, 3.6618799579940214`*^9}, {3.661880028020349*^9, 
  3.6618800928615904`*^9}, {3.661880250404454*^9, 3.6618802531002812`*^9}}],

Cell["\<\
The workhorse function. For each subexpression, if the rest of the \
subexpressions contain instances of the subexpression, accumulate a rule \
replacing the subexpression with a variable name (symbol). Note that for \
clarity, no effort is made to avoid symbols with existing values. The result \
is a list of the original expression with variables substituted for the \
common parts, and a list of the replacement rules.\
\>", "Text",
 CellChangeTimes->{{3.5054947158581*^9, 3.505494717567198*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "replaceRepeats", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceRepeats", "[", "expr_", "]"}], " ", ":=", " ", 
   RowBox[{"replaceRepeats", "[", 
    RowBox[{"expr", ",", " ", 
     RowBox[{"listSubExprs", "[", "expr", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceRepeats", "[", 
    RowBox[{"expr_", ",", " ", "subExprsIn_"}], "]"}], " ", ":=", " ", 
   RowBox[{"replaceRepeats", "[", 
    RowBox[{"expr", ",", " ", "subExprsIn", ",", " ", 
     RowBox[{
      RowBox[{"And", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Count", "[", 
          RowBox[{"#1", ",", "#2"}], "]"}], ">", "0"}], ",", " ", 
        RowBox[{"Not", "[", 
         RowBox[{"trivialSubExpr", "[", "#2", "]"}], "]"}]}], "]"}], "&"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceRepeats", "[", 
    RowBox[{"expr_", ",", " ", "subExprsIn_", ",", " ", "useExprFn_"}], "]"}],
    " ", ":=", " ", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tag", ",", " ", "reaped", ",", " ", "result"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tag", " ", "=", " ", "\"\<tag\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"reaped", " ", "=", " ", 
       RowBox[{"Reap", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"vnum", "=", "0"}], ",", " ", 
             RowBox[{"modExpr", "=", "expr"}], ",", " ", 
             RowBox[{"subExprs", " ", "=", " ", "subExprsIn"}], ",", " ", 
             "subExpr", ",", " ", "mapping"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{"subExprs", " ", "\[NotEqual]", " ", 
               RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"subExpr", " ", "=", " ", 
                RowBox[{"First", "[", "subExprs", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"subExprs", " ", "=", " ", 
                RowBox[{"Rest", "[", "subExprs", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"useExprFn", "[", 
                  RowBox[{"subExprs", ",", "subExpr"}], "]"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"mapping", " ", "=", " ", 
                   RowBox[{"subExpr", " ", "\[Rule]", " ", 
                    RowBox[{"Symbol", "[", 
                    RowBox[{"\"\<vv\>\"", "<>", " ", 
                    RowBox[{"IntegerString", "[", 
                    RowBox[{
                    RowBox[{"vnum", "++"}], ",", "10", ",", "3"}], "]"}]}], 
                    "]"}]}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"Sow", "[", 
                   RowBox[{"mapping", ",", " ", "tag"}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"modExpr", " ", "=", " ", 
                   RowBox[{"modExpr", " ", "/.", " ", "mapping"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"subExprs", " ", "=", " ", 
                   RowBox[{
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{"subExprs", ",", " ", "subExpr"}], "]"}], " ", "/.",
                     " ", "mapping"}]}]}]}], "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", "modExpr"}]}], "]"}], ",", " ", 
         "\[IndentingNewLine]", "tag"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"result", " ", "is", " ", "a", " ", "two", " ", "item", " ", 
         RowBox[{"list", ".", " ", "The"}], " ", "first", " ", "a", " ", 
         "substituted", " ", "version", " ", "of", " ", "expr"}], ";", " ", 
        RowBox[{
        "the", " ", "second", " ", "is", " ", "a", " ", "list", " ", "of", 
         " ", "substituion", " ", "rules"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"result", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"reaped", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", ">", " ", "0"}], ",", 
         " ", 
         RowBox[{"Extract", "[", 
          RowBox[{"reaped", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "1", "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "]"}], ",", " ", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"reaped", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"{", "}"}]}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]",
       "result"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5054944923163147`*^9, 3.5054946824871917`*^9}, {
   3.505494765546942*^9, 3.505494782740926*^9}, 3.5058512686757545`*^9, 
   3.505851875307452*^9, {3.661880141677376*^9, 3.661880164240779*^9}, {
   3.6618953276531386`*^9, 3.661895327753426*^9}, {3.6629125318896165`*^9, 
   3.6629125938533115`*^9}, {3.6629126627528543`*^9, 3.662912665867031*^9}, {
   3.6629126965192633`*^9, 3.6629127017801013`*^9}, {3.6629127394454823`*^9, 
   3.662912778837019*^9}, {3.662912875390848*^9, 3.66291291274865*^9}, {
   3.6629129995540905`*^9, 3.6629130413198495`*^9}, {3.6629135824321313`*^9, 
   3.6629135871782084`*^9}, {3.662913621584464*^9, 3.662913713549243*^9}, {
   3.66291378204171*^9, 3.6629137833565283`*^9}}],

Cell["\<\
The result can have unnecessary variables, used in only one place, so this \
function removes them by replacing single-use variables by their definitions. \
\>", "Text",
 CellChangeTimes->{{3.5054948094914556`*^9, 3.5054948140957193`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"foldOneUseVariables", "[", 
   RowBox[{"ceqns", ":", 
    RowBox[{"{", 
     RowBox[{"eqns_", ",", "rules_"}], "}"}]}], "]"}], " ", ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"newRules", ",", " ", "updates"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"newRules", ",", "updates"}], "}"}], " ", "=", " ", 
      RowBox[{"Reap", "[", 
       RowBox[{"Select", "[", 
        RowBox[{"rules", ",", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Count", "[", 
              RowBox[{"ceqns", ",", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "Infinity"}], "]"}], 
             "\[Equal]", "2"}], ",", 
            RowBox[{
             RowBox[{"Sow", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "\[Rule]", 
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", "False"}], ",", 
            "True"}], "]"}], "&"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"eqns", ",", "newRules"}], "}"}], " ", "//.", 
      RowBox[{"Flatten", "[", "updates", "]"}]}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.5054948159448247`*^9, 3.505494986061555*^9}, 
   3.505495043832859*^9, 3.505851286167755*^9}],

Cell["\<\
After folding, rename variables so that they\[CloseCurlyQuote]re sequentially \
numbered. Just for prettyness. Note that these variables use a different \
prefix to avoid mapping collisions. As before, be sure that no variables \
named v00, etc. have values.\
\>", "Text",
 CellChangeTimes->{{3.5054950963408623`*^9, 3.505495098156966*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "renumberVariables", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"renumberVariables", "[", 
   RowBox[{"ceqns", ":", 
    RowBox[{"{", 
     RowBox[{"eqns_", ",", "rules_"}], "}"}]}], "]"}], " ", ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vnum", "=", "0"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"ceqns", "/.", " ", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "\[Rule]", 
         RowBox[{"Symbol", "[", 
          RowBox[{"\"\<v\>\"", " ", "<>", " ", 
           RowBox[{"IntegerString", "[", 
            RowBox[{
             RowBox[{"vnum", "++"}], ",", "10", ",", "3"}], "]"}]}], "]"}]}], 
        "&"}], ",", "rules"}], "]"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.505495100768116*^9, 3.5054951409044113`*^9}, {
  3.6618958645226927`*^9, 3.661895905990121*^9}, {3.661895937927269*^9, 
  3.6618959546535006`*^9}, {3.662911988023326*^9, 3.662912012458849*^9}, {
  3.6629120478400993`*^9, 3.662912053406968*^9}, {3.662912228743433*^9, 
  3.6629122291402783`*^9}}],

Cell["Combining the above into a single function.", "Text",
 CellChangeTimes->{{3.505495151334008*^9, 3.5054951541381683`*^9}, {
   3.5058513119902325`*^9, 3.5058513254770036`*^9}, {3.5058514945386734`*^9, 
   3.505851501869093*^9}, 3.505880638309602*^9}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "hoistCommonSubexpressions", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hoistCommonSubexpressions", "[", "expr_", "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "strengthReduced", ",", " ", "repeatsReplaced", ",", " ", "folded", ",", 
      " ", "renumbered"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"strengthReduced", " ", "=", " ", 
      RowBox[{"applyStrengthReduction", "[", "expr", "]"}]}], ";", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"repeatsReplaced", " ", "=", " ", 
      RowBox[{"replaceRepeats", "[", "strengthReduced", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"folded", " ", "=", " ", 
      RowBox[{"foldOneUseVariables", "[", "repeatsReplaced", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"renumbered", " ", "=", " ", 
      RowBox[{"renumberVariables", "[", "folded", "]"}]}], ";", 
     "\[IndentingNewLine]", "renumbered"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.5054951569713306`*^9, 3.5054952164887342`*^9}, {
  3.5054997863511157`*^9, 3.505499787313171*^9}, {3.5055019580363293`*^9, 
  3.5055019969805565`*^9}, {3.5055051562322555`*^9, 3.505505168737971*^9}, {
  3.5058513067439322`*^9, 3.5058513084630303`*^9}, {3.5058805515206375`*^9, 
  3.505880559764109*^9}, {3.505967643680024*^9, 3.5059676461781673`*^9}, {
  3.5059696953243713`*^9, 3.505969698600559*^9}, {3.6629120615592546`*^9, 
  3.6629120631695466`*^9}, {3.662912113816622*^9, 3.662912259810896*^9}, {
  3.662912459945955*^9, 3.6629124965606213`*^9}, {3.6629132277862053`*^9, 
  3.6629132304275217`*^9}, {3.6629137498024106`*^9, 3.6629137532996407`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Solving Ordinary Differential Equations", "Section",
 CellChangeTimes->{{3.661800514997628*^9, 3.6618005259080086`*^9}}],

Cell[CellGroupData[{

Cell["ODE Structure", "Subsection",
 CellChangeTimes->{{3.6619590438883*^9, 3.661959057124715*^9}, {
  3.661961275532353*^9, 3.6619612764974303`*^9}}],

Cell["Given a set of ODEs, what are the variables therein?", "Text",
 CellChangeTimes->{{3.661959097771591*^9, 3.6619591083015842`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "odeVars", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"odeVars", "[", "eqns_List", "]"}], " ", ":=", " ", 
  RowBox[{"odeVars", " ", "/@", " ", "eqns"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"odeVars", "[", 
   RowBox[{"Equal", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Derivative", "[", "1", "]"}], "[", "var_", "]"}], "[", 
      "time_", "]"}], ",", " ", "right_"}], "]"}], "]"}], " ", ":=", " ", 
  "var"}]}], "Input",
 CellChangeTimes->{{3.661800729552949*^9, 3.661800734927247*^9}, {
  3.6618009776486664`*^9, 3.661801072041297*^9}, {3.6618011314332547`*^9, 
  3.6618011585763674`*^9}, {3.6619590816947007`*^9, 3.6619590819109015`*^9}}],

Cell["And figure out what the parameters are", "Text",
 CellChangeTimes->{{3.6618920739093747`*^9, 3.661892085178896*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "symbolQ", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"symbolQ", "[", "other_", "]"}], " ", ":=", " ", "False"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"symbolQ", "[", "sym_Symbol", "]"}], " ", ":=", " ", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "odeParameters", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"odeParameters", "[", "eqns_List", "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", " ", "findParams"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", " ", "=", " ", 
       RowBox[{"eqns", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"findParams", "[", 
        RowBox[{"Equal", "[", 
         RowBox[{"left_", ",", " ", "right_"}], "]"}], "]"}], " ", ":=", " ", 
       RowBox[{
        RowBox[{"Reap", "[", 
         RowBox[{"Scan", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"symbolQ", "[", "#", "]"}], ",", " ", 
              RowBox[{"Sow", "[", "#", "]"}]}], "]"}], "&"}], ",", "right", 
           ",", " ", "Infinity"}], "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"findParams", "[", "list_List", "]"}], " ", ":=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"findParams", " ", "/@", " ", "list"}], " ", "//", " ", 
         "Flatten"}], " ", "//", " ", "Union"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"findParams", "[", "eqns", "]"}], ",", " ", 
        RowBox[{"{", "time", "}"}]}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6618920897542105`*^9, 3.661892092230076*^9}, {
  3.661892367910474*^9, 3.6618924382102394`*^9}, {3.661892489301881*^9, 
  3.6618927458219185`*^9}, {3.6618927819555864`*^9, 3.66189281887577*^9}, {
  3.661892861170121*^9, 3.6618928686066947`*^9}, {3.661892908372718*^9, 
  3.661893096175883*^9}, {3.6619590915695753`*^9, 3.661959091886061*^9}}],

Cell["Finally, what\[CloseCurlyQuote]s the time variable in use in a set of \
ODEs?", "Text",
 CellChangeTimes->{{3.6619591154373713`*^9, 3.66195912613669*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "odeTime", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"odeTime", "[", "eqns_List", "]"}], " ", ":=", " ", 
  RowBox[{"odeTime", "[", 
   RowBox[{"eqns", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"odeTime", "[", 
   RowBox[{"Equal", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Derivative", "[", "1", "]"}], "[", "var_", "]"}], "[", 
      "time_", "]"}], ",", " ", "right_"}], "]"}], "]"}], " ", ":=", " ", 
  "time"}]}], "Input",
 CellChangeTimes->{{3.661959128358615*^9, 3.6619591699478807`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Numerical ODE Algorithms", "Subsection",
 CellChangeTimes->{{3.6619612849212484`*^9, 3.661961292141858*^9}}],

Cell["\<\
makeF takes a list of ODEs and returns the f[t,y[t]] function as \
conceptualized here: \
https://en.wikipedia.org/wiki/Numerical_methods_for_ordinary_differential_\
equations \
\>", "Text",
 CellChangeTimes->{{3.661806062351057*^9, 3.661806081902686*^9}, {
  3.6618783615433197`*^9, 3.661878365111593*^9}, {3.6618783989012403`*^9, 
  3.661878406602781*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "makeF", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makeF", "[", "eqns_List", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "time", ",", " ", "yy", ",", " ", "vars", ",", " ", "varRules", ",", 
      "  ", "body", ",", " ", "part"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"time", " ", "=", " ", 
      RowBox[{"eqns", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vars", " ", "=", " ", 
      RowBox[{"odeVars", "[", "eqns", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"varRules", "  ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", "time", "]"}], " ", "\[Rule]",
          " ", 
         RowBox[{"part", "[", 
          RowBox[{"yy", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"#", ",", " ", 
             RowBox[{"Range", "[", 
              RowBox[{"1", ",", 
               RowBox[{"Length", "[", "#", "]"}]}], "]"}]}], "}"}], " ", 
           "]"}], "&"}], " ", "[", "vars", "]"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"body", " ", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "/.", " ", "varRules"}], ")"}], 
        "&"}], "/@", " ", "eqns"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Function", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"t", ",", " ", "y"}], "}"}], ",", " ", 
       RowBox[{"body", " ", "/.", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"time", " ", "\[Rule]", " ", "t"}], ",", " ", 
          RowBox[{"yy", " ", "\[Rule]", " ", "y"}], ",", " ", 
          RowBox[{"part", " ", "\[Rule]", " ", "Part"}]}], "}"}]}]}], " ", 
      "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"odes", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"w", "'"}], "[", "t", "]"}], " ", "\[Equal]", " ", 
      RowBox[{"7", " ", 
       RowBox[{"w", "[", "t", "]"}]}]}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"y", "'"}], "[", "t", "]"}], " ", "==", " ", 
      RowBox[{
       RowBox[{"3", "t"}], " ", "+", " ", 
       RowBox[{
        RowBox[{"y", "[", "t", "]"}], " ", 
        RowBox[{"w", "[", "t", "]"}]}]}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeF", "[", "odes", "]"}], " ", "[", 
   RowBox[{"1", ",", 
    RowBox[{"{", 
     RowBox[{
     "x0", ",", " ", "x1", ",", " ", "x2", ",", " ", "x3", ",", " ", "x4", 
      ",", " ", "x5", ",", " ", "x6", ",", " ", "x7"}], "}"}]}], "]"}], " ", "//",
   " ", "ColumnForm"}]}], "Input",
 CellChangeTimes->{{3.6618037264025927`*^9, 3.6618037765676613`*^9}, {
   3.6618038212091727`*^9, 3.661803895107338*^9}, {3.661804021842172*^9, 
   3.6618041408830237`*^9}, {3.6618041740908604`*^9, 3.661804182653293*^9}, {
   3.6618042739245806`*^9, 3.6618042827738037`*^9}, {3.6618045434447603`*^9, 
   3.6618046497280636`*^9}, {3.6618047448744297`*^9, 3.661804750087657*^9}, {
   3.6618048470797863`*^9, 3.6618049787296867`*^9}, {3.661805031943467*^9, 
   3.66180508240617*^9}, {3.6618051618663588`*^9, 3.661805244586915*^9}, {
   3.6618052906673503`*^9, 3.6618053358259144`*^9}, {3.6618053774433985`*^9, 
   3.6618055299731913`*^9}, {3.6618055859298816`*^9, 
   3.6618057261102843`*^9}, {3.6618058014010067`*^9, 3.661805813124778*^9}, {
   3.6618058498730955`*^9, 3.661806048501705*^9}, {3.6618061119733734`*^9, 
   3.6618061153687286`*^9}, 3.6618062759715276`*^9, {3.6619613771513553`*^9, 
   3.661961378370907*^9}}],

Cell["\<\
We look at three different integration methods. See \
http://ww2.odu.edu/~agodunov/computing/programs/cpp/ode01.cpp (and other \
places) for source references\
\>", "Text",
 CellChangeTimes->{{3.661878241312826*^9, 3.6618782953173323`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"euler", "[", 
   RowBox[{"f_", ",", " ", "ti_", ",", " ", "xi_", ",", " ", "tf_"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"xi", " ", "+", " ", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"ti", ",", "xi"}], "]"}], " ", "*", " ", 
    RowBox[{"(", 
     RowBox[{"tf", " ", "-", "ti"}], ")"}]}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"modifiedEuler", "[", 
   RowBox[{"f_", ",", " ", "ti_", ",", " ", "xi_", ",", " ", "tf_"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "xf", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"xf", " ", "=", " ", 
      RowBox[{"xi", " ", "+", " ", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"ti", ",", "xi"}], "]"}], " ", "*", " ", 
        RowBox[{"(", 
         RowBox[{"tf", " ", "-", "ti"}], ")"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"xf", " ", "=", " ", 
      RowBox[{"xi", " ", "+", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"ti", ",", "xi"}], "]"}], "+", 
          RowBox[{"f", "[", 
           RowBox[{"tf", ",", "xf"}], "]"}]}], ")"}], 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"tf", "-", "ti"}], ")"}], " ", "/", "2"}]}]}]}], " ", ";", 
     "\[IndentingNewLine]", "xf"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rungeKutta", "[", 
   RowBox[{"f_", ",", " ", "ti_", ",", " ", "xi_", ",", " ", "tf_"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "xf", ",", " ", "h", ",", " ", "k1", ",", " ", "k2", ",", " ", "k3", ",",
       " ", "k4"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"h", " ", "=", " ", 
      RowBox[{"tf", " ", "-", " ", "ti"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"k1", " ", "=", " ", 
      RowBox[{"h", " ", "*", " ", 
       RowBox[{"f", "[", 
        RowBox[{"ti", ",", " ", "xi"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"k2", " ", "=", " ", 
      RowBox[{"h", " ", "*", " ", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"ti", " ", "+", " ", 
          RowBox[{"h", " ", "/", " ", "2"}]}], ",", " ", 
         RowBox[{"xi", " ", "+", " ", 
          RowBox[{"k1", " ", "/", " ", "2"}]}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k3", " ", "=", " ", 
      RowBox[{"h", " ", "*", " ", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"ti", " ", "+", " ", 
          RowBox[{"h", " ", "/", "2"}]}], ",", " ", 
         RowBox[{"xi", " ", "+", " ", 
          RowBox[{"k2", " ", "/", " ", "2"}]}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"k4", " ", "=", " ", 
      RowBox[{"h", " ", "*", " ", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"ti", " ", "+", " ", "h"}], ",", " ", 
         RowBox[{"xi", " ", "+", " ", "k3"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"xf", " ", "=", " ", 
      RowBox[{"xi", " ", "+", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"k1", " ", "+", " ", 
          RowBox[{"2", " ", "*", " ", 
           RowBox[{"(", 
            RowBox[{"k2", " ", "+", " ", "k3"}], ")"}]}], " ", "+", " ", 
          "k4"}], ")"}], " ", "/", " ", "6"}]}]}], ";", "\[IndentingNewLine]",
      "xf"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.6618061509519205`*^9, 3.6618062076189938`*^9}, {
  3.661806330560679*^9, 3.661806409586624*^9}, {3.6618776827687488`*^9, 
  3.661877817275799*^9}}],

Cell["\<\
Check against http://ww2.odu.edu/~agodunov/computing/programs/cpp/ode01.cpp \
for sanity.\
\>", "Text",
 CellChangeTimes->{{3.6618065484298253`*^9, 3.661806548977784*^9}, {
  3.6618782993901577`*^9, 3.6618783060308075`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"params", "=", 
   RowBox[{"{", " ", 
    RowBox[{
     RowBox[{"makeF", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"y", "'"}], "[", "t", "]"}], " ", "\[Equal]", " ", 
        RowBox[{"-", 
         RowBox[{"y", "[", "t", "]"}]}]}], "}"}], "]"}], ",", " ", "0", ",", 
     " ", 
     RowBox[{"{", "1", "}"}], ",", " ", ".1"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", " ", 
  RowBox[{
   RowBox[{"euler", "@@", "params"}], ",", " ", 
   RowBox[{"modifiedEuler", "@@", "params"}], ",", " ", 
   RowBox[{"rungeKutta", "@@", "params"}]}], " ", "}"}]}], "Input",
 CellChangeTimes->{{3.66180622607414*^9, 3.6618063064250803`*^9}, {
  3.661806415768895*^9, 3.6618064390164723`*^9}, {3.6618064705467615`*^9, 
  3.6618065287520995`*^9}, {3.661877826486311*^9, 3.6618778530951495`*^9}}],

Cell[TextData[{
 "And, key point, we can instead do that ",
 StyleBox["symbolically",
  FontSlant->"Italic"],
 "."
}], "Text",
 CellChangeTimes->{{3.6619614572798433`*^9, 3.661961486008754*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"params", "=", 
   RowBox[{"{", " ", 
    RowBox[{
     RowBox[{"makeF", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"y", "'"}], "[", "t", "]"}], " ", "\[Equal]", " ", 
        RowBox[{"-", 
         RowBox[{"y", "[", "t", "]"}]}]}], "}"}], "]"}], ",", " ", "\[Tau]", 
     ",", " ", 
     RowBox[{"{", "y0", "}"}], ",", " ", 
     RowBox[{"\[Tau]", "+", "\[CapitalDelta]\[Tau]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", " ", 
   RowBox[{
    RowBox[{"euler", "@@", "params"}], ",", " ", 
    RowBox[{"modifiedEuler", "@@", "params"}], ",", " ", 
    RowBox[{"rungeKutta", "@@", "params"}]}], " ", "}"}], " ", "//", " ", 
  "ColumnForm"}]}], "Input",
 CellChangeTimes->{{3.661961433744147*^9, 3.6619614680414953`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Higher Level C Translation", "Subsection",
 CellChangeTimes->{{3.6618864187167096`*^9, 3.6618864230914855`*^9}}],

Cell["\<\
Declare the struct that maintains the state of the ODE system.\
\>", "Text",
 CellChangeTimes->{{3.6618888009968376`*^9, 3.6618888380047464`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"stateTypeName", "  ", "=", " ", 
   RowBox[{"Symbol", "[", "\"\<ODESTATE\>\"", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"paramsTypeName", " ", "=", " ", 
   RowBox[{"Symbol", "[", "\"\<ODEPARAMETERS\>\"", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makeStruct", "[", 
   RowBox[{"structName_", ",", " ", "vars_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", " ", "members", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"members", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"compile", "[", 
         RowBox[{"declVar", "[", 
          RowBox[{
           RowBox[{"{", "\"\<double\>\"", "}"}], ",", " ", "#"}], "]"}], 
         "]"}], " ", "&"}], " ", "/@", " ", "vars"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"CStruct", "[", 
      RowBox[{"structName", ",", "members"}], " ", "]"}]}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.66188769671359*^9, 3.6618877625157127`*^9}, {
   3.6618878199538093`*^9, 3.661887967725935*^9}, 3.661888193717337*^9, {
   3.661888444576751*^9, 3.661888602273717*^9}, {3.66188865203021*^9, 
   3.66188873279782*^9}, {3.661888843166108*^9, 3.661888844620988*^9}, {
   3.661891383108508*^9, 3.6618913860167723`*^9}, {3.6618917011073217`*^9, 
   3.661891712254953*^9}, {3.661893723933483*^9, 3.661893787440119*^9}, {
   3.6618947547244425`*^9, 3.6618947582343917`*^9}, {3.6619136277687263`*^9, 
   3.6619136280852127`*^9}}],

Cell["\<\
Given a system of ODEs and a step algorithm, return the SymbolicC \
representation of the function that computes one step in the numerical \
integration\
\>", "Text",
 CellChangeTimes->{{3.6618894986238565`*^9, 3.661889539043014*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "compileODEStepFunction", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compileODEStepFunction", "[", 
   RowBox[{"funcName_", ",", " ", "odes_", ",", " ", "alg_"}], "]"}], " ", ":=",
   " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "declVar", ",", " ", "declFunc", ",", " ", "state", ",", " ", "params", 
      ",", " ", "result", ",", " ", "t", ",", "dt", ",", " ", 
      RowBox[{"double", "=", "\"\<double\>\""}], " ", ",", " ", 
      RowBox[{"int", "=", "\"\<int\>\""}], ",", " ", 
      RowBox[{"float", "=", "\"\<float\>\""}], ",", " ", 
      RowBox[{"const", "=", "\"\<const\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "using", " ", "the", " ", "Block", " ", "ensures", " ", "that", " ", 
      RowBox[{"we", "'"}], "re", " ", "not", " ", "affected", " ", "by", " ", 
      "outside", " ", "bindings", " ", "for", " ", "key", " ", "symbols"}], 
     " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
       "renames", ",", " ", "stateRefs", ",", " ", "vars", ",", " ", "pp", 
        ",", " ", "algParams", ",", " ", "step", ",", " ", "hoisted", ",", 
        " ", "decls", ",", "declResult", ",", " ", "transposed", ",", " ", 
        "assigns", ",", " ", "return", ",", " ", "body", ",", " ", "func"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "examine", " ", "the", " ", "system", " ", "we", " ", "are", " ", 
        "dealing", " ", "with"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vars", " ", "=", " ", 
        RowBox[{"odeVars", "[", "odes", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"pp", " ", "=", " ", 
        RowBox[{"odeParameters", "[", "odes", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"algParams", " ", "=", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"makeF", "[", "odes", "]"}], ",", " ", "t", ",", " ", 
          "vars", ",", " ", 
          RowBox[{"t", "+", "dt"}]}], " ", "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"step", " ", "=", " ", 
        RowBox[{"alg", " ", "@@", " ", "algParams"}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"renames", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "\[Rule]", 
             RowBox[{"CMember", "[", 
              RowBox[{"state", ",", "#"}], "]"}]}], "  ", "&"}], "/@", " ", 
           "vars"}], ")"}], " ", "~", "Join", "~", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", " ", "\[Rule]", " ", 
             RowBox[{"CMember", "[", 
              RowBox[{"params", ",", "#"}], "]"}]}], "&"}], " ", "/@", " ", 
           "pp"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"hoisted", " ", "=", " ", 
        RowBox[{
         RowBox[{"hoistCommonSubexpressions", "[", "step", "]"}], " ", "/.", 
         " ", "renames"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"decls", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"declVar", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<const\>\"", ",", " ", "double"}], "}"}], ",", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&"}], "/@", " ", 
         RowBox[{"hoisted", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"declResult", " ", "=", " ", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"transposed", " ", "=", " ", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"vars", ",", " ", 
           RowBox[{"hoisted", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"assigns", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"CAssign", "[", 
           RowBox[{
            RowBox[{"CMember", "[", 
             RowBox[{"result", ",", " ", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], " ", "/@", " ", 
         "transposed"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"return", " ", "=", " ", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"body", " ", "=", " ", 
        RowBox[{
        "decls", " ", "~", "Join", "~", "declResult", "~", "Join", "~", " ", 
         "assigns", " ", "~", "Join", "~", " ", "return"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"func", " ", "=", " ", 
        RowBox[{"declFunc", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<__forceinline\>\"", ",", " ", "\"\<void\>\""}], "}"}],
           ",", " ", "\[IndentingNewLine]", "funcName", ",", " ", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<const\>\"", ",", " ", "double"}], "}"}], ",", " ",
               "t"}], "}"}], ",", " ", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<const\>\"", ",", " ", "double"}], "}"}], ",", " ",
               "dt"}], "}"}], " ", ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "\"\<const\>\"", ",", " ", "paramsTypeName", ",", " ", 
                "\"\<&\>\""}], "}"}], ",", " ", "params"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "\"\<const\>\"", ",", " ", "stateTypeName", ",", " ", 
                "\"\<&\>\""}], "}"}], ",", " ", "state"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"stateTypeName", ",", " ", "\"\<&\>\""}], "}"}], ",", 
              " ", "result"}], "}"}]}], "\[IndentingNewLine]", "}"}], ",", 
          " ", "\[IndentingNewLine]", "body"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"compile", "[", "func", "]"}]}]}], "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.6618894956374636`*^9, 3.6618894961545243`*^9}, {
   3.6618895556432295`*^9, 3.6618895740799046`*^9}, {3.6618896465359397`*^9, 
   3.661889732859257*^9}, {3.661889789918743*^9, 3.66188979110653*^9}, {
   3.6618898334822607`*^9, 3.6618898703555174`*^9}, {3.66188994492008*^9, 
   3.6618899858671827`*^9}, {3.661890030925974*^9, 3.6618900564671087`*^9}, {
   3.6618902026113715`*^9, 3.661890219474698*^9}, {3.661890298329172*^9, 
   3.661890675138919*^9}, {3.6618907071607485`*^9, 3.6618907874350305`*^9}, {
   3.661890818560896*^9, 3.661891002177684*^9}, {3.661891092823702*^9, 
   3.6618911464768043`*^9}, {3.661891185695746*^9, 3.661891253790276*^9}, {
   3.6618912875635834`*^9, 3.661891402310809*^9}, {3.6618914333206644`*^9, 
   3.6618914346868725`*^9}, {3.6618917479399147`*^9, 
   3.6618917803315616`*^9}, {3.661891825717898*^9, 3.6618919138841996`*^9}, {
   3.6618919490214434`*^9, 3.6618919843370104`*^9}, {3.6618920256916895`*^9, 
   3.6618920550403585`*^9}, {3.6618938405594745`*^9, 
   3.6618941186117897`*^9}, {3.6618942469439073`*^9, 
   3.6618943836437597`*^9}, {3.6618944204856043`*^9, 3.661894422654088*^9}, {
   3.661894465539751*^9, 3.6618945862548656`*^9}, {3.661894739227299*^9, 
   3.661894741756562*^9}, {3.6618950621029587`*^9, 3.661895076075308*^9}, 
   3.6618951176240873`*^9, 3.6618957377282476`*^9, {3.6624061353178763`*^9, 
   3.6624061399970675`*^9}, {3.6624062384031153`*^9, 
   3.6624064109030533`*^9}, {3.6624064494937673`*^9, 3.6624065625957413`*^9}, 
   3.66240660946291*^9, {3.6624066982126255`*^9, 3.662406703741444*^9}, {
   3.662406836898569*^9, 3.6624068374779596`*^9}, {3.6624069020006866`*^9, 
   3.662406904652478*^9}, {3.6624069439549413`*^9, 3.662407015734256*^9}, {
   3.6624070607103195`*^9, 3.6624070664825826`*^9}, {3.6624071704962325`*^9, 
   3.6624071747596507`*^9}, {3.662407501943751*^9, 3.662407541771073*^9}, {
   3.6624076263343196`*^9, 3.662407629223909*^9}, {3.662407720550531*^9, 
   3.662407788602932*^9}, {3.662407975897913*^9, 3.6624079894507732`*^9}, {
   3.6624084490500383`*^9, 3.662408451252417*^9}, {3.6624085452658587`*^9, 
   3.66240854562661*^9}, {3.662408685093099*^9, 3.6624086907052903`*^9}, {
   3.6624087271129117`*^9, 3.6624087897276707`*^9}, {3.6624088216808224`*^9, 
   3.66240882210847*^9}, 3.6624092068101835`*^9, {3.6624119188119774`*^9, 
   3.6624119338672504`*^9}, 3.6624120865335197`*^9, {3.6629118079712925`*^9, 
   3.6629118119439063`*^9}, {3.6629118597567515`*^9, 3.66291187418456*^9}, {
   3.6629119137590885`*^9, 3.6629119403166723`*^9}, {3.6629124375157824`*^9, 
   3.6629124412499323`*^9}, {3.6629132880357723`*^9, 3.66291329662356*^9}, {
   3.6629133888059263`*^9, 3.662913474834008*^9}, {3.6629137611073704`*^9, 
   3.662913762096547*^9}}],

Cell["Put that all together.", "Text",
 CellChangeTimes->{{3.661894767560822*^9, 3.661894771857452*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"makeNumericalODE", "[", 
   RowBox[{"eqns_", ",", " ", "alg_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"makeStruct", "[", 
       RowBox[{"stateTypeName", ",", " ", 
        RowBox[{"odeVars", "[", "eqns", "]"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"makeStruct", "[", 
       RowBox[{"paramsTypeName", ",", " ", 
        RowBox[{"odeParameters", "[", "eqns", "]"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"compileODEStepFunction", "[", 
       RowBox[{"\"\<odeStep\>\"", ",", " ", "eqns", ",", " ", "alg"}], 
       "]"}]}], "}"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.661894847587551*^9, 3.6618949353717365`*^9}, {
  3.661895005702481*^9, 3.661895007545393*^9}, {3.661895182091064*^9, 
  3.661895183949585*^9}, {3.661895763134291*^9, 3.6618957638519163`*^9}, {
  3.661895984286701*^9, 3.661895986597254*^9}, {3.6618960487197647`*^9, 
  3.6618960497745113`*^9}, {3.6619614992831163`*^9, 3.661961507972214*^9}, {
  3.662230037530935*^9, 3.6622300440344124`*^9}}],

Cell["Let\[CloseCurlyQuote]s look at some tests", "Text",
 CellChangeTimes->{{3.662223648806017*^9, 3.662223651285655*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"chemicalSystem", " ", "=", " ", 
   RowBox[{"{", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"p1", " ", "+", " ", "t1"}], " ", 
      UnderoverscriptBox[
       TagBox[
        TagBox["\[Equilibrium]",
         DisplayForm],
        DisplayForm], "koffh1", "konh1"], " ", "h1"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p2", " ", "+", " ", "t2"}], " ", 
      UnderoverscriptBox[
       TagBox[
        TagBox["\[Equilibrium]",
         DisplayForm],
        DisplayForm], "koffh2", "konh2"], " ", "h2"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t1", " ", "+", " ", "t2"}], " ", 
      UnderoverscriptBox[
       TagBox[
        TagBox["\[Equilibrium]",
         DisplayForm],
        DisplayForm], "koffu", "konu"], " ", "u"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p1", " ", "+", "p2"}], " ", 
      UnderoverscriptBox[
       TagBox[
        TagBox["\[Equilibrium]",
         DisplayForm],
        DisplayForm], "koffd", "kond"], " ", "d"}]}], "\[IndentingNewLine]", 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"odes", " ", "=", " ", 
   RowBox[{"rateEqns", "[", 
    RowBox[{"chemicalSystem", ",", "  ", "\[Tau]", ",", " ", 
     RowBox[{"WasteSpecies", " ", "\[Rule]", " ", 
      RowBox[{"{", "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makeNumericalODE", "[", 
   RowBox[{"odes", ",", " ", "euler"}], "]"}], " ", "//", " ", 
  "ToCCodeString"}]}], "Input",
 CellChangeTimes->{{3.662223655579945*^9, 3.662223716213729*^9}, 
   3.6622298746990643`*^9, {3.6624066249726257`*^9, 3.6624066494781475`*^9}, {
   3.662406768249007*^9, 3.6624067819287834`*^9}, {3.6624068261942296`*^9, 
   3.662406881880638*^9}, {3.6624070454083443`*^9, 3.6624070487492056`*^9}, {
   3.662407589954425*^9, 3.6624076075610256`*^9}, {3.6624076849451704`*^9, 
   3.66240769999279*^9}, {3.6624085573026495`*^9, 3.6624085656401234`*^9}, {
   3.662408698924754*^9, 3.6624086991083436`*^9}, 3.6624157948151283`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compiling to DLLs and Managing Same", "Subsection",
 CellChangeTimes->{{3.6624158896515903`*^9, 3.6624159128430834`*^9}}],

Cell[BoxData[
 RowBox[{"Needs", "[", "\"\<CCompilerDriver`\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.662227865800823*^9, 3.662227888249659*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "odeDllCache", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"odeDllCache", " ", "=", " ", 
   RowBox[{"<|", " ", "|>"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6624129776737127`*^9, 3.6624129802318754`*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{"odeCompileToDll", ",", " ", "odeFindOrCompileDll"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"odeCompileToDll", "[", 
   RowBox[{"odes_", ",", " ", "alg_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "odeStepCode", ",", " ", "buildDirectory", ",", " ", "sourceFileName", 
      ",", " ", "compileOptions", ",", " ", "dllName", ",", " ", "dll", ",", 
      " ", "runODESig", ",", " ", "dllFunc"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "get", " ", "the", " ", "C", " ", "code", " ", "for", " ", "the", " ", 
      "step", " ", "part", " ", "of", " ", "the", " ", "algorithm"}], " ", 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"odeStepCode", " ", "=", " ", 
      RowBox[{
       RowBox[{"makeNumericalODE", "[", 
        RowBox[{"odes", ",", " ", "alg"}], "]"}], " ", "//", " ", 
       "ToCCodeString"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"put", " ", "the", " ", "step", " ", "logic", " ", 
       RowBox[{"in", " ", "'"}], 
       RowBox[{"odeStep", ".", 
        RowBox[{"h", "'"}]}], " ", "and", " ", "get", " ", "the", " ", "name",
        " ", "of", " ", "the", " ", "compileable", " ", "file"}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"buildDirectory", " ", "=", " ", 
      RowBox[{"NotebookDirectory", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"buildDirectory", ",", "\"\<odeStep.h\>\""}], "}"}], "]"}], 
       ",", " ", "odeStepCode", ",", " ", "\"\<Text\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sourceFileName", " ", "=", " ", 
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", 
        RowBox[{"buildDirectory", ",", "\"\<odeSkeleton.cpp\>\""}], "}"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Set", " ", "compile", " ", 
        RowBox[{"options", ".", " ", "dllName"}], " ", "is", " ", "unique", 
        " ", "within", " ", "this", " ", "kernel", " ", "session"}], ",", " ", 
       RowBox[{"but", " ", "might"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"overwrite", " ", "previously"}], "-", 
        RowBox[{"used", " ", "dlls"}]}], ";", " ", 
       RowBox[{
        RowBox[{"that", "'"}], "s", " ", "a", " ", "good", " ", "thing"}]}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"compileOptions", " ", "=", " ", "\"\</TP /MD\>\""}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dllName", " ", "=", " ", 
      RowBox[{"SymbolName", "[", 
       RowBox[{"Unique", "[", "\"\<odeDll\>\"", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "on", " ", "off", " ", "chance", " ", "this", " ", "exists", " ", 
       RowBox[{"(", 
        RowBox[{"from", " ", "previous", " ", 
         RowBox[{"run", "?"}]}], ")"}], " ", "unload"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Quiet", "[", 
      RowBox[{"LibraryUnload", "[", "dllName", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"compile", " ", "it", " ", "all", " ", "up"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"dll", " ", "=", " ", 
      RowBox[{"CreateLibrary", "[", 
       RowBox[{
        RowBox[{"{", "sourceFileName", "}"}], ",", " ", "dllName", ",", " ", 
        RowBox[{
        "\"\<CompileOptions\>\"", " ", "\[Rule]", " ", "compileOptions"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"get", " ", "access", " ", "to", " ", "the", " ", 
        RowBox[{"API", ".", " ", "Parameters"}], " ", 
        RowBox[{"are", ":", " ", "inits"}]}], ",", " ", "params", ",", " ", 
       "duration", ",", " ", 
       RowBox[{"dt", " ", "\[Rule]", " ", "result"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"runODESig", " ", "=", " ", 
      RowBox[{"Sequence", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Real", ",", " ", "1"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"Real", ",", " ", "1"}], "}"}], ",", " ", "Real", ",", " ",
           "Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"Real", ",", " ", "1"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dllFunc", " ", "=", " ", 
      RowBox[{"LibraryFunctionLoad", " ", "@@", 
       RowBox[{"{", 
        RowBox[{"dll", ",", " ", "\"\<runODE\>\"", ",", " ", "runODESig"}], 
        "}"}]}]}], ";", "\[IndentingNewLine]", "dllFunc"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"odeFindOrCompileDll", "[", 
   RowBox[{"odes_", ",", " ", "alg_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"key", ",", " ", "dllFunc"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"key", " ", "=", " ", 
      RowBox[{"Key", "[", 
       RowBox[{"{", 
        RowBox[{"odes", ",", " ", "alg"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dllFunc", " ", "=", " ", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"KeyExistsQ", "[", 
         RowBox[{"odeDllCache", ",", " ", "key"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"odeDllCache", "[", "key", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"dllFunc", " ", "=", " ", 
          RowBox[{"odeCompileToDll", "[", 
           RowBox[{"odes", ",", " ", "alg"}], "]"}]}], ";", " ", 
         RowBox[{
          RowBox[{"odeDllCache", "[", "key", "]"}], " ", "=", " ", 
          "dllFunc"}], ";", " ", "dllFunc"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "dllFunc"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.6624047074888363`*^9, 3.6624048816216564`*^9}, {
   3.66240523180783*^9, 3.662405431075757*^9}, {3.6624055374447203`*^9, 
   3.6624057957268176`*^9}, {3.6624092226776905`*^9, 3.662409224289896*^9}, {
   3.6624092554329586`*^9, 3.662409256308135*^9}, {3.6624093570676317`*^9, 
   3.6624093740448627`*^9}, {3.662409563983722*^9, 3.6624095700856*^9}, {
   3.6624121169118567`*^9, 3.6624121261599483`*^9}, {3.6624121627207937`*^9, 
   3.662412163706201*^9}, {3.662412407906024*^9, 3.6624124862211494`*^9}, 
   3.6624125271511354`*^9, {3.6624126309908304`*^9, 3.6624126616568613`*^9}, {
   3.662412779395316*^9, 3.6624130133781295`*^9}, {3.66241307182517*^9, 
   3.6624130892556725`*^9}, {3.662413141052828*^9, 3.6624132406157403`*^9}, {
   3.662413273951421*^9, 3.6624133307003746`*^9}, {3.6624136413250446`*^9, 
   3.662413643424672*^9}, 3.6624159788117332`*^9, {3.6629098223714266`*^9, 
   3.662909825085814*^9}, {3.6629099483775425`*^9, 3.6629100406426115`*^9}, {
   3.662910084260017*^9, 3.662910204137153*^9}, {3.662910409592716*^9, 
   3.6629104178277073`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "Integration Into ",
 StyleBox["Mathematica",
  FontSlant->"Italic"]
}], "Subsection",
 CellChangeTimes->{{3.6622231042833576`*^9, 3.6622231111941338`*^9}, {
  3.6622232684658613`*^9, 3.662223269742115*^9}, {3.662223300672682*^9, 
  3.662223308032178*^9}}],

Cell["\<\
We define a function that executes an ODE for a certain duration using \
natively compiled code.\
\>", "Text",
 CellChangeTimes->{{3.661957027989596*^9, 3.661957036628562*^9}, {
   3.6619570677790384`*^9, 3.6619570824051275`*^9}, 3.662223100937006*^9, {
   3.6624163507492757`*^9, 3.662416386291812*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "ndRunNative", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ndRunNative", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<Algorithm\>\"", " ", "\[Rule]", " ", "euler"}], ",", " ", 
     RowBox[{"\"\<DllFunc\>\"", " ", "\[Rule]", " ", "Null"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ndRunNative", "[", 
   RowBox[{"diffeqs_", ",", " ", 
    RowBox[{"duration_", "?", "NumberQ"}], ",", "consts_", ",", " ", "inits_",
     ",", "  ", "dllFunc_LibraryFunction"}], "]"}], " ", ":=", " ", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "dt", ",", " ", "initRules", ",", " ", "state", ",", " ", "params", ",", 
      " ", "result", ",", " ", "nSteps"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Run", " ", "this", " ", "ode", " ", "system", " ", "given", " ", "that",
       " ", "we", " ", "have", " ", "a", " ", "compiled", " ", "dll", " ", 
      "function", " ", "for", " ", "its", " ", "evaluation"}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"initRules", "=", " ", 
      RowBox[{"inits", " ", "/.", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"var_", "[", "0", "]"}], "\[Equal]", " ", "value_"}], " ", 
         "\[RuleDelayed]", " ", 
         RowBox[{"(", 
          RowBox[{"var", "\[Rule]", "value"}], ")"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"state", " ", "=", " ", 
      RowBox[{
       RowBox[{"odeVars", "[", "diffeqs", "]"}], " ", "/.", "initRules"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"params", " ", "=", " ", 
      RowBox[{
       RowBox[{"odeParameters", "[", "diffeqs", "]"}], " ", "/.", " ", 
       "consts"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "We", " ", "for", " ", "now", " ", "always", " ", "use", " ", "a", " ", 
       "thousand", " ", "steps", " ", "in", " ", "our", " ", "integration"}], 
      " ", "*)"}], " ", "\[IndentingNewLine]", 
     RowBox[{"nSteps", " ", "=", " ", "1000"}], ";", "\[IndentingNewLine]", 
     RowBox[{"dt", " ", "=", " ", 
      RowBox[{"duration", " ", "/", " ", "nSteps"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Actually", " ", "run", " ", "the", " ", "function"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"result", " ", "=", " ", 
      RowBox[{"dllFunc", "[", 
       RowBox[{
       "state", ",", " ", "params", ",", " ", "duration", ",", " ", "dt"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "result"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ndRunNative", "[", 
    RowBox[{
    "diffeqs_", ",", " ", "duration_", ",", " ", "consts_", ",", " ", 
     "inits_", ",", " ", 
     RowBox[{"options", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dllFuncOpt", "=", 
        RowBox[{"OptionValue", "[", "\"\<DllFunc\>\"", "]"}]}], ",", " ", 
       "dllFunc"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dllFunc", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Null", " ", "\[Equal]", " ", "dllFuncOpt"}], ",", " ", 
         RowBox[{"odeFindOrCompileDll", "[", 
          RowBox[{"diffeqs", ",", " ", 
           RowBox[{"OptionValue", "[", "\"\<Algorithm\>\"", "]"}]}], "]"}], 
         ",", " ", "dllFuncOpt"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ndRunNative", "[", 
       RowBox[{
       "diffeqs", ",", " ", "duration", ",", " ", "consts", ",", " ", "inits",
         ",", " ", "dllFunc"}], "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "These", " ", "next", " ", "couple", " ", "are", " ", "really", " ", 
    "just", " ", "for", " ", "testing"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ndRunNative", "[", 
   RowBox[{"diffeqs_", ",", " ", "duration_", ",", " ", "consts_"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "inits", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"inits", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", "0", "]"}], "\[Equal]", "0"}], "&"}], "/@", " ", 
       RowBox[{"odeVars", "[", "diffeqs", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ndRunNative", "[", 
      RowBox[{
      "diffeqs", ",", " ", "duration", ",", " ", "consts", ",", " ", 
       "inits"}], "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ndRunNative", "[", 
   RowBox[{"diffeqs_", ",", " ", "duration_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "consts", "}"}], ",", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"consts", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", " ", "\[Rule]", " ", "0"}], " ", "&"}], " ", "/@", " ", 
       RowBox[{"odeParameters", "[", "diffeqs", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ndRunNative", "[", 
      RowBox[{"diffeqs", ",", " ", "duration", ",", " ", "consts"}], 
      "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"ndRunNative", "[", 
  RowBox[{"odes", ",", " ", "10"}], "]"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBmIQfSN79fNaz9eOaZbn34PovNhJn0G0/XHWLyB62RXP
3yB63Rw97jogHdPZyA+if0zdrAaifz+MOAuii2QYr4LoMIYZP0H0v7UHfoPo
/a0/NOqB9N/tjFogWnCF3R0QfSYz/S6I/mVf8AbMD1P6AaKfsDixNQDpw1om
IiD6lU6pDIj2v5WmDqKfZ+mag+gDn3Zbg+hlu02dQPS0BCkfMN8wfTWI7vl7
aSuI/nPgxR4QfX33/X0guq3V9zCIFu98/RpEy0xYXFvk9dpxVZRsM4h228zW
AaItAsXAdN4685kgumrh13kgGgB6pZyB
  "]],

Cell[TextData[{
 "Similarly, we define one that does the equivalent thing using ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 "."
}], "Text",
 CellChangeTimes->{{3.6624163903787103`*^9, 3.6624164081788054`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{"ndRun", ",", " ", "ndRunMathematica"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ndRunMathematica", "[", 
   RowBox[{
   "diffeqs_", ",", " ", "duration_", ",", " ", "consts_", ",", " ", 
    "inits_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "vars", ",", " ", "time", ",", " ", "solveFor", ",", " ", "interval", 
      ",", " ", "eqns", ",", " ", "soln", ",", " ", "result"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"vars", " ", "=", " ", 
      RowBox[{"odeVars", "[", "diffeqs", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"time", " ", "=", " ", 
      RowBox[{"odeTime", "[", "diffeqs", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"interval", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"time", ",", " ", "0", ",", " ", "duration"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"solveFor", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", "time", "]"}], " ", "&"}], " ", "/@", " ", 
       "vars"}]}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"eqns", " ", "=", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"diffeqs", " ", "//.", " ", "consts"}], ")"}], " ", "~", 
       "Join", "~", " ", "inits"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"soln", " ", "=", " ", 
      RowBox[{
       RowBox[{"NDSolve", "[", 
        RowBox[{
        "eqns", ",", " ", "solveFor", ",", " ", "interval", ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"AccuracyGoal", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"PrecisionGoal", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"MaxStepFraction", "\[Rule]", ".001"}]}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", " ", "=", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Rule]", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"#", "[", "time", "]"}], " ", "/.", " ", "soln"}], 
             ")"}], " ", "/.", " ", 
            RowBox[{"time", "\[Rule]", "duration"}]}], ")"}]}], "&"}], "/@", 
        " ", "vars"}], ")"}]}], ";", " ", "\[IndentingNewLine]", "result"}]}],
    "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6624138355697503`*^9, 3.6624138373813443`*^9}, {
   3.662414012226626*^9, 3.6624140140800943`*^9}, {3.6624142144682827`*^9, 
   3.662414230083404*^9}, {3.662415770512509*^9, 3.6624157736636925`*^9}, 
   3.662416173176602*^9, {3.6624162708408732`*^9, 3.6624162750547895`*^9}, 
   3.662416331652009*^9, {3.6629112077803707`*^9, 3.662911269166721*^9}, {
   3.6629113171341996`*^9, 3.662911345153755*^9}}],

Cell["We pick one or the other for use in the below", "Text",
 CellChangeTimes->{{3.662416334803604*^9, 3.66241634474796*^9}}],

Cell[BoxData[
 RowBox[{"ndRun", " ", ":=", " ", "ndRunMathematica"}]], "Input"],

Cell[TextData[{
 "Notes for future: (1) inits format is optimized for ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " usage, not native (2) we could life out odeVars and odeParams to avoid \
reuse."
}], "Text",
 CellChangeTimes->{{3.6624164132186575`*^9, 3.662416474018343*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Tests", "Subsection",
 CellChangeTimes->{{3.6629108016216354`*^9, 3.662910802108914*^9}}],

Cell[BoxData[{
 RowBox[{"odes", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"y", "'"}], "[", "t", "]"}], " ", "\[Equal]", " ", 
    RowBox[{
     RowBox[{"a", " ", 
      RowBox[{"Sin", "[", "t", "]"}]}], " ", "-", " ", 
     RowBox[{"y", "[", "t", "]"}]}]}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"{", " ", 
  RowBox[{
   RowBox[{"odeVars", "[", "odes", "]"}], ",", " ", 
   RowBox[{"odeParameters", "[", "odes", "]"}], ",", " ", 
   RowBox[{"odeTime", "[", "odes", "]"}]}], " ", "}"}], "\[IndentingNewLine]", 
 RowBox[{"inits", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"y", "[", "0", "]"}], " ", "\[Equal]", " ", "0"}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"duration", " ", "=", " ", "10."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"closed", " ", "=", " ", 
  RowBox[{
   RowBox[{"DSolve", "[", 
    RowBox[{
     RowBox[{"odes", " ", "~", "Join", "~", " ", "inits"}], ",", " ", 
     RowBox[{"y", "[", "t", "]"}], ",", "t"}], "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"paramters", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{"a", " ", "\[Rule]", " ", "17"}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"y", "[", "t", "]"}], " ", "/.", " ", "closed"}], " ", "/.", " ", 
    RowBox[{"t", " ", "\[Rule]", " ", "duration"}]}], " ", "/.", " ", 
   "paramters"}], " ", "//", " ", "N"}], "\[IndentingNewLine]", 
 RowBox[{"ndRunMathematica", "[", 
  RowBox[{
  "odes", ",", " ", "duration", ",", " ", "paramters", ",", " ", "inits"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makeNumericalODE", "[", 
   RowBox[{"odes", ",", " ", "euler"}], "]"}], " ", "//", " ", 
  "ToCCodeString"}]}], "Input",
 CellChangeTimes->{{3.662910808748014*^9, 3.662910855744071*^9}, {
   3.662910971399027*^9, 3.662911171478445*^9}, 3.6629112020691795`*^9, {
   3.6629113518130555`*^9, 3.6629113606073437`*^9}, {3.662911481714881*^9, 
   3.6629114857939053`*^9}, {3.662911675554827*^9, 3.662911676834227*^9}, 
   3.6629117126215744`*^9, {3.6629117620999036`*^9, 3.662911766446492*^9}, {
   3.662911821149024*^9, 3.662911824332428*^9}, {3.662913806739727*^9, 
   3.6629138100027776`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Code for the Model", "Section",
 CellChangeTimes->{{3.6348397084940505`*^9, 3.6348397089180746`*^9}, {
   3.63486890578404*^9, 3.6348689079761653`*^9}, 3.661961146729192*^9}],

Cell[CellGroupData[{

Cell["Constants", "Subsection",
 CellChangeTimes->{{3.6344352200038705`*^9, 3.634435220931924*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"constants", " ", "=", " ", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"initial", " ", "concentrations"}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"p1Start", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", 
       RowBox[{"-", "6"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"p2Start", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", 
       RowBox[{"-", "6"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"eStart", " ", "\[Rule]", "2.4*^-7"}], ",", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"polymerase", " ", "enzyme"}], ",", " ", 
       RowBox[{"value", " ", "subject", " ", "to", " ", "confirmation"}]}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"equilibrium", " ", "disassociation", " ", "constants"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"kh1", " ", "\[Rule]", " ", 
      RowBox[{"koffh1", " ", "/", " ", "konh1"}]}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"kh2", " ", "\[Rule]", 
      RowBox[{"koffh2", " ", "/", " ", "konh2"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"ku", " ", "\[Rule]", " ", "1.5096*^-54"}], ",", " ", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"different", " ", "from", " ", "Gevertz"}], ",", " ", 
       RowBox[{"who", " ", "had", " ", 
        RowBox[{"zero", ".", " ", "This"}], " ", "is", " ", "ballpark", " ", 
        "from", " ", 
        RowBox[{"Nupack", " ", "@", "72"}], "deg", " ", "for", " ", "a", " ", 
        "random", " ", "200", "mer"}], ",", " ", 
       RowBox[{"\[CapitalDelta]G", "\[Equal]", 
        RowBox[{
         RowBox[{"-", "85.00"}], " ", 
         RowBox[{"kcal", "/", "mol"}]}]}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"kd", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", 
       RowBox[{"-", "2"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"on", " ", "and", " ", "off", " ", "reaction", " ", "rates"}], 
      " ", "*)"}], " ", "\[IndentingNewLine]", 
     RowBox[{"konh1", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", "6"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"konh2", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", "6"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"konu", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", "6"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"kond", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", "6"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"koffh1", " ", "\[Rule]", " ", "5.5531*^-7"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"koffh2", " ", "\[Rule]", " ", "8.1493*^-5"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"koffu", " ", "\[Rule]", " ", 
      RowBox[{"ku", " ", "*", " ", "konu"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"koffd", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", "4"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Michaelis", " ", "Menton", " ", "parameters"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"km", "\[Rule]", " ", "1.5*^-9"}], ",", "\[IndentingNewLine]", 
     RowBox[{"kcat", "\[Rule]", " ", "0.17"}], ",", "\[IndentingNewLine]", 
     RowBox[{"kcat1", " ", "\[Rule]", " ", "kcat"}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"kon1", " ", "\[Rule]", " ", 
      RowBox[{"polymeraseEfficiency", " ", "*", " ", 
       RowBox[{"(", 
        RowBox[{"kcat1", " ", "*", " ", "konScale"}], ")"}]}]}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"koff1", " ", "\[Rule]", 
      RowBox[{"polymeraseEfficiency", " ", "*", " ", 
       RowBox[{"(", 
        RowBox[{"kcat1", " ", "*", "koffScale"}], ")"}]}]}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"polymeraseEfficiency", " ", "\[Rule]", " ", "1"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox["koff", "0"], "\[Rule]", " ", 
      RowBox[{"koffScale", " ", "*", " ", "kcat"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"konScale", " ", "\[Rule]", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["koff", "0"], "+", " ", "kcat"}], ")"}], " ", "/", " ", 
       RowBox[{"(", 
        RowBox[{"kcat", " ", "*", " ", "km"}], ")"}]}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"koffScale", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", 
       RowBox[{"-", "4"}]}]}], ",", " ", 
     RowBox[{"(*", " ", 
      RowBox[{"picked", " ", "pretty", " ", "arbitrarily"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"kcat2", " ", "\[Rule]", " ", "kcat1"}], ",", " ", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"we", "'"}], "ll", " ", "keep", " ", "all", " ", "the", " ", 
        RowBox[{"kcat", "'"}], "s", " ", "the", " ", "same"}], ",", " ", 
       RowBox[{"for", " ", "now"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"kon2", " ", "\[Rule]", " ", "kon1"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"koff2", " ", "\[Rule]", " ", "koff1"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Polymerase", " ", "competition", " ", 
       RowBox[{"control", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"kon3", " ", "\[Rule]", " ", "0"}], ",", " ", 
     RowBox[{"kon4", " ", "\[Rule]", " ", "0"}], ",", "\[IndentingNewLine]", 
     RowBox[{"koff3", " ", "\[Rule]", " ", "0"}], ",", 
     RowBox[{"koff4", " ", "\[Rule]", " ", "0"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Duration", " ", "of", " ", "cycle", " ", "phases"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Tau]den", " ", "\[Rule]", " ", "5"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Tau]ann", " ", "\[Rule]", " ", "20"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Tau]ext", " ", "\[Rule]", " ", "15"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Polymerase", " ", "degredation", " ", "during", " ", "denaturing", " ",
        "phase"}], " ", "*)"}], " ", "\[IndentingNewLine]", 
     RowBox[{"kdeg", "\[Rule]", " ", "1.9*^-4"}], ",", 
     RowBox[{"(*", " ", 
      RowBox[{
      "controls", " ", "degredation", " ", "of", " ", "polymerase", " ", 
       RowBox[{"in", " ", "'"}], 
       RowBox[{"eqn26", "'"}], " ", "case"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"enzymeDegredation", " ", "\[Rule]", " ", "eqn26"}], " ", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"an", " ", "algorithm", " ", 
        RowBox[{"selector", ":", " ", "none"}]}], ",", " ", "eqn26", ",", " ", 
       RowBox[{"or", " ", "eqn27"}]}], "*)"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "Miscellaneous", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"polymeraseAnnealEfficiency", " ", "\[Rule]", " ", "0.9"}]}], 
    " ", 
    RowBox[{"(*", " ", 
     RowBox[{"how", " ", "good", " ", "is", " ", 
      RowBox[{"poly", "'"}], "ase", " ", "in", " ", "anneal", " ", "phase", 
      " ", "vs", " ", "extension", " ", "phase"}], "*)"}], 
    "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"state0", "[", "]"}], " ", ":=", " ", 
  RowBox[{"state0", "[", 
   RowBox[{
    RowBox[{"10", "^", 
     RowBox[{"-", "12"}]}], ",", " ", "constants"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"state0", "[", 
   RowBox[{"tStart_", ",", " ", "constants_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"makeState", " ", "@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"p1", " ", "\[Rule]", " ", "p1Start"}], ",", " ", 
        RowBox[{"p2", " ", "\[Rule]", " ", "p2Start"}], ",", " ", 
        RowBox[{"t1", " ", "\[Rule]", " ", "tStart"}], ",", " ", 
        RowBox[{"t2", " ", "\[Rule]", " ", "tStart"}], ",", " ", 
        RowBox[{"t1Start", "\[Rule]", " ", "tStart"}], ",", " ", 
        RowBox[{"t2Start", "\[Rule]", " ", "tStart"}], ",", " ", 
        RowBox[{"e", " ", "\[Rule]", " ", "eStart"}]}], " ", "}"}], " ", "//.",
       " ", "constants"}], ")"}]}], " ", "//", " ", 
   "N"}]}], "\[IndentingNewLine]", 
 RowBox[{"state0", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", "  ", 
     RowBox[{"t1", ",", " ", "t2", ",", "  ", "kh1", ",", " ", "ku", ",", " ", 
      RowBox[{"koffu", "/", "konu"}], ",", " ", "koffu", ",", " ", "konu"}], 
     " ", "}"}], " ", "//.", " ", 
    RowBox[{"state0", "[", "]"}]}], " ", "//.", " ", "constants"}], "//", " ",
   "N"}]}], "Input",
 CellChangeTimes->{{3.634435222143993*^9, 3.634435225780201*^9}, {
   3.6344355326827545`*^9, 3.6344358431055098`*^9}, {3.6344374258620386`*^9, 
   3.63443754513286*^9}, {3.6344376444285393`*^9, 3.634437665132724*^9}, {
   3.6344381175706015`*^9, 3.634438134160551*^9}, {3.634439339697503*^9, 
   3.6344393424166594`*^9}, {3.634439433712881*^9, 3.634439434448923*^9}, {
   3.6344394744162087`*^9, 3.634439479992528*^9}, 3.6344395111443095`*^9, {
   3.634482914057667*^9, 3.6344829197676744`*^9}, {3.6344898161093497`*^9, 
   3.6344898169893513`*^9}, {3.6344906260015326`*^9, 3.634490674926601*^9}, {
   3.634494723657215*^9, 3.6344947237272153`*^9}, {3.634494808954336*^9, 
   3.6344948091443367`*^9}, {3.6344950830337214`*^9, 3.634495083403722*^9}, {
   3.634495138009799*^9, 3.634495138109799*^9}, 3.63449518873687*^9, {
   3.634495631348048*^9, 3.6344956867351265`*^9}, {3.634495791056273*^9, 
   3.634495820140314*^9}, {3.6344959118544436`*^9, 3.6344959118944435`*^9}, 
   3.6345000069733047`*^9, {3.6345002117895937`*^9, 3.6345002183706026`*^9}, {
   3.634500267358672*^9, 3.634500267549672*^9}, 3.634500593147131*^9, 
   3.6345006265411787`*^9, {3.6345007787773924`*^9, 3.634500782718398*^9}, {
   3.6345009334866104`*^9, 3.634500933586611*^9}, 3.6345010506927757`*^9, 
   3.6345014170313015`*^9, {3.6345026937911277`*^9, 3.63450273827619*^9}, {
   3.6345031060047073`*^9, 3.6345031074747095`*^9}, 3.6345041252103586`*^9, {
   3.6345087939830613`*^9, 3.634508847383116*^9}, {3.634577112727606*^9, 
   3.6345771143686085`*^9}, 3.6346622554316564`*^9, {3.6346623070209465`*^9, 
   3.63466231436856*^9}, {3.6346623489070206`*^9, 3.634662353150228*^9}, {
   3.6346624149897366`*^9, 3.6346624224465494`*^9}, 3.63466245659801*^9, {
   3.63466267289239*^9, 3.6346626729703903`*^9}, 3.6346628680985327`*^9, {
   3.6346629271456366`*^9, 3.634662927317237*^9}, 3.6346629622144985`*^9, 
   3.634663046517046*^9, {3.634663179975281*^9, 3.6346631822372847`*^9}, {
   3.634667777166379*^9, 3.6346677985966053`*^9}, {3.6346744729588385`*^9, 
   3.6346745029255524`*^9}, {3.6346943511758075`*^9, 3.634694356307101*^9}, {
   3.634694684862893*^9, 3.634694712334464*^9}, {3.6346948426399174`*^9, 
   3.6346948452230654`*^9}, {3.634696096182616*^9, 3.634696100078839*^9}, {
   3.6348345565243745`*^9, 3.634834594316536*^9}, {3.634840502394459*^9, 
   3.6348405024984646`*^9}, {3.6348517553870935`*^9, 
   3.6348518156195383`*^9}, {3.634853297921321*^9, 3.634853324352833*^9}, {
   3.634853739813596*^9, 3.634853740877657*^9}, {3.6348538159579515`*^9, 
   3.63485384094038*^9}, {3.6348539524847603`*^9, 3.6348539562199736`*^9}, {
   3.6348540030526524`*^9, 3.6348540222037477`*^9}, {3.6348541789307117`*^9, 
   3.6348542689068584`*^9}, 3.6348611877135916`*^9, {3.634861230129018*^9, 
   3.634861243161763*^9}, {3.634861347696742*^9, 3.634861375008304*^9}, 
   3.6348614065361075`*^9, {3.6348614609842215`*^9, 3.634861469822727*^9}, {
   3.634861505031741*^9, 3.6348615639241095`*^9}, {3.634865634914957*^9, 
   3.6348656442874928`*^9}, {3.634865736143747*^9, 3.6348659868960896`*^9}, {
   3.6348671291724234`*^9, 3.6348671373038883`*^9}, {3.6348685191979284`*^9, 
   3.6348685427902775`*^9}, {3.6350159134777303`*^9, 3.635015922799743*^9}, {
   3.6350207602601385`*^9, 3.6350207645911446`*^9}, {3.635027870670311*^9, 
   3.6350279019210987`*^9}, {3.6350279947054057`*^9, 3.63502799548145*^9}, {
   3.6350281779998894`*^9, 3.6350281852393036`*^9}, {3.635096336534335*^9, 
   3.635096370806295*^9}, 3.635097805292343*^9, {3.63510229361306*^9, 
   3.635102328981083*^9}, {3.6351311685596123`*^9, 3.635131240733741*^9}, 
   3.635131845260318*^9, 3.6351319097710075`*^9, {3.6351319406357727`*^9, 
   3.6351319421878614`*^9}, {3.635188083212527*^9, 3.6351881426249247`*^9}, {
   3.6352643172198625`*^9, 3.63526432784247*^9}, {3.635264518721388*^9, 
   3.6352645807529354`*^9}, {3.635264633335943*^9, 3.635264672024156*^9}, {
   3.635264791791006*^9, 3.6352648151913447`*^9}, {3.6352654337147226`*^9, 
   3.6352654427862415`*^9}, {3.635265482138492*^9, 3.6352654962663*^9}, {
   3.6353430211983447`*^9, 3.635343053178401*^9}, {3.635343091524268*^9, 
   3.635343191699044*^9}, {3.6353433470129175`*^9, 3.635343382253379*^9}, {
   3.63534351308471*^9, 3.6353435267286353`*^9}, {3.635343692681833*^9, 
   3.635343718749479*^9}, {3.6353437694807677`*^9, 3.6353437738799753`*^9}, {
   3.6353438119128428`*^9, 3.6353438133012447`*^9}, 3.6353438437524986`*^9, {
   3.635356621501941*^9, 3.6353566539499984`*^9}, {3.635356685618054*^9, 
   3.6353567176293097`*^9}, {3.6353567731040077`*^9, 
   3.6353568508409443`*^9}, {3.635356916159259*^9, 3.635357267987677*^9}, {
   3.6353583686987176`*^9, 3.6353584646026864`*^9}, {3.635358510436567*^9, 
   3.6353585263173947`*^9}, {3.635358587126302*^9, 3.63535859745352*^9}, {
   3.635537128217101*^9, 3.6355371378181148`*^9}, {3.6355468346851406`*^9, 
   3.635546850267163*^9}}],

Cell[BoxData[
 RowBox[{"stateVariables", " ", "=", " ", "\[IndentingNewLine]", 
  RowBox[{"{", "\[IndentingNewLine]", 
   RowBox[{
   "p1", ",", " ", "p2", ",", " ", "h1", ",", " ", "h2", ",", " ", "t1", ",", 
    " ", "t2", ",", " ", "d", ",", " ", "u", ",", " ", "e", ",", " ", "eu", 
    ",", " ", "ed", ",", " ", "eh1", ",", " ", "eh2"}], "\[IndentingNewLine]",
    "}"}]}]], "Input",
 CellChangeTimes->{{3.635188245888831*^9, 3.635188285327087*^9}, {
  3.6355371548766394`*^9, 3.6355371552816396`*^9}, {3.635537186561184*^9, 
  3.6355371895411882`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Annealing Model", "Subsection",
 CellChangeTimes->{{3.634862344829775*^9, 3.634862346701882*^9}}],

Cell[CellGroupData[{

Cell["Equilibrium Annealing Model", "Subsubsection",
 CellChangeTimes->{{3.6344315782535744`*^9, 3.6344315833338647`*^9}, {
  3.634862332982097*^9, 3.634862334222168*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"equilibriumEqns", " ", "=", " ", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"p1T", " ", "\[Equal]", " ", 
      RowBox[{"p1", " ", "+", " ", "h1", " ", "+", " ", "d"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"p2T", " ", "\[Equal]", " ", 
      RowBox[{"p2", " ", "+", " ", "h2", " ", "+", " ", "d"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"t1T", " ", "\[Equal]", " ", 
      RowBox[{"t1", " ", "+", " ", "h1"}]}], " ", 
     RowBox[{"(*", 
      RowBox[{"+", " ", "u"}], "*)"}], ",", "\[IndentingNewLine]", 
     RowBox[{"t2T", " ", "\[Equal]", " ", 
      RowBox[{"t2", " ", "+", " ", "h2"}]}], " ", 
     RowBox[{"(*", 
      RowBox[{"+", " ", "u"}], "*)"}], ",", "\[IndentingNewLine]", 
     RowBox[{"kh1", " ", "\[Equal]", " ", 
      RowBox[{"p1", " ", 
       RowBox[{"t1", " ", "/", " ", "h1"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"kh2", " ", "\[Equal]", " ", 
      RowBox[{"p2", " ", 
       RowBox[{"t2", " ", "/", " ", "h2"}]}]}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"ku", " ", "\[Equal]", " ", 
        RowBox[{"t1", " ", 
         RowBox[{"t2", " ", "/", " ", "u"}]}]}], ","}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"kd", " ", "\[Equal]", " ", 
      RowBox[{"p1", " ", 
       RowBox[{"p2", " ", "/", " ", "d"}]}]}]}], "\[IndentingNewLine]", 
    "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6344160609570355`*^9, 3.6344160709726086`*^9}, {
   3.6344161110679016`*^9, 3.634416213042734*^9}, {3.6344162710670533`*^9, 
   3.6344163209479065`*^9}, {3.6344166853597493`*^9, 3.6344166863278046`*^9}, 
   3.634417627338628*^9, {3.6344177059371233`*^9, 3.634417708072245*^9}, {
   3.6344177567540293`*^9, 3.6344179376633773`*^9}, {3.6344179820469155`*^9, 
   3.6344180479666862`*^9}, 3.6344181557508507`*^9, {3.634418949695262*^9, 
   3.634418995678892*^9}, {3.634419027028685*^9, 3.634419106678241*^9}, {
   3.6344214964379272`*^9, 3.6344214968059483`*^9}, {3.6344315714871874`*^9, 
   3.6344315854469852`*^9}, {3.6344382214955463`*^9, 
   3.6344382365594077`*^9}, {3.6344382696653013`*^9, 
   3.6344382783908005`*^9}, {3.6344389500092144`*^9, 3.634438999479044*^9}, {
   3.6344393480809827`*^9, 3.6344393498240824`*^9}, {3.634439535771718*^9, 
   3.6344395453072634`*^9}, {3.6344831140679483`*^9, 3.634483116377951*^9}, {
   3.634488112580595*^9, 3.6344881129705954`*^9}}],

Cell["\<\
A function that given the input state to the annealing step produces the \
state at the conclusion of the annealing step according to the equilibrium \
model.\
\>", "Text",
 CellChangeTimes->{{3.634480828485735*^9, 3.634480873349798*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"annealEquilibrium", "[", 
   RowBox[{"annealingInput_", ",", " ", "constants_", ",", " ", 
    RowBox[{"options_:", 
     RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "  ", 
     RowBox[{
     "eqns", ",", " ", "solns", ",", "result", " ", ",", " ", 
      "annEfficiency"}], " ", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"eqns", " ", "=", " ", 
      RowBox[{
       RowBox[{"equilibriumEqns", " ", "/.", " ", "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"p1T", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", " ", "p1"}], "]"}], "  ", "+", 
             " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", " ", "h1"}], "]"}], " ", "+", 
             " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", " ", "d"}], "]"}]}], ")"}]}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"p2T", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", " ", "p2"}], "]"}], " ", "+", 
             " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", " ", "h2"}], "]"}], " ", "+", 
             " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", " ", "d"}], "]"}]}], ")"}]}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"t1T", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", " ", "t1"}], "]"}], " ", "+", 
             " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", " ", "h1"}], "]"}]}], ")"}]}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"t2T", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", " ", "t2"}], "]"}], " ", "+", 
             " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", " ", "h2"}], "]"}]}], ")"}]}]}], 
         "\[IndentingNewLine]", "}"}]}], " ", "\[IndentingNewLine]", " ", "//.",
        " ", "constants"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"solns", " ", "=", " ", 
      RowBox[{
       RowBox[{"Solve", "[", 
        RowBox[{
         RowBox[{"eqns", " ", "~", "Join", "~", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"p1", " ", "\[GreaterEqual]", "0"}], " ", ",", 
            RowBox[{"p2", " ", "\[GreaterEqual]", "0"}]}], "}"}]}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
          "h1", ",", "h2", ",", "p1", ",", "p2", ",", " ", "t1", ",", " ", 
           "t2", ",", " ", "d"}], "}"}]}], "]"}], " ", "//", " ", "Quiet"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"result", " ", "=", " ", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "solns", "]"}], " ", ">", " ", "0"}], ",", 
        RowBox[{"solns", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"preempt", "[", 
         RowBox[{"annealingInput", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"h1", "\[Rule]", " ", "0"}], ",", " ", 
            RowBox[{"h2", "\[Rule]", " ", "0"}], ",", " ", 
            RowBox[{"p1", "\[Rule]", "0"}], ",", 
            RowBox[{"p2", "\[Rule]", "0"}], ",", 
            RowBox[{"t1", "\[Rule]", "0"}], ",", 
            RowBox[{"t2", "\[Rule]", "0"}], ",", 
            RowBox[{"d", "\[Rule]", "0"}]}], "}"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"annEfficiency", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"h1", " ", "+", " ", "h2"}], ")"}], " ", "//.", " ", 
          "result"}], ")"}], " ", "/", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"readState", "[", 
           RowBox[{"annealingInput", ",", "t1"}], "]"}], " ", "+", " ", 
          RowBox[{"readState", "[", 
           RowBox[{"annealingInput", ",", "t2"}], "]"}]}], ")"}]}], " ", "//",
        " ", "Quiet"}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{"suppress", " ", "division", " ", "by", " ", "zero"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"annEfficiency", " ", "===", " ", "Indeterminate"}], ",", " ", 
       RowBox[{"annEfficiency", " ", "=", " ", "0"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"result", " ", "=", " ", 
      RowBox[{"preempt", "[", 
       RowBox[{"result", ",", " ", "annealingInput"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"result", " ", "=", " ", 
      RowBox[{"preempt", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Epsilon]Ann", " ", "\[Rule]", " ", "annEfficiency"}], 
         "}"}], ",", " ", "result"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", " ", "//", " ", "makeState"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"annealEquilibrium", "[", 
  RowBox[{
   RowBox[{"state0", "[", "]"}], ",", " ", "constants"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"annealEquilibrium", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"p1", "\[Rule]", "0"}], ",", " ", 
     RowBox[{"p2", "\[Rule]", "0"}], ",", " ", 
     RowBox[{"t1", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", 
       RowBox[{"-", "6"}]}]}], ",", " ", 
     RowBox[{"t2", "\[Rule]", " ", 
      RowBox[{"10", "^", 
       RowBox[{"-", "6"}]}]}]}], "}"}], ",", " ", "constants"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.6344350112349296`*^9, 3.6344350305100317`*^9}, {
   3.634437387533846*^9, 3.6344373879008675`*^9}, {3.6344381566878395`*^9, 
   3.634438201479401*^9}, {3.6344382971918755`*^9, 3.6344383259095182`*^9}, {
   3.6344383799156075`*^9, 3.634438408063217*^9}, {3.634438443478243*^9, 
   3.6344384446783113`*^9}, {3.634438679172724*^9, 3.634438681164838*^9}, {
   3.634438760676385*^9, 3.63443876355555*^9}, {3.6344388028457975`*^9, 
   3.634438898467266*^9}, {3.634438984707199*^9, 3.6344390489168715`*^9}, {
   3.634439097953676*^9, 3.634439098489707*^9}, {3.6344391489135914`*^9, 
   3.6344391533298435`*^9}, {3.634439356408459*^9, 3.634439395214679*^9}, {
   3.6344395483184357`*^9, 3.6344395486304536`*^9}, {3.634439595302123*^9, 
   3.634439639518652*^9}, 3.6344397214863405`*^9, {3.6344398187969065`*^9, 
   3.6344400586756268`*^9}, {3.634440144642544*^9, 3.634440165770752*^9}, {
   3.634440195994481*^9, 3.6344401966035156`*^9}, {3.634440229458395*^9, 
   3.634440381857112*^9}, {3.634440427096699*^9, 3.6344405112565126`*^9}, {
   3.6344807924396844`*^9, 3.6344807938796864`*^9}, {3.6344881220716085`*^9, 
   3.63448813785363*^9}, {3.6344884804410286`*^9, 3.634488492232045*^9}, {
   3.6344886734243*^9, 3.6344886826053133`*^9}, {3.634488997759083*^9, 
   3.634489008820098*^9}, {3.6344894267805*^9, 3.634489428050502*^9}, {
   3.6344974529487133`*^9, 3.634497461128724*^9}, {3.634577131370632*^9, 
   3.634577136271639*^9}, 3.6346678169726562`*^9, {3.6348622721926203`*^9, 
   3.6348622999922104`*^9}, {3.634921334367488*^9, 3.634921336629492*^9}, {
   3.635095901032426*^9, 3.6350959078408146`*^9}, {3.635101876015175*^9, 
   3.635101908046007*^9}, {3.63513145996628*^9, 3.6351315643812523`*^9}, {
   3.635131603229474*^9, 3.635131711164648*^9}, {3.6351318191318235`*^9, 
   3.6351318193958387`*^9}, {3.6351727776069326`*^9, 
   3.6351728868705244`*^9}, {3.6351729292089987`*^9, 
   3.6351729313306026`*^9}, {3.635188333583847*^9, 3.6351883636795683`*^9}, {
   3.635214097260445*^9, 3.6352141294032836`*^9}, {3.635214370162054*^9, 
   3.6352143748393216`*^9}, {3.635214437417901*^9, 3.6352144958072405`*^9}, {
   3.6352147515038657`*^9, 3.635214762695506*^9}, {3.6352147931122456`*^9, 
   3.63521480087969*^9}, {3.6352148414000072`*^9, 3.6352150923573613`*^9}, {
   3.6352151435412893`*^9, 3.635215328515869*^9}, {3.6352154426743984`*^9, 
   3.6352154540350485`*^9}, {3.635215514330497*^9, 3.635215557585971*^9}, {
   3.6355371735201654`*^9, 3.635537175990169*^9}, {3.635546659124894*^9, 
   3.6355466813579254`*^9}, {3.6355574836620526`*^9, 3.6355575112850914`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Michaelis Menton Reactions", "Subsubsection",
 CellChangeTimes->{{3.635100055457045*^9, 3.635100062048422*^9}}],

Cell["\<\
The reactions are classic. Note that we have two sets, one for each hybrid \
(h1 and h2). We also have competition with accumulated amplicons. Note that \
we list the reactions here rather than in the \[OpenCurlyQuote]Extension \
Model\[CloseCurlyQuote] section as we need them to handle the case where we \
do both extension and annealing in the \[OpenCurlyQuote]Kinetic Annealing \
Model\[CloseCurlyQuote].\
\>", "Text",
 CellChangeTimes->{{3.635197103456455*^9, 3.635197147528976*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"michaelisMentionReactions", " ", "=", " ", 
   RowBox[{"{", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"e", " ", "+", " ", "h1"}], " ", 
      UnderoverscriptBox[
       TagBox[
        TagBox["\[Equilibrium]",
         DisplayForm],
        DisplayForm], "koff1", "kon1"], " ", "eh1"}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"eh1", " ", 
      OverscriptBox["\[RightArrow]", "kcat1"], " ", 
      RowBox[{"e", "+", "u"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e", " ", "+", " ", "h2"}], " ", 
      UnderoverscriptBox[
       TagBox[
        TagBox["\[Equilibrium]",
         DisplayForm],
        DisplayForm], "koff2", "kon2"], " ", "eh2"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"eh2", " ", 
      OverscriptBox["\[RightArrow]", "kcat2"], 
      RowBox[{"e", "+", "u"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e", " ", "+", " ", "u"}], " ", 
      UnderoverscriptBox[
       TagBox[
        TagBox["\[Equilibrium]",
         DisplayForm],
        DisplayForm], "koff3", "kon3"], " ", "eu"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e", " ", "+", " ", "d"}], " ", 
      UnderoverscriptBox[
       TagBox[
        TagBox["\[Equilibrium]",
         DisplayForm],
        DisplayForm], "koff4", "kon4"], " ", "ed"}]}], "\[IndentingNewLine]", 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"extensionMichaelisMentionDiffEqs", " ", "=", " ", 
   RowBox[{"rateEqns", "[", 
    RowBox[{"michaelisMentionReactions", ",", " ", "\[Tau]", ",", " ", 
     RowBox[{"WasteSpecies", " ", "\[Rule]", " ", 
      RowBox[{"{", "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"%", " ", "//", " ", "Column"}], " ", "//", " ", 
  "TraditionalForm"}]}], "Input",
 CellChangeTimes->{{3.6348650167976027`*^9, 3.6348650230939627`*^9}, {
   3.6348656456965733`*^9, 3.6348656466166263`*^9}, 3.6348657415280547`*^9, 
   3.6348657775281143`*^9, {3.635008989643858*^9, 3.635009025786909*^9}, {
   3.6350158639096603`*^9, 3.635015894073703*^9}, 3.635017749314889*^9, {
   3.6355372014022045`*^9, 3.635537218644229*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Kinetic Annealing Model", "Subsubsection",
 CellChangeTimes->{{3.6344809110048513`*^9, 3.634480913554855*^9}, {
  3.6348623371103334`*^9, 3.634862338510413*^9}}],

Cell["We have the fundamental annealing reactions from the paper.", "Text",
 CellChangeTimes->{{3.6344885044340625`*^9, 3.6344885073140664`*^9}, {
  3.634571544308897*^9, 3.6345715532689095`*^9}, {3.635099878577928*^9, 
  3.6350998882344804`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"kineticAnnealingReactions", " ", "=", " ", 
   RowBox[{"{", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"p1", " ", "+", " ", "t1"}], " ", 
      UnderoverscriptBox[
       TagBox[
        TagBox["\[Equilibrium]",
         DisplayForm],
        DisplayForm], "koffh1", "konh1"], " ", "h1"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p2", " ", "+", " ", "t2"}], " ", 
      UnderoverscriptBox[
       TagBox[
        TagBox["\[Equilibrium]",
         DisplayForm],
        DisplayForm], "koffh2", "konh2"], " ", "h2"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t1", " ", "+", " ", "t2"}], " ", 
      UnderoverscriptBox[
       TagBox[
        TagBox["\[Equilibrium]",
         DisplayForm],
        DisplayForm], "koffu", "konu"], " ", "u"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p1", " ", "+", "p2"}], " ", 
      UnderoverscriptBox[
       TagBox[
        TagBox["\[Equilibrium]",
         DisplayForm],
        DisplayForm], "koffd", "kond"], " ", "d"}]}], "\[IndentingNewLine]", 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kineticEqns", " ", "=", " ", 
   RowBox[{"rateEqns", "[", 
    RowBox[{"kineticAnnealingReactions", ",", "  ", "\[Tau]", ",", " ", 
     RowBox[{"WasteSpecies", " ", "\[Rule]", " ", 
      RowBox[{"{", "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kineticEqns", "//", " ", "Column"}], " ", "//", " ", 
  "TraditionalForm"}]}], "Input",
 CellChangeTimes->{{3.634950655945882*^9, 3.6349508314709215`*^9}, {
   3.6349510597409773`*^9, 3.6349510636612015`*^9}, {3.6349511608367596`*^9, 
   3.6349511699402804`*^9}, {3.635009072442974*^9, 3.635009117547038*^9}, 
   3.635356624762347*^9, 3.6353566556036015`*^9, {3.6353566907504625`*^9, 
   3.635356718752512*^9}, {3.635356781356422*^9, 3.635356853680149*^9}}],

Cell["\<\
We consider both kinetic annealing and Michaelis Mention reactions together.\
\>", "Text",
 CellChangeTimes->{{3.635100500045474*^9, 3.6351005194055815`*^9}, 
   3.6351019494033723`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"kineticAnnealAndMMEqns", " ", "=", " ", 
   RowBox[{"rateEqns", "[", 
    RowBox[{
     RowBox[{
     "kineticAnnealingReactions", " ", "~", "Join", "~", " ", 
      "michaelisMentionReactions"}], ",", " ", "\[Tau]", ",", " ", 
     RowBox[{"WasteSpecies", " ", "\[Rule]", " ", 
      RowBox[{"{", "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kineticAnnealAndMMEqns", "//", " ", "Column"}], " ", "//", " ", 
  "TraditionalForm"}]}], "Input",
 CellChangeTimes->{{3.6351005235608187`*^9, 3.6351005758708105`*^9}}],

Cell["\<\
We construct a function that executes the annealing step according to the \
kinetic model. Optionally, in can include extension activity, but at a \
reduced efficiency. \
\>", "Text",
 CellChangeTimes->{{3.634571747538397*^9, 3.6345717614394164`*^9}, {
  3.635129163227914*^9, 3.635129189779433*^9}, {3.661957022589785*^9, 
  3.661957026099785*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"annealKinetic", "[", 
   RowBox[{"annealingInput_", ",", " ", "constants_", ",", " ", 
    RowBox[{"options_:", 
     RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "  ", 
     RowBox[{
     "\[Tau]Anneal", ",", " ", "extend", ",", " ", "diffeqs", ",", " ", 
      "inits", ",", " ", "consts", ",", " ", 
      RowBox[{"(*", 
       RowBox[{"eqns", ","}], "*)"}], " ", "vars", ",", " ", 
      RowBox[{"(*", 
       RowBox[{"soln", ","}], "*)"}], " ", "result", ",", " ", 
      "annEfficiency", " ", ",", " ", "\[CapitalDelta]p1", ",", " ", 
      "\[CapitalDelta]p2"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"consts", " ", "=", " ", "constants"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"extend", " ", "=", " ", 
      RowBox[{"useExtendDuringAnneal", " ", "//.", " ", 
       RowBox[{"preempt", "[", 
        RowBox[{"options", ",", " ", 
         RowBox[{"{", 
          RowBox[{"useExtendDuringAnneal", " ", "\[Rule]", " ", "False"}], 
          "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"extend", ",", "\[IndentingNewLine]", 
       RowBox[{"consts", " ", "=", " ", 
        RowBox[{"preempt", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "polymeraseEfficiency", "\[Rule]", " ", 
            "polymeraseAnnealEfficiency"}], "}"}], ",", " ", "consts"}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[Tau]Anneal", " ", "=", " ", 
      RowBox[{"\[Tau]ann", " ", "//.", " ", "consts"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"diffeqs", " ", "=", " ", "kineticEqns"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"inits", " ", "=", " ", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"h1", "[", "0", "]"}], " ", "\[Equal]", " ", 
         RowBox[{"readState", "[", 
          RowBox[{"annealingInput", ",", " ", "h1", ",", " ", "0"}], "]"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"h2", "[", "0", "]"}], " ", "\[Equal]", 
         RowBox[{"readState", "[", 
          RowBox[{"annealingInput", ",", " ", "h2", ",", " ", "0"}], "]"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"u", "[", "0", "]"}], " ", "\[Equal]", " ", 
         RowBox[{"readState", "[", 
          RowBox[{"annealingInput", ",", " ", "u", ",", " ", "0"}], "]"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"d", "[", "0", "]"}], " ", "\[Equal]", " ", 
         RowBox[{"readState", "[", 
          RowBox[{"annealingInput", ",", " ", "d", ",", " ", "0"}], "]"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"p1", "[", "0", "]"}], " ", "\[Equal]", " ", 
         RowBox[{"readState", "[", 
          RowBox[{"annealingInput", ",", "p1", ",", " ", "0"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"p2", "[", "0", "]"}], " ", "\[Equal]", " ", 
         RowBox[{"readState", "[", 
          RowBox[{"annealingInput", ",", "p2", ",", " ", "0"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"t1", "[", "0", "]"}], " ", "\[Equal]", " ", 
         RowBox[{"readState", "[", 
          RowBox[{"annealingInput", ",", "t1", ",", " ", "0"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"t2", "[", "0", "]"}], " ", "\[Equal]", " ", 
         RowBox[{"readState", "[", 
          RowBox[{"annealingInput", ",", "t2", ",", " ", "0"}], "]"}]}]}], 
       "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vars", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
       "h1", ",", " ", "h2", ",", " ", "u", ",", " ", "d", ",", " ", "p1", 
        ",", " ", "p2", ",", " ", "t1", " ", ",", "t2"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"extend", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"diffeqs", " ", "=", " ", "kineticAnnealAndMMEqns"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"inits", " ", "=", " ", 
         RowBox[{"inits", " ", "~", "Join", "~", " ", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"eh1", "[", "0", "]"}], " ", "\[Equal]", " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", "eh1", ",", " ", "0"}], "]"}]}], 
            ",", " ", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"eh2", "[", "0", "]"}], " ", "\[Equal]", " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", "eh2", ",", " ", "0"}], "]"}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"e", "[", "0", "]"}], " ", "==", " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", " ", "e", ",", " ", "0"}], 
              "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"eu", "[", "0", "]"}], " ", "\[Equal]", " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", "eu", ",", " ", "0"}], "]"}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"ed", "[", "0", "]"}], " ", "\[Equal]", " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingInput", ",", "ed", ",", " ", "0"}], "]"}]}]}],
            "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"vars", " ", "=", " ", 
         RowBox[{"vars", " ", "~", "Join", "~", " ", 
          RowBox[{"{", 
           RowBox[{
           "eh1", ",", " ", "eh2", ",", " ", "e", ",", "  ", "eu", ",", " ", 
            "ed"}], "}"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"eqns", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"diffeqs", " ", "//.", " ", "consts"}], ")"}], " ", "~", 
         "Join", "~", " ", "inits"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"soln", " ", "=", " ", 
        RowBox[{
         RowBox[{"NDSolve", "[", 
          RowBox[{"eqns", ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", "\[Tau]", "]"}], "&"}], " ", "/@", " ", 
            "vars"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\[Tau]", ",", " ", "0", ",", " ", "\[Tau]Anneal"}], 
            "}"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{"AccuracyGoal", "\[Rule]", "MachinePrecision"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PrecisionGoal", "\[Rule]", "MachinePrecision"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"MaxStepFraction", "\[Rule]", ".001"}]}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"result", " ", "=", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "\[Rule]", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#", "[", "\[Tau]", "]"}], " ", "/.", " ", "soln"}], 
               ")"}], " ", "/.", " ", 
              RowBox[{"\[Tau]", "\[Rule]", "\[Tau]Anneal"}]}], ")"}]}], "&"}],
           "/@", " ", "vars"}], ")"}]}], ";"}], "*)"}], "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{"result", " ", "=", " ", 
      RowBox[{"ndRun", "[", 
       RowBox[{
       "diffeqs", ",", " ", "\[Tau]Anneal", ",", " ", "consts", ",", " ", 
        "inits"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"result", " ", "=", " ", 
      RowBox[{"preempt", "[", 
       RowBox[{"result", ",", " ", "annealingInput"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"We", "'"}], "ll", " ", "use", " ", "an", " ", "annealing", 
        " ", "efficiency", " ", "cacluation", " ", "which", " ", "is", " ", 
        "equivalent", " ", "to", " ", "the", " ", "below"}], ",", " ", 
       RowBox[{
       "but", " ", "also", " ", "works", " ", "in", " ", "the", " ", 
        "extension", " ", "case", " ", "too"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Essentially", " ", "waht", " ", "we", " ", "do", " ", "is", " ", 
       "figure", " ", "out", " ", "how", " ", "many", " ", "free", " ", 
       "primers", " ", 
       RowBox[{"we", "'"}], "ve", " ", "lost", " ", "to", " ", "everything", 
       " ", "except", " ", "primer", " ", 
       RowBox[{"dimers", ".", " ", "Those"}], " ", "must", " ", "have"}], " ",
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"hybridized", ",", " ", 
       RowBox[{
       "and", " ", "either", " ", "still", " ", "be", " ", "hybrids", " ", 
        "or", " ", "have", " ", "been", " ", "extended", " ", "into", " ", 
        "duplex", " ", "amplicons"}], ",", " ", 
       RowBox[{"and", " ", 
        RowBox[{"so", ":", " ", 
         RowBox[{
         "be", " ", "the", " ", "amount", " ", "of", " ", "hybrids", " ", 
          RowBox[{"formed", "."}]}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "Divided", " ", "by", " ", "the", " ", "total", " ", "template", " ", 
        "targets", " ", "we", " ", "have"}], ",", " ", 
       RowBox[{"and", " ", "we", " ", "get", " ", "the", " ", "efficiency"}], 
       ",", " ", 
       RowBox[{
       "just", " ", "as", " ", "in", " ", "eqn", " ", "31", " ", "in", " ", 
        "the", " ", "paper"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"annEfficiency", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"h2", " ", "+", " ", "h2"}], ")"}], " ", "//.", " ", 
           "result"}], ")"}], " ", "/", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"readState", "[", 
            RowBox[{"annealingInput", ",", "t1"}], "]"}], " ", "+", " ", 
           RowBox[{"readState", "[", 
            RowBox[{"annealingInput", ",", "t2"}], "]"}]}], ")"}]}]}], ";"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[CapitalDelta]p1", " ", "=", " ", 
      RowBox[{
       RowBox[{"readState", "[", 
        RowBox[{"annealingInput", ",", "p1"}], "]"}], "-", " ", 
       RowBox[{"(", 
        RowBox[{"p1", " ", "//.", " ", "result"}], ")"}], " ", "-", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"d", " ", "//.", " ", "result"}], ")"}], " ", "-", " ", 
         RowBox[{"readState", "[", 
          RowBox[{"annealingInput", ",", " ", "d"}], "]"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[CapitalDelta]p2", " ", "=", " ", 
      RowBox[{
       RowBox[{"readState", "[", 
        RowBox[{"annealingInput", ",", "p2"}], "]"}], " ", "-", " ", 
       RowBox[{"(", 
        RowBox[{"p2", " ", "//.", " ", "result"}], ")"}], " ", "-", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"d", " ", "//.", " ", "result"}], ")"}], " ", "-", " ", 
         RowBox[{"readState", "[", 
          RowBox[{"annealingInput", ",", " ", "d"}], "]"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"annEfficiency", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[CapitalDelta]p1", " ", "+", " ", "\[CapitalDelta]p2"}], 
         ")"}], " ", "/", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"readState", "[", 
           RowBox[{"annealingInput", ",", "t1"}], "]"}], " ", "+", " ", 
          RowBox[{"readState", "[", 
           RowBox[{"annealingInput", ",", "t2"}], "]"}]}], ")"}]}], " ", "//",
        " ", "Quiet"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"annEfficiency", "===", "Indeterminate"}], ",", " ", 
       RowBox[{"annEfficiency", "=", "0"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"result", " ", "=", " ", 
      RowBox[{"preempt", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Epsilon]Ann", " ", "\[Rule]", " ", "annEfficiency"}], 
         "}"}], ",", " ", "result"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", " ", "//", " ", "makeState"}]}]}], " ", 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"annealKinetic", "[", 
   RowBox[{
    RowBox[{"state0", "[", "]"}], ",", " ", 
    RowBox[{"preempt", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", " ", "constants"}], "]"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"useExtendDuringAnneal", " ", "\[Rule]", " ", "False"}], "}"}]}],
    "]"}], " ", "//", "Sort"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"annealKinetic", "[", 
   RowBox[{
    RowBox[{"state0", "[", "]"}], ",", " ", 
    RowBox[{"preempt", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", " ", "constants"}], "]"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"useExtendDuringAnneal", " ", "\[Rule]", " ", "True"}], "}"}]}], 
   "]"}], " ", "//", " ", "Sort"}]}], "Input",
 CellChangeTimes->{{3.634571774521435*^9, 3.634571825227506*^9}, {
   3.6345719142372336`*^9, 3.634571965913306*^9}, {3.6345719980063515`*^9, 
   3.6345720373694067`*^9}, {3.6345720899034805`*^9, 
   3.6345721104455094`*^9}, {3.634572142636555*^9, 3.6345722702297354`*^9}, {
   3.6345723398958335`*^9, 3.6345723427768373`*^9}, {3.634572376688885*^9, 
   3.6345726237152324`*^9}, {3.6345729275435*^9, 3.6345729284435015`*^9}, {
   3.634572958726544*^9, 3.634573001079603*^9}, 3.6345738253463397`*^9, {
   3.634574129795768*^9, 3.634574156118805*^9}, {3.6345742301659093`*^9, 
   3.6345742437979283`*^9}, {3.6345743279970465`*^9, 3.634574348558076*^9}, {
   3.6345746968875685`*^9, 3.634574766403666*^9}, {3.634574871306815*^9, 
   3.6345748886278396`*^9}, {3.6345749221698866`*^9, 3.634574922329887*^9}, {
   3.634575002471504*^9, 3.6345750230225334`*^9}, 3.6345750878186245`*^9, {
   3.6345754193491583`*^9, 3.6345754260091677`*^9}, {3.6345771813507032`*^9, 
   3.634577182451705*^9}, {3.6345772561218085`*^9, 3.6345772600618143`*^9}, 
   3.634667845837307*^9, {3.634696915280466*^9, 3.634696975223894*^9}, {
   3.6346971315828376`*^9, 3.634697177854484*^9}, 3.634697212662475*^9, {
   3.6346973614209833`*^9, 3.6346973648851814`*^9}, {3.63469742552465*^9, 
   3.6346974669160175`*^9}, 3.634697612053319*^9, {3.6347369633980875`*^9, 
   3.634736963574097*^9}, {3.6348620549621954`*^9, 3.6348621236901264`*^9}, {
   3.6348621859536877`*^9, 3.634862232793367*^9}, {3.6350208425102544`*^9, 
   3.6350208467502604`*^9}, {3.6350213928400307`*^9, 
   3.6350214413950987`*^9}, {3.635021526258218*^9, 3.635021527068219*^9}, {
   3.635021573386285*^9, 3.635021581477296*^9}, {3.635021647884389*^9, 
   3.6350216480643897`*^9}, {3.635095920536541*^9, 3.635095924936793*^9}, {
   3.635099772333851*^9, 3.635099837367571*^9}, {3.635099909887719*^9, 
   3.6350999214693813`*^9}, {3.635099955613334*^9, 3.6350999935945063`*^9}, {
   3.635100112324298*^9, 3.6351004311155314`*^9}, {3.6351006024583316`*^9, 
   3.6351006238225536`*^9}, {3.6351007252213535`*^9, 
   3.6351007436944103`*^9}, {3.6351007892690163`*^9, 
   3.6351008008296776`*^9}, {3.63510085664787*^9, 3.635100858355968*^9}, {
   3.635100907111757*^9, 3.6351009103649426`*^9}, {3.6351009665351553`*^9, 
   3.635101106747175*^9}, {3.6351011367548914`*^9, 3.635101137378927*^9}, {
   3.635101191590028*^9, 3.6351014112055893`*^9}, {3.6351014845727854`*^9, 
   3.6351015914118967`*^9}, {3.635101978245022*^9, 3.6351019877855678`*^9}, {
   3.63510237053446*^9, 3.6351023981750407`*^9}, {3.63510249606164*^9, 
   3.6351025880939035`*^9}, {3.635102635957641*^9, 3.6351026785170755`*^9}, {
   3.635102749772151*^9, 3.6351027499561615`*^9}, {3.635129198192914*^9, 
   3.635129234649999*^9}, {3.635130628693734*^9, 3.635130631525896*^9}, {
   3.635130812068222*^9, 3.6351308574758196`*^9}, {3.635130900119259*^9, 
   3.6351309096268024`*^9}, {3.635130941366618*^9, 3.6351309623368177`*^9}, {
   3.635131005469284*^9, 3.63513104262941*^9}, 3.635131292621709*^9, 
   3.635131928578083*^9, {3.6351884118233223`*^9, 3.635188426191144*^9}, {
   3.6352127932958627`*^9, 3.6352128892163486`*^9}, {3.635212928448593*^9, 
   3.6352129928872786`*^9}, {3.635216177969455*^9, 3.6352162019128246`*^9}, {
   3.635259026468249*^9, 3.635259048571513*^9}, {3.635537231485247*^9, 
   3.6355372607182884`*^9}, {3.6355465615337563`*^9, 3.635546576634778*^9}, 
   3.635546636672862*^9, {3.6355575686181726`*^9, 3.635557604348223*^9}, {
   3.6619598460369205`*^9, 3.661959891835741*^9}, {3.6619601083711147`*^9, 
   3.66196011044584*^9}, {3.661960145971814*^9, 3.661960160444216*^9}, {
   3.661960249933489*^9, 3.661960333853947*^9}, {3.6619603867731004`*^9, 
   3.661960411339721*^9}, {3.6619604557739534`*^9, 3.661960455974522*^9}, {
   3.661960811767558*^9, 3.661960868042638*^9}, {3.6624138475517025`*^9, 
   3.6624138496105537`*^9}, {3.6624140247370768`*^9, 3.662414028704117*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Extension Model", "Subsection",
 CellChangeTimes->{{3.6344315933414373`*^9, 3.634431595605567*^9}}],

Cell[CellGroupData[{

Cell["Gevertz et al.", "Subsubsection",
 CellChangeTimes->{{3.634846565477247*^9, 3.634846574669773*^9}}],

Cell["\<\
Here we implement the extension model as described in the paper by Gevertz et \
al, in section \[OpenCurlyDoubleQuote]Step 3\[CloseCurlyDoubleQuote]. We \
begin by analysing the differential equation 28 from the paper, solving it \
symbolically, once, so we don\[CloseCurlyQuote]t have to recompute that each \
and every cycle.\
\>", "Text",
 CellChangeTimes->{{3.634488518357082*^9, 3.6344885655211487`*^9}, {
  3.6345001475215034`*^9, 3.6345001557025146`*^9}, {3.634501540703477*^9, 
  3.63450158546854*^9}, {3.6345016166505837`*^9, 3.634501617351585*^9}, {
  3.6348465859414177`*^9, 3.6348465917887526`*^9}, {3.6348466343251853`*^9, 
  3.6348466595406275`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"extensionAnalysis", "[", 
   RowBox[{"sT_", ",", " ", "\[Tau]_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"diffeq", ",", " ", "s", ",", " ", "soln", ",", " ", "vmax"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"diffeq", " ", "=", " ", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"s", "[", "\[Tau]", "]"}], ",", "\[Tau]"}], "]"}]}], " ", 
       "\[Equal]", " ", 
       RowBox[{"vmax", " ", 
        RowBox[{
         RowBox[{"s", "[", "\[Tau]", "]"}], " ", "/", " ", 
         RowBox[{"(", 
          RowBox[{"km", " ", "+", " ", 
           RowBox[{"s", "[", "\[Tau]", "]"}]}], ")"}]}]}]}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{"eqn", " ", "28"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"soln", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"DSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"diffeq", ",", " ", 
            RowBox[{
             RowBox[{"s", "[", "0", "]"}], "\[Equal]", "sT"}]}], "}"}], ",", 
          " ", 
          RowBox[{"s", "[", "\[Tau]", "]"}], ",", " ", "\[Tau]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], " ", "//", " ", "Quiet"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"s", "[", "\[Tau]", "]"}], " ", "/.", " ", 
      RowBox[{"(", 
       RowBox[{"soln", " ", "/.", " ", 
        RowBox[{"vmax", " ", "\[Rule]", " ", 
         RowBox[{"kcat", " ", "*", " ", "e"}]}]}], ")"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"sAnalysis", " ", "=", " ", 
  RowBox[{"extensionAnalysis", "[", 
   RowBox[{"sT", ",", " ", "\[Tau]ext"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.63449673751966*^9, 3.6344967877537303`*^9}, {
   3.634496821756778*^9, 3.6344969190459146`*^9}, {3.6344969513499603`*^9, 
   3.6344970664591217`*^9}, {3.6344971103951836`*^9, 3.634497171380269*^9}, {
   3.6344972908024855`*^9, 3.634497407312649*^9}, {3.634497516164802*^9, 
   3.6344977341981087`*^9}, {3.634497812907219*^9, 3.634497894035333*^9}, {
   3.6344979248683767`*^9, 3.634497929438383*^9}, {3.6344981296826644`*^9, 
   3.634498167105717*^9}, {3.6344982805078764`*^9, 3.634498337833957*^9}, {
   3.634498381809019*^9, 3.634498409092057*^9}, {3.6344985158722076`*^9, 
   3.6344985750772905`*^9}, {3.634498630143368*^9, 3.6344986364933767`*^9}, 
   3.634498726176504*^9, {3.6344987652905593`*^9, 3.634498853139683*^9}, {
   3.634498885883729*^9, 3.6344989586228313`*^9}, 3.634499138414084*^9, {
   3.6344992689972677`*^9, 3.6344993615373974`*^9}, {3.634499394430444*^9, 
   3.6344994431345124`*^9}, {3.634499481713567*^9, 3.634499631285777*^9}, {
   3.6344996639788227`*^9, 3.63449969075086*^9}, {3.6344997428359337`*^9, 
   3.634499987901278*^9}, {3.634500062858383*^9, 3.6345000665083885`*^9}, 
   3.6345001391204915`*^9, {3.634656030021838*^9, 3.6346560336018434`*^9}}],

Cell["With that in hand, the extension efficiency can be computed.", "Text",
 CellChangeTimes->{{3.634501623802594*^9, 3.634501636733612*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"extensionEfficiencyGevertz", "[", 
   RowBox[{"annealingOutput_", ",", " ", "constants_"}], "]"}], " ", ":=", 
  " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "sTT", ",", " ", "s", ",", " ", "vmax", ",", " ", "eqn30", ",", " ", 
      "result"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sTT", " ", "=", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"readState", "[", 
         RowBox[{"annealingOutput", ",", "h1"}], "]"}], " ", "+", " ", 
        RowBox[{"readState", "[", 
         RowBox[{"annealingOutput", ",", "h2"}], "]"}]}], ")"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"s", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"sAnalysis", " ", "/.", " ", 
         RowBox[{"sT", " ", "\[Rule]", " ", "sTT"}]}], " ", "/.", " ", 
        "constants"}], " ", "/.", " ", 
       RowBox[{"e", " ", "\[Rule]", " ", 
        RowBox[{"readState", "[", 
         RowBox[{"annealingOutput", ",", "e"}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"result", " ", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"sTT", " ", "-", "s"}], ")"}], " ", "/", " ", "sTT"}], " ", 
       RowBox[{"(*", " ", 
        RowBox[{"eqn", " ", "32"}], " ", "*)"}], " ", "//", " ", "Quiet"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"result", " ", "===", " ", "Indeterminate"}], ",", " ", 
       RowBox[{"result", " ", "=", " ", "0"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "result"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"extensionEfficiencyGevertz", "[", 
  RowBox[{
   RowBox[{"annealKinetic", "[", 
    RowBox[{
     RowBox[{"state0", "[", "]"}], ",", " ", "constants"}], "]"}], ",", " ", 
   "constants"}], "]"}]}], "Input",
 CellChangeTimes->{{3.6344885504801273`*^9, 3.634488621318227*^9}, 
   3.634488995388079*^9, {3.634489343631383*^9, 3.634489345172385*^9}, {
   3.6344934285668344`*^9, 3.634493430036837*^9}, {3.63449383346187*^9, 
   3.6344941157042675`*^9}, {3.634494165888338*^9, 3.634494173009348*^9}, {
   3.6344942070823956`*^9, 3.634494269150483*^9}, {3.634494569309998*^9, 
   3.6344945977840385`*^9}, {3.634494662230129*^9, 3.634494683532159*^9}, 
   3.6344956981361427`*^9, {3.6344990014678917`*^9, 3.634499001857892*^9}, {
   3.6345000573573756`*^9, 3.634500130520479*^9}, {3.63450164942663*^9, 
   3.6345016541166363`*^9}, {3.6345733188316264`*^9, 3.634573319661628*^9}, {
   3.6345753747940955`*^9, 3.634575375384096*^9}, 3.6345755707403708`*^9, {
   3.6345764310375805`*^9, 3.6345764312875805`*^9}, {3.6345772823848457`*^9, 
   3.6345773114568863`*^9}, 3.634655894160647*^9, {3.6346564501904306`*^9, 
   3.6346564506104307`*^9}, 3.63465747804989*^9, {3.634662069704929*^9, 
   3.6346620700325294`*^9}, 3.6346693427704086`*^9, {3.634672418987358*^9, 
   3.6346724193163767`*^9}, {3.634674259358621*^9, 3.634674311382597*^9}, 
   3.634674361806481*^9, {3.634674392086213*^9, 3.6346744162535954`*^9}, {
   3.634674578388869*^9, 3.6346746603965592`*^9}, 3.6346747062551823`*^9, {
   3.6346748317223587`*^9, 3.634674940618587*^9}, {3.6346947320385914`*^9, 
   3.6346947599421873`*^9}, {3.634696824816292*^9, 3.6346968259273553`*^9}, {
   3.6348465482592626`*^9, 3.634846548265263*^9}, {3.635173349967526*^9, 
   3.6351733530563316`*^9}, 3.6351734043024216`*^9, {3.6352156793349347`*^9, 
   3.635215702231244*^9}, {3.6352157340390635`*^9, 3.635215805450148*^9}}],

Cell["\<\
We compute the result of the extension step (which becomes, after an implicit \
denaturing, the input to the next annealing step). Note that this can be \
modified to support one of three different enzyme degredation models.\
\>", "Text",
 CellChangeTimes->{{3.6344886500722675`*^9, 3.634488653522272*^9}, {
  3.6344886863853188`*^9, 3.6344887198203654`*^9}, {3.6344889400120015`*^9, 
  3.634488959464029*^9}, {3.634501681559675*^9, 3.634501703562706*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"extensionStepGevertz", "[", 
   RowBox[{"annealingOutputA_", ",", " ", "constants_", ",", " ", 
    RowBox[{"options_:", " ", 
     RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"annealingOutput", ",", " ", "extEfficiency"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
      "Free", " ", "up", " ", "any", " ", "eh1", " ", "and", " ", "eh2", " ", 
       "complexes", " ", "to", " ", "fit", " ", "into", " ", "the", " ", 
       "Gevertz", " ", 
       RowBox[{"model", ".", " ", 
        RowBox[{"Shouldn", "'"}]}], "t", " ", "actually", " ", "*", "be", "*",
        " ", "any"}], ";", " ", 
      RowBox[{
       RowBox[{"we", "'"}], "re", " ", "just", " ", "being", " ", 
       RowBox[{"complete", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"annealingOutput", " ", "=", " ", 
      RowBox[{"preempt", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"h1", " ", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"readState", "[", 
             RowBox[{"annealingOutputA", ",", " ", "h1"}], "]"}], " ", "+", 
            " ", 
            RowBox[{"readState", "[", 
             RowBox[{"annealingOutputA", ",", " ", "eh1"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"h2", " ", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"readState", "[", 
             RowBox[{"annealingOutputA", ",", " ", "h2"}], "]"}], " ", "+", 
            " ", 
            RowBox[{"readState", "[", 
             RowBox[{"annealingOutputA", ",", " ", "eh2"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"e", " ", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"readState", "[", 
             RowBox[{"annealingOutputA", ",", " ", "e"}], "]"}], " ", "+", 
            " ", 
            RowBox[{"readState", "[", 
             RowBox[{"annealingOutputA", ",", " ", "eh1"}], "]"}], " ", "+", 
            " ", 
            RowBox[{"readState", "[", 
             RowBox[{"annealingOutputA", ",", " ", "eh2"}], "]"}], " ", "+", 
            " ", 
            RowBox[{"readState", "[", 
             RowBox[{"annealingOutputA", ",", " ", "ed"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"eh1", " ", "\[Rule]", " ", "0"}], ",", " ", 
          RowBox[{"eh2", " ", "\[Rule]", " ", "0"}], ",", " ", 
          RowBox[{"ed", "\[Rule]", " ", "0"}]}], "\[IndentingNewLine]", "}"}],
         ",", " ", "annealingOutputA"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"now", " ", 
       RowBox[{"it", "'"}], "s", " ", 
       RowBox[{"simple", ":", " ", 
        RowBox[{
        "h1", " ", "and", " ", "h2", " ", "extend", " ", "at", " ", "the", 
         " ", "computed", " ", "efficiency"}]}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"extEfficiency", " ", "=", " ", 
      RowBox[{"extensionEfficiencyGevertz", "[", 
       RowBox[{"annealingOutput", ",", " ", "constants"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"preempt", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"h1", " ", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", " ", "-", " ", "extEfficiency"}], ")"}], " ", 
            RowBox[{"readState", "[", 
             RowBox[{"annealingOutput", ",", "h1"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"h2", " ", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", " ", "-", " ", "extEfficiency"}], ")"}], " ", 
            RowBox[{"readState", "[", 
             RowBox[{"annealingOutput", ",", "h2"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"u", " ", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"readState", "[", 
             RowBox[{"annealingOutput", ",", " ", "u"}], "]"}], " ", "+", " ", 
            RowBox[{"extEfficiency", " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingOutput", ",", "h2"}], "]"}]}], " ", "+", "  ", 
            RowBox[{"extEfficiency", " ", 
             RowBox[{"readState", "[", 
              RowBox[{"annealingOutput", ",", "h1"}], "]"}]}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Epsilon]Ext", " ", "\[Rule]", " ", "extEfficiency"}]}], 
         "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
        "annealingOutput"}], "\[IndentingNewLine]", "]"}], "  ", "//", " ", 
      "makeState"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"extensionStepGevertz", "[", 
  RowBox[{
   RowBox[{"annealEquilibrium", "[", 
    RowBox[{
     RowBox[{"state0", "[", "]"}], ",", "constants"}], "]"}], ",", " ", 
   "constants"}], "]"}]}], "Input",
 CellChangeTimes->{{3.634488963044034*^9, 3.6344889862170663`*^9}, {
   3.6344890259441223`*^9, 3.6344892409394245`*^9}, {3.634489277163289*^9, 
   3.634489315208343*^9}, {3.6344894392815175`*^9, 3.6344894402915187`*^9}, {
   3.634490104457263*^9, 3.6344901165282803`*^9}, {3.63449068844862*^9, 
   3.63449068848862*^9}, {3.634492945194155*^9, 3.6344929692561893`*^9}, {
   3.6344930628653207`*^9, 3.6344931004983735`*^9}, {3.6344931439434347`*^9, 
   3.634493182787489*^9}, {3.634493260059598*^9, 3.634493267849609*^9}, {
   3.6344933978537917`*^9, 3.634493437887848*^9}, {3.6344957550722227`*^9, 
   3.63449576718324*^9}, {3.634495896863423*^9, 3.634495904453433*^9}, {
   3.6345003719508195`*^9, 3.634500382882835*^9}, {3.6345004174168835`*^9, 
   3.6345005226080313`*^9}, {3.6345011088038673`*^9, 
   3.6345011088938675`*^9}, {3.634501707893712*^9, 3.6345017336567483`*^9}, 
   3.6345041132573414`*^9, {3.6345042540145397`*^9, 3.63450426862656*^9}, {
   3.634508819783537*^9, 3.6345088235747538`*^9}, {3.6345089614286385`*^9, 
   3.634508987869151*^9}, {3.6345090642695208`*^9, 3.6345090839336452`*^9}, {
   3.634577407147021*^9, 3.6345774698231087`*^9}, 3.634667910821024*^9, 
   3.6346723569818115`*^9, {3.634694505649643*^9, 3.6346945098258815`*^9}, {
   3.634694771607855*^9, 3.6346947717918653`*^9}, {3.6348467681998425`*^9, 
   3.634846768207843*^9}, {3.634861993762695*^9, 3.634862008835557*^9}, {
   3.634862386600164*^9, 3.634862460296379*^9}, {3.6349212736989813`*^9, 
   3.63492130151383*^9}, {3.6350224176552353`*^9, 3.6350224318512607`*^9}, {
   3.6350959553925347`*^9, 3.6350959588167305`*^9}, {3.635132000243182*^9, 
   3.635132012914907*^9}, {3.6351320536422367`*^9, 3.635132055658352*^9}, {
   3.6351734282016635`*^9, 3.6351735705217133`*^9}, {3.6351736007077665`*^9, 
   3.635173656977065*^9}, {3.6351884842144628`*^9, 3.635188494598057*^9}, {
   3.6351954816226916`*^9, 3.6351955987983932`*^9}, {3.6351956598858876`*^9, 
   3.635195879764464*^9}, {3.6351959184276752`*^9, 3.6351959276122007`*^9}, {
   3.6351965020480566`*^9, 3.635196525920422*^9}, {3.635196573103121*^9, 
   3.635196574863221*^9}, {3.635215639478655*^9, 3.6352156452469845`*^9}, {
   3.635215825717307*^9, 3.6352158277574244`*^9}, {3.6355467490660205`*^9, 
   3.6355467641680417`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Michaelis Menton extension model from first principles", "Subsubsection",
 CellChangeTimes->{{3.634864892115471*^9, 3.634864905364229*^9}, {
  3.635015784050548*^9, 3.6350157877205534`*^9}}],

Cell["\<\
The reactions are classic. Note that we have two sets, one for each hybrid \
(h1 and h2). We also have competition with accumulated amplicons.\
\>", "Text",
 CellChangeTimes->{{3.634864909003437*^9, 3.6348649620914736`*^9}, {
  3.63501579987157*^9, 3.635015857317651*^9}}],

Cell["\<\
Here, we compute the extension step by solving the Michaelis Menton \
differential equations from first principles. The actual differential \
equations were computed above.\
\>", "Text",
 CellChangeTimes->{{3.6348468008757114`*^9, 3.634846840818996*^9}, {
  3.6348524023640985`*^9, 3.634852406276322*^9}, {3.6348649881309633`*^9, 
  3.634865002667794*^9}}],

Cell[BoxData[
 RowBox[{"extensionMichaelisMentionDiffEqs", " ", "//", " ", 
  "ColumnForm"}]], "Input",
 CellChangeTimes->{{3.6355378756266546`*^9, 3.635537878837659*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"extensionStepMichaelisMention", "[", 
    RowBox[{"annealingOutput_", ",", "constants_", ",", " ", 
     RowBox[{"options_:", " ", 
      RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
      "\[Tau]Extension", ",", " ", "inits", ",", " ", "diffeqs", ",", " ", 
       RowBox[{"(*", 
        RowBox[{"eqns", ",", " ", "soln", ","}], "*)"}], " ", "result", ",", 
       " ", "h1Start", ",", " ", "h2Start", ",", " ", "endOf", ",", 
       "extEfficiency"}], " ", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Tau]Extension", " ", "=", " ", 
       RowBox[{"\[Tau]ext", " ", "//.", " ", "constants"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"diffeqs", " ", "=", " ", "extensionMichaelisMentionDiffEqs"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"h1Start", " ", "=", " ", 
       RowBox[{"readState", "[", 
        RowBox[{"annealingOutput", ",", " ", "h1"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"h2Start", " ", "=", " ", 
       RowBox[{"readState", "[", 
        RowBox[{"annealingOutput", ",", " ", "h2"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"inits", " ", "=", " ", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"h1", "[", "0", "]"}], " ", "\[Equal]", " ", "h1Start"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"h2", "[", "0", "]"}], " ", "\[Equal]", " ", "h2Start"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"e", "[", "0", "]"}], " ", "\[Equal]", " ", 
          RowBox[{"readState", "[", 
           RowBox[{"annealingOutput", ",", "e"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"eh1", "[", "0", "]"}], " ", "\[Equal]", " ", 
          RowBox[{"readState", "[", 
           RowBox[{"annealingOutput", ",", "eh1"}], "]"}]}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"eh2", "[", "0", "]"}], " ", "\[Equal]", " ", 
          RowBox[{"readState", "[", 
           RowBox[{"annealingOutput", ",", "eh2"}], "]"}]}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"u", "[", "0", "]"}], " ", "\[Equal]", " ", 
          RowBox[{"readState", "[", 
           RowBox[{"annealingOutput", ",", " ", "u"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"d", "[", "0", "]"}], " ", "\[Equal]", " ", 
          RowBox[{"readState", "[", 
           RowBox[{"annealingOutput", ",", " ", "d"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"eu", "[", "0", "]"}], " ", "\[Equal]", " ", 
          RowBox[{"readState", "[", 
           RowBox[{"annealingOutput", ",", "eu"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ed", "[", "0", "]"}], " ", "\[Equal]", " ", 
          RowBox[{"readState", "[", 
           RowBox[{"annealingOutput", ",", " ", "ed"}], "]"}]}]}], 
        "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"result", " ", "=", " ", 
       RowBox[{"ndRun", "[", 
        RowBox[{
        "diffeqs", ",", " ", "\[Tau]Extension", ",", " ", "constants", ",", 
         " ", "inits"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"endOf", "[", "sym_", "]"}], " ", ":=", " ", 
       RowBox[{"sym", " ", "/.", " ", "result"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"eqns", " ", "=", " ", 
         RowBox[{"diffeqs", " ", "~", "Join", "~", " ", "inits"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"soln", " ", "=", " ", 
         RowBox[{
          RowBox[{"NDSolve", "[", 
           RowBox[{
            RowBox[{"eqns", " ", "//.", " ", "constants"}], ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "\[Tau]", "]"}], "&"}], " ", "/@", " ", 
             RowBox[{"{", 
              RowBox[{
              "h1", ",", " ", "h2", ",", " ", "eh1", ",", " ", "eh2", ",", 
               " ", "e", ",", " ", "u", ",", " ", "d", ",", " ", "eu", ",", 
               " ", "ed"}], "}"}]}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"\[Tau]", ",", " ", "0", ",", " ", "\[Tau]Extension"}], 
             "}"}], ",", " ", "\[IndentingNewLine]", 
            RowBox[{"AccuracyGoal", "\[Rule]", "MachinePrecision"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PrecisionGoal", "\[Rule]", "MachinePrecision"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"MaxStepFraction", "\[Rule]", ".001"}]}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"endOf", "[", "sym_", "]"}], " ", ":=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"sym", "[", "\[Tau]", "]"}], " ", "/.", " ", "soln"}], " ",
           "/.", " ", 
          RowBox[{"\[Tau]", " ", "\[Rule]", " ", "\[Tau]Extension"}]}]}], 
        ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Our", " ", "extension", " ", "efficiency", " ", "is", " ", "the", " ",
         "fraction", " ", "of", " ", "the", " ", "hybrids", " ", "that", " ", 
        "got", " ", "converted", " ", "during", " ", "the", " ", 
        "extension"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"extEfficiency", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"h1Start", " ", "+", " ", "h2Start"}], ")"}], " ", "-", 
           " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"endOf", "[", "h1", "]"}], " ", "+", " ", 
             RowBox[{"endOf", "[", "h2", "]"}]}], ")"}]}], ")"}], " ", "/", 
         " ", 
         RowBox[{"(", 
          RowBox[{"h1Start", " ", "+", " ", "h2Start"}], ")"}]}], " ", "//", 
        " ", "Quiet"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"extEfficiency", "\[Equal]", "Indeterminate"}], ",", " ", 
        RowBox[{"extEfficiency", "=", "0"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"preempt", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"h1", " ", "\[Rule]", " ", 
            RowBox[{"endOf", "[", "h1", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"h2", " ", "\[Rule]", " ", 
            RowBox[{"endOf", "[", "h2", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"e", " ", "\[Rule]", " ", 
            RowBox[{"endOf", "[", "e", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"eh1", "\[Rule]", " ", 
            RowBox[{"endOf", "[", "eh1", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"eh2", " ", "\[Rule]", " ", 
            RowBox[{"endOf", "[", "eh2", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"u", " ", "\[Rule]", " ", 
            RowBox[{"endOf", "[", "u", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"d", "\[Rule]", " ", 
            RowBox[{"endOf", "[", "d", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"eu", " ", "\[Rule]", " ", 
            RowBox[{"endOf", "[", "eu", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"ed", " ", "\[Rule]", " ", 
            RowBox[{"endOf", "[", "ed", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"\[Epsilon]Ext", " ", "\[Rule]", " ", "extEfficiency"}]}], 
          "\[IndentingNewLine]", "}"}], ",", "annealingOutput"}], "]"}], " ", 
       "//", " ", "makeState"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"extensionStepMichaelisMention", "[", 
   RowBox[{
    RowBox[{"annealKinetic", "[", 
     RowBox[{
      RowBox[{"state0", "[", "]"}], ",", " ", "constants"}], "]"}], ",", " ", 
    "constants"}], "]"}], " "}]}], "Input",
 CellChangeTimes->{{3.6348498236396036`*^9, 3.634849830030969*^9}, {
   3.6348498939916277`*^9, 3.6348502687180605`*^9}, {3.634850368797785*^9, 
   3.6348503738450737`*^9}, 3.634850524348682*^9, {3.6348510171448684`*^9, 
   3.6348510486566706`*^9}, {3.6348510844087152`*^9, 
   3.6348511596160173`*^9}, {3.6348512242047114`*^9, 
   3.6348512527253428`*^9}, {3.6348516730593843`*^9, 3.6348517221541924`*^9}, 
   3.634851823288977*^9, {3.6348518686485715`*^9, 3.634851921193577*^9}, {
   3.634851977234782*^9, 3.634851981411021*^9}, {3.6348521347857933`*^9, 
   3.634852142208218*^9}, {3.634852295709998*^9, 3.634852343734745*^9}, {
   3.634853025120718*^9, 3.6348532620392685`*^9}, 3.634853378535932*^9, {
   3.634853783126073*^9, 3.6348537872693105`*^9}, {3.6348538652097683`*^9, 
   3.634853928490388*^9}, {3.6348539683646684`*^9, 3.6348539753540683`*^9}, {
   3.634854036182547*^9, 3.6348540508153844`*^9}, {3.6348540828822184`*^9, 
   3.634854104714467*^9}, {3.634854148985999*^9, 3.63485416140971*^9}, {
   3.634854390863834*^9, 3.634854403998585*^9}, {3.634854466896183*^9, 
   3.634854732486374*^9}, {3.6348548090617533`*^9, 3.634854887342231*^9}, {
   3.6348608721965446`*^9, 3.63486092071332*^9}, {3.634860979906706*^9, 
   3.63486107387508*^9}, {3.6348611098821397`*^9, 3.6348611616421003`*^9}, {
   3.634861684935031*^9, 3.634861782803629*^9}, {3.634861832370464*^9, 
   3.6348619093018637`*^9}, {3.634862498913588*^9, 3.634862502605799*^9}, {
   3.6348634089786406`*^9, 3.6348634788956394`*^9}, {3.634863542922302*^9, 
   3.634863630626318*^9}, {3.634863663775214*^9, 3.6348638887570825`*^9}, {
   3.634864239645152*^9, 3.6348642421172934`*^9}, {3.634864339661873*^9, 
   3.6348643399578896`*^9}, {3.6349206853311353`*^9, 
   3.6349206989343596`*^9}, {3.634921159864581*^9, 3.634921183732623*^9}, {
   3.6350159641778016`*^9, 3.635015985081831*^9}, {3.6350160610289383`*^9, 
   3.6350160612389383`*^9}, {3.6350178283740005`*^9, 3.635017837367013*^9}, {
   3.635018401748808*^9, 3.6350184107198205`*^9}, {3.6350185728080487`*^9, 
   3.635018596729082*^9}, {3.6350222369601183`*^9, 3.6350222402517242`*^9}, {
   3.6350222847742023`*^9, 3.635022284961403*^9}, 3.635027418840468*^9, {
   3.635027580957741*^9, 3.635027593917482*^9}, {3.63502768549372*^9, 
   3.6350276856447287`*^9}, {3.635095977930824*^9, 3.6350959861382933`*^9}, {
   3.635102152631996*^9, 3.635102187728004*^9}, {3.6351292971285725`*^9, 
   3.6351293096482887`*^9}, 3.635129879675893*^9, {3.635129944372593*^9, 
   3.6351299610035443`*^9}, {3.635132119460001*^9, 3.635132163356512*^9}, {
   3.6351736923891277`*^9, 3.6351737367098055`*^9}, {3.63519655490908*^9, 
   3.63519660036868*^9}, {3.635196635320679*^9, 3.6351967592717686`*^9}, {
   3.6351967948798056`*^9, 3.6351967951358204`*^9}, {3.6351968921593695`*^9, 
   3.6351970789170513`*^9}, {3.635197283459751*^9, 3.635197304658963*^9}, {
   3.6351999570166693`*^9, 3.6351999934167514`*^9}, {3.63521624239814*^9, 
   3.6352162638263655`*^9}, {3.6353865788949842`*^9, 3.635386603829019*^9}, {
   3.635537268219299*^9, 3.6355372919533324`*^9}, {3.635537905301696*^9, 
   3.6355379428357487`*^9}, {3.661960879412616*^9, 3.661960906805546*^9}, {
   3.661960947969154*^9, 3.6619609904744453`*^9}, {3.6624138627668395`*^9, 
   3.6624138653234825`*^9}, {3.662414034157668*^9, 3.662414035787851*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Denaturing Model", "Subsection",
 CellChangeTimes->{{3.6351731556277966`*^9, 3.6351731594966035`*^9}}],

Cell["\<\
We explicitly model the denaturing by breaking apart all DNA complexes and \
disassociating the enzyme from anything it might be attached to. We also \
account for enzyme degredation.\
\>", "Text",
 CellChangeTimes->{{3.6351975304138756`*^9, 3.6351975738773613`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"denature", "[", 
   RowBox[{"state_", ",", " ", "constants_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "enzymeDegredation", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"enzymeDegredation", " ", "=", " ", 
      RowBox[{"Switch", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Symbol", "[", "\"\<enzymeDegredation\>\"", "]"}], " ", "//.",
          " ", "constants"}], ",", " ", "\[IndentingNewLine]", "none", ",", 
        " ", "1", ",", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"no", " ", "degredation"}], " ", "*)"}], 
        "\[IndentingNewLine]", "eqn26", ",", 
        RowBox[{
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "kdeg"}], " ", "/", " ", "\[Tau]den"}], "]"}], " ", "//.",
          " ", "constants"}], ",", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"eqn", " ", "26"}], " ", "*)"}], "\[IndentingNewLine]", 
        "eqn27", ",", " ", "0.9990"}], " ", 
       RowBox[{"(*", " ", 
        RowBox[{"eqn", " ", "27"}], " ", "*)"}], "\[IndentingNewLine]", 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"preempt", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"p1", " ", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", " ", "p1"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", "h1"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", " ", "eh1"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", " ", "d"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", "ed"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"p2", " ", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", " ", "p2"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", "h2"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", " ", "eh2"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", " ", "d"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", "ed"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"t1", " ", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", "t1"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", "u"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", "eu"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", " ", "h1"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", "eh1"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"t2", " ", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", "t2"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", "u"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", "eu"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", " ", "h2"}], "]"}], " ", "+", " ", 
            RowBox[{"readState", "[", 
             RowBox[{"state", ",", "eh2"}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"e", " ", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"readState", "[", 
               RowBox[{"state", ",", "e"}], "]"}], " ", "+", " ", 
              RowBox[{"readState", "[", 
               RowBox[{"state", ",", " ", "eh1"}], "]"}], " ", "+", " ", 
              RowBox[{"readState", "[", 
               RowBox[{"state", ",", "eh2"}], "]"}], " ", "+", " ", 
              RowBox[{"readState", "[", 
               RowBox[{"state", ",", "eu"}], "]"}], " ", "+", " ", 
              RowBox[{"readState", "[", 
               RowBox[{"state", ",", " ", "ed"}], "]"}]}], ")"}], " ", "*", 
            " ", "enzymeDegredation"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"h1", " ", "\[Rule]", " ", "0"}], ",", 
          RowBox[{"h2", " ", "\[Rule]", " ", "0"}], ",", 
          RowBox[{"d", "\[Rule]", " ", "0"}], ",", 
          RowBox[{"u", " ", "\[Rule]", " ", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{"eu", " ", "\[Rule]", " ", "0"}], ",", 
          RowBox[{"ed", "\[Rule]", " ", "0"}], ",", " ", 
          RowBox[{"eh1", " ", "\[Rule]", " ", "0"}], ",", " ", 
          RowBox[{"eh2", " ", "\[Rule]", " ", "0"}]}], "\[IndentingNewLine]", 
         "}"}], ",", "state"}], "]"}], " ", "//", "makeState"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"denature", "[", 
  RowBox[{
   RowBox[{"extensionStepMichaelisMention", "[", 
    RowBox[{
     RowBox[{"annealKinetic", "[", 
      RowBox[{
       RowBox[{"state0", "[", "]"}], ",", " ", "constants"}], "]"}], ",", " ",
      "constants"}], "]"}], ",", " ", "constants"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"#", " ", "\[Rule]", " ", 
    RowBox[{"(", 
     RowBox[{"#", " ", "/.", " ", "%"}], ")"}]}], " ", "&"}], " ", "/@", " ", 
  "stateVariables"}]}], "Input",
 CellChangeTimes->{{3.6351301480482426`*^9, 3.6351304103332443`*^9}, {
   3.6351731993546734`*^9, 3.635173262877985*^9}, {3.6351973800252743`*^9, 
   3.6351975140489397`*^9}, {3.635197591752384*^9, 3.6351975933844776`*^9}, {
   3.6351976406641817`*^9, 3.6351976749281416`*^9}, 3.6351978759506392`*^9, {
   3.6351984838024063`*^9, 3.635198484306435*^9}, {3.635198607313471*^9, 
   3.635198614888904*^9}, {3.635514973460596*^9, 3.6355149901726193`*^9}, {
   3.6355150221756644`*^9, 3.635515039637689*^9}, {3.63553729736434*^9, 
   3.6355374084634967`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Runs", "Subsection",
 CellChangeTimes->{{3.634489357213402*^9, 3.6344893579134035`*^9}, {
  3.634489456113541*^9, 3.6344894591635456`*^9}, {3.634489492936593*^9, 
  3.634489493266593*^9}, {3.6345021102002783`*^9, 3.634502115791286*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"run", "[", "n_", "]"}], " ", ":=", " ", 
  RowBox[{"run", "[", 
   RowBox[{"n", ",", 
    RowBox[{"state0", "[", "]"}], ",", " ", "annealKinetic", ",", " ", 
    "extensionStepMichaelisMention", ",", " ", "constants"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"run", "[", 
   RowBox[{
   "n_", ",", " ", "initialState_", ",", " ", "annealStep_", ",", " ", 
    "extnStep_", ",", " ", "constants_", ",", " ", 
    RowBox[{"options_:", " ", 
     RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "results", ",", " ", "step", ",", " ", "cycle", ",", " ", 
      "denaturedCycleInput", ",", " ", "annealOutput", ",", " ", 
      "extensionOutput", ",", " ", "denaturedExtensionOutput"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"results", " ", "=", " ", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"denaturedCycleInput", " ", "=", " ", 
      RowBox[{"denature", "[", 
       RowBox[{"initialState", ",", " ", "constants"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"cycle", " ", "=", " ", "0"}], ",", " ", 
       RowBox[{"cycle", " ", "<", " ", "n"}], ",", " ", 
       RowBox[{"cycle", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"annealOutput", " ", "=", " ", 
         RowBox[{"annealStep", "[", 
          RowBox[{
          "denaturedCycleInput", ",", " ", "constants", ",", " ", "options"}],
           "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"extensionOutput", " ", "=", " ", 
         RowBox[{"extnStep", "[", 
          RowBox[{
          "annealOutput", ",", " ", "constants", ",", " ", "options"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"denaturedExtensionOutput", " ", "=", " ", 
         RowBox[{"denature", "[", 
          RowBox[{"extensionOutput", ",", " ", "constants"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"results", " ", "=", " ", 
         RowBox[{"results", " ", "~", "Join", "~", " ", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"Join", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"t1Start", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"denaturedCycleInput", ",", " ", "t1Start"}], 
                 "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"t1Start", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"denaturedCycleInput", ",", " ", "t2Start"}], 
                 "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"eTC", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"denaturedCycleInput", ",", " ", "e"}], "]"}]}], ",",
                "\[IndentingNewLine]", 
               RowBox[{"p1TC", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"denaturedCycleInput", ",", " ", "p1"}], "]"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"p2TC", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"denaturedCycleInput", ",", " ", "p2"}], "]"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"t1TC", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"denaturedCycleInput", ",", " ", "t1"}], "]"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"t2TC", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"denaturedCycleInput", ",", " ", "t2"}], "]"}]}], 
               ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"eT", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"denaturedExtensionOutput", ",", " ", "e"}], "]"}]}],
                ",", "\[IndentingNewLine]", 
               RowBox[{"p1T", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"denaturedExtensionOutput", ",", " ", "p1"}], 
                 "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"p2T", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"denaturedExtensionOutput", ",", " ", "p2"}], 
                 "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"t1T", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"denaturedExtensionOutput", ",", " ", "t1"}], 
                 "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"t2T", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"denaturedExtensionOutput", ",", " ", "t2"}], 
                 "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"p1A", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"annealOutput", ",", " ", "p1"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"p2A", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"annealOutput", ",", " ", "p2"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"t1A", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"annealOutput", ",", " ", "t1"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"t2A", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"annealOutput", ",", " ", "t2"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"h1A", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"annealOutput", ",", " ", "h1"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"h2A", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"annealOutput", ",", " ", "h2"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"dA", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"annealOutput", ",", " ", "d"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"uA", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"annealOutput", ",", " ", "u"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"euA", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"annealOutput", ",", " ", "eu"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"edA", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"annealOutput", ",", " ", "ed"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"eh1A", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"annealOutput", ",", " ", "eh1"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"eh2A", " ", "\[Rule]", " ", 
                RowBox[{"readState", "[", 
                 RowBox[{"annealOutput", ",", " ", "eh2"}], "]"}]}]}], 
              "\[IndentingNewLine]", "}"}], ",", " ", "\[IndentingNewLine]", 
             "extensionOutput"}], "\[IndentingNewLine]", "]"}], "}"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{
        "denaturedCycleInput", " ", "=", " ", "denaturedExtensionOutput"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "results"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"customGraphVariables", " ", "=", " ", 
   RowBox[{"{", " ", "\[IndentingNewLine]", 
    RowBox[{
    "eTC", ",", " ", "p1TC", ",", " ", "p2TC", ",", " ", "t1TC", ",", " ", 
     "t2TC", ",", " ", "eT", ",", " ", "p1T", ",", " ", "p2T", ",", " ", 
     "t1T", ",", " ", "t2T", ",", " ", "\[IndentingNewLine]", "p1", ",", " ", 
     "p2", ",", " ", "h1", ",", " ", "h2", ",", " ", "t1", ",", " ", "t2", 
     ",", " ", "d", ",", " ", "u", ",", " ", "e", ",", " ", "eu", ",", " ", 
     "ed", ",", " ", "eh1", ",", " ", "eh2", ",", " ", "\[IndentingNewLine]", 
     "p1A", ",", " ", "p2A", ",", " ", "h1A", ",", " ", "h2A", ",", " ", 
     "t1A", ",", " ", "t2A", ",", " ", "dA", ",", " ", "uA", ",", " ", "eA", 
     ",", " ", "euA", ",", " ", "eh1A", ",", " ", "eh2A", ",", 
     "\[IndentingNewLine]", "t1Start", ",", " ", "t2Start"}], 
    "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"run", "[", 
   RowBox[{"3", ",", " ", 
    RowBox[{"state0", "[", "]"}], ",", " ", "annealEquilibrium", ",", " ", 
    "extensionStepGevertz", ",", " ", "constants"}], "]"}], " ", "//", " ", 
  "ColumnForm"}]}], "Input",
 CellChangeTimes->{{3.6344897427412467`*^9, 3.6344897939463186`*^9}, {
   3.634489832180372*^9, 3.6344899027894726`*^9}, {3.6344904229462466`*^9, 
   3.6344904440102763`*^9}, {3.634490694078628*^9, 3.634490694128628*^9}, 
   3.6344923060818996`*^9, {3.6344930694563303`*^9, 3.634493072376334*^9}, {
   3.6344947037841873`*^9, 3.634494704654188*^9}, {3.634495722789177*^9, 
   3.6344957229891777`*^9}, 3.6345021268023014`*^9, {3.634502322783579*^9, 
   3.6345023538266225`*^9}, {3.634502395622681*^9, 3.634502403763693*^9}, 
   3.634502443728749*^9, {3.634502783250253*^9, 3.6345030890926833`*^9}, {
   3.63450315045177*^9, 3.6345032837869573`*^9}, {3.634503332752026*^9, 
   3.6345033360120306`*^9}, {3.6345033732652035`*^9, 
   3.6345033828162165`*^9}, {3.634503493887373*^9, 3.634503590837509*^9}, {
   3.634503626500559*^9, 3.634503703277667*^9}, {3.634503821538932*^9, 
   3.634503959212125*^9}, {3.634504073363285*^9, 3.634504095435316*^9}, {
   3.6345041542333994`*^9, 3.6345042371315155`*^9}, {3.6345042728265657`*^9, 
   3.6345042752775693`*^9}, {3.6345077118691683`*^9, 3.634507713278249*^9}, {
   3.63457304816667*^9, 3.634573074068706*^9}, {3.634573110012757*^9, 
   3.6345731690978394`*^9}, {3.6345732018008857`*^9, 3.634573234706932*^9}, {
   3.63457333579365*^9, 3.6345733393936553`*^9}, {3.6345755927124014`*^9, 
   3.6345756126244297`*^9}, {3.6345757314075966`*^9, 3.634575826789731*^9}, {
   3.634577663848383*^9, 3.6345776649683847`*^9}, {3.6346567345498314`*^9, 
   3.6346567349198313`*^9}, {3.6346679261168985`*^9, 3.6346679331873035`*^9}, 
   3.6348465482792635`*^9, 3.634846768223844*^9, {3.6348476385046215`*^9, 
   3.6348476396486864`*^9}, {3.6348625361117153`*^9, 3.634862552839672*^9}, {
   3.634862589252755*^9, 3.634862846964495*^9}, {3.634862995011963*^9, 
   3.6348630171552296`*^9}, {3.6348639781171937`*^9, 
   3.6348640534745035`*^9}, {3.634920956085211*^9, 3.634920990951272*^9}, {
   3.634921045270568*^9, 3.6349210518537793`*^9}, {3.635022454674101*^9, 
   3.635022469774927*^9}, {3.635023334484446*^9, 3.6350233769321203`*^9}, 
   3.635023617375343*^9, 3.6350238404557347`*^9, {3.6350958802252355`*^9, 
   3.635095885689548*^9}, {3.6350959428808193`*^9, 3.635095943664864*^9}, {
   3.6350960040403175`*^9, 3.6350960051043777`*^9}, {3.6351304742128983`*^9, 
   3.635130570612412*^9}, 3.6351737589242444`*^9, {3.635174882949403*^9, 
   3.6351749130730557`*^9}, {3.635197905269316*^9, 3.6351979090535326`*^9}, {
   3.6351979429874735`*^9, 3.635197954499132*^9}, {3.6351980048080096`*^9, 
   3.6351980319485617`*^9}, {3.635198394091275*^9, 3.6351984243680067`*^9}, {
   3.6351984996553135`*^9, 3.63519850222346*^9}, {3.6351986564562817`*^9, 
   3.635198658223383*^9}, {3.635198782286479*^9, 3.6351988859424076`*^9}, {
   3.635198922038472*^9, 3.6351991369487643`*^9}, {3.635199392715393*^9, 
   3.635199452642821*^9}, {3.635199559833952*^9, 3.6351995817142034`*^9}, {
   3.6352096441247406`*^9, 3.6352097248983603`*^9}, {3.635211426750701*^9, 
   3.6352114379113393`*^9}, {3.6352126111424437`*^9, 
   3.6352126194949217`*^9}, {3.6352139055074778`*^9, 
   3.6352139458287835`*^9}, {3.635213995274612*^9, 3.635213995634632*^9}, 
   3.6352158579251494`*^9, {3.6354745896096945`*^9, 3.6354746691888065`*^9}, {
   3.6354747048018565`*^9, 3.635474718643876*^9}, {3.635474754137926*^9, 
   3.635474786020971*^9}, {3.6354748492580595`*^9, 3.6354749574012117`*^9}, 
   3.635529059006604*^9, {3.6355290973106585`*^9, 3.6355293222059746`*^9}, {
   3.635529359450027*^9, 3.635529365071035*^9}, {3.6355294258691206`*^9, 
   3.63552946089217*^9}, {3.6355295984058886`*^9, 3.635529610017905*^9}, {
   3.635537435733035*^9, 3.635537454125061*^9}, {3.63554693362728*^9, 
   3.635546988553357*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Output", "Subsection",
 CellChangeTimes->{{3.6345021054802713`*^9, 3.634502106360273*^9}, {
  3.6348525902588453`*^9, 3.6348525927309866`*^9}}],

Cell[CellGroupData[{

Cell["Plotting", "Subsubsection",
 CellChangeTimes->{{3.6345024118447037`*^9, 3.6345024135247064`*^9}}],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{"http", ":"}], "//", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"stackoverflow", ".", "com"}], "/", "questions"}], "/", 
      "9207569"}], "/", "wolfram"}], "-", "mathematica", "-", "y", "-", 
    "axis", "-", "frame", "-", "labels", "-", "are", "-", "not", "-", 
    "aligned"}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.634737425065493*^9, 3.6347374275926375`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotRuns", "[", 
   RowBox[{"runs_", ",", " ", "constants_", ",", " ", "renderOptionsIn_"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "customGraph", ",", " ", "targetConcentrations", ",", " ", "plot", ",", 
      " ", "floor", ",", " ", "visualFloor", ",", " ", "ceil", ",", " ", 
      "max", ",", " ", "color", ",", " ", "legend", ",", " ", "row", ",", " ",
       "rows", ",", " ", "norow", ",", " ", "renderOptions"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"renderOptions", " ", "=", " ", 
      RowBox[{"preempt", "[", 
       RowBox[{"renderOptionsIn", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"showU", " ", "\[Rule]", " ", "False"}], ",", " ", 
          RowBox[{"useLinearPlots", "\[Rule]", " ", "False"}], ",", "  ", 
          RowBox[{"showExtraPlots", " ", "\[Rule]", " ", "False"}], ",", " ", 
          RowBox[{"useCustomGraphs", " ", "\[Rule]", " ", "False"}]}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"targetConcentrations", " ", "=", " ", 
      RowBox[{
       RowBox[{"Symbol", "[", "\"\<targetConcentrations\>\"", "]"}], " ", "//.",
        " ", "renderOptions"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Options", "[", "plot", "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"plotFunc", " ", "\[Rule]", " ", "ListLogPlot"}], ",", " ", 
         RowBox[{"labels", " ", "\[Rule]", " ", 
          RowBox[{"{", 
           RowBox[{"\"\<\>\"", ",", "\"\<\>\""}], "}"}]}], ",", " ", 
         RowBox[{"imageLeftPadding", " ", "\[Rule]", " ", "0"}]}], "}"}], " ",
        "~", "Join", "~", " ", 
       RowBox[{"Options", "[", "ListLogPlot", "]"}], " ", "~", "Join", "~", 
       " ", 
       RowBox[{"Options", "[", "ListPlot", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"plot", "[", 
       RowBox[{"what_", ",", " ", 
        RowBox[{"opts", " ", ":", " ", 
         RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"plotter", ",", " ", "plotOpts"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"plotter", " ", "=", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"useLinearPlots", " ", "//.", " ", "renderOptions"}], ",",
             " ", "ListPlot", ",", " ", 
            RowBox[{"OptionValue", "[", "plotFunc", "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"plotOpts", " ", "=", " ", 
          RowBox[{
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", "opts", "}"}], ",", " ", 
             RowBox[{"Options", "[", "plotter", "]"}]}], "]"}], " ", 
           "\[IndentingNewLine]", "~", "Join", "~", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"FrameLabel", " ", "\[Rule]", " ", 
              RowBox[{"OptionValue", "[", "labels", "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", " ", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{
               "True", ",", " ", "True", ",", " ", "True", ",", " ", "True"}],
                "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", " ", "Medium"}], ",", " ", 
             "\[IndentingNewLine]", 
             RowBox[{"ImagePadding", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"51", " ", "+", " ", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    "useLinearPlots", " ", "//.", " ", "renderOptions"}], ",",
                     "15", ",", "0"}], "]"}], " ", "+", " ", 
                   RowBox[{"OptionValue", "[", "imageLeftPadding", "]"}]}], 
                  ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"45", ",", "0"}], "}"}]}], "}"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Ticks", " ", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"Automatic", ",", " ", "Automatic"}], "}"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"GridLines", " ", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Range", "[", 
                 RowBox[{"0", ",", "100", ",", "5"}], "]"}], ",", " ", 
                RowBox[{"{", "0", "}"}]}], "}"}]}]}], "}"}]}]}], " ", ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Show", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"plotter", "[", 
            RowBox[{"what", ",", " ", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", "plotOpts"}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"plotter", "[", "what", "]"}]}], "\[IndentingNewLine]", 
          "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"floor", " ", "=", " ", 
      RowBox[{"10", "^", 
       RowBox[{"-", "20"}]}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{
      "roughly", " ", "a", " ", "copy", " ", "count", " ", "of", " ", "1", 
       " ", "in", " ", "25", " ", "uL"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"visualFloor", " ", "=", " ", 
      RowBox[{"10", "^", 
       RowBox[{"-", "10.5"}]}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{
      "roughly", " ", "what", " ", "can", " ", "be", " ", "measured", " ", 
       "in", " ", "fluoresence"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"max", " ", "=", " ", 
      RowBox[{"Max", " ", "@@", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "//.", "constants"}], "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{"p1Start", ",", " ", "p2Start"}], "}"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ceil", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"useLinearPlots", " ", "//.", " ", "renderOptions"}], ",", 
        " ", 
        RowBox[{"max", " ", "*", " ", "1.05"}], ",", " ", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Log", "[", 
            RowBox[{"10", ",", " ", "max"}], "]"}], " ", "+", " ", "0.5"}], 
          ")"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"customGraph", "[", "expr_", "]"}], " ", ":=", " ", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"vars", ",", " ", "fn"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fn", " ", "=", " ", 
          RowBox[{"Function", "[", 
           RowBox[{"state", ",", " ", 
            RowBox[{"ReleaseHold", "[", 
             RowBox[{
              RowBox[{"expr", " ", "/.", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#", " ", "\[Rule]", " ", 
                    RowBox[{"readState", "[", 
                    RowBox[{"state", ",", " ", "#"}], "]"}]}], ")"}], " ", 
                  "&"}], " ", "/@", " ", "customGraphVariables"}], ")"}]}], 
              " ", "/.", " ", "constants"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"plot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Function", "[", 
             RowBox[{"run", ",", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"fn", "[", "#", "]"}], " ", "&"}], " ", "/@", " ", 
               "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"labels", "\[Rule]", " ", 
            RowBox[{"{", 
             RowBox[{"\"\<cycle\>\"", ",", " ", 
              RowBox[{"ToString", "[", 
               RowBox[{
                RowBox[{"expr", "//", " ", "ReleaseHold"}], ",", " ", 
                "InputForm"}], "]"}]}], "}"}]}]}], "\[IndentingNewLine]", 
          "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"color", " ", "=", " ", 
      RowBox[{"ColorData", "[", "97", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"legend", " ", "=", " ", 
      RowBox[{"PointLegend", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"color", "[", "#", "]"}], " ", "&"}], "/@", " ", 
         RowBox[{"Range", "[", 
          RowBox[{"1", ",", 
           RowBox[{"Length", "[", "targetConcentrations", "]"}]}], "]"}]}], 
        ",", 
        RowBox[{"N", "[", "targetConcentrations", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"LegendFunction", "\[Rule]", " ", "Framed"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
        "LegendLabel", "\[Rule]", "\"\<initial target concentrations:\>\""}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"LegendLayout", " ", "\[Rule]", " ", 
         RowBox[{"{", 
          RowBox[{"\"\<Row\>\"", ",", " ", "1"}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"row", "[", "list_List", "]"}], " ", ":=", " ", "list"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"row", "[", 
       RowBox[{"condition_", ",", " ", "list_List"}], "]"}], " ", ":=", " ", 
      RowBox[{"If", "[", 
       RowBox[{"condition", ",", " ", "list", ",", " ", "norow"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"rows", " ", "=", " ", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"legend", ",", "\[IndentingNewLine]", "SpanFromLeft"}], 
         "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"row", "[", 
         RowBox[{
          RowBox[{"useCustomGraphs", " ", "//.", " ", "renderOptions"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"customGraph", "[", 
             RowBox[{"customGraphExpr1", " ", "//.", " ", "renderOptions"}], 
             "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"customGraph", "[", 
             RowBox[{"customGraphExpr2", " ", "//.", " ", "renderOptions"}], 
             "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"customGraph", "[", 
             RowBox[{"customGraphExpr3", " ", "//.", " ", "renderOptions"}], 
             "]"}]}], "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{"run", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"readState", "[", 
                  RowBox[{"#", ",", "t1T"}], "]"}], " ", "&"}], " ", "/@", 
                " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"labels", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{
              "\"\<cycle\>\"", ",", " ", "\"\<total [t1] after ext'n\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotRange", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"visualFloor", ",", " ", "ceil"}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AxesOrigin", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", 
               RowBox[{"10", "^", 
                RowBox[{"-", "10.5"}]}]}], "}"}]}]}], " ", 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{"run", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"readState", "[", 
                  RowBox[{"#", ",", "t2T"}], "]"}], " ", "&"}], " ", "/@", 
                " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"labels", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{
              "\"\<cycle\>\"", ",", " ", "\"\<total [t2] after ext'n\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotRange", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"visualFloor", ",", " ", "ceil"}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AxesOrigin", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", 
               RowBox[{"10", "^", 
                RowBox[{"-", "10.5"}]}]}], "}"}]}]}], " ", 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"showU", " ", "//.", " ", "renderOptions"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"plot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{"run", ",", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "u"}], "]"}], " ", "+", " ", 
                    RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "eu"}], "]"}]}], "&"}], " ", "/@", " ", 
                  "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
              "\[IndentingNewLine]", 
              RowBox[{"labels", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                "\"\<cycle\>\"", ",", " ", 
                 "\"\<total [t1-t2 duplex] after ext'n\>\""}], "}"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotRange", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"visualFloor", ",", " ", "ceil"}], "}"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"AxesOrigin", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", 
                 RowBox[{"10", "^", 
                  RowBox[{"-", "10.5"}]}]}], "}"}]}]}], " ", 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            "\"\<\>\""}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{"run", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"readState", "[", 
                  RowBox[{"#", ",", "p1T"}], "]"}], " ", "&"}], " ", "/@", 
                " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"labels", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{
              "\"\<cycle\>\"", ",", " ", "\"\<total [p1] after ext'n\>\""}], 
              "}"}]}], ",", " ", "\[IndentingNewLine]", 
            RowBox[{"PlotRange", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"floor", ",", "ceil"}], "}"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{"run", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"readState", "[", 
                  RowBox[{"#", ",", "p2T"}], "]"}], " ", "&"}], " ", "/@", 
                " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"labels", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{
              "\"\<cycle\>\"", ",", " ", "\"\<total [p2] after ext'n\>\""}], 
              "}"}]}], ",", " ", "\[IndentingNewLine]", 
            RowBox[{"PlotRange", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"floor", ",", "ceil"}], "}"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"And", "[", 
             RowBox[{
              RowBox[{"showExtraPlots", " ", "//.", " ", "renderOptions"}], 
              ",", 
              RowBox[{"showU", " ", "//.", " ", "renderOptions"}]}], "]"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"plot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{"run", ",", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "uA"}], "]"}], " ", "+", " ", 
                    RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "euA"}], "]"}]}], "&"}], " ", "/@", " ",
                   "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
              "\[IndentingNewLine]", 
              RowBox[{"labels", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                "\"\<cycle\>\"", ",", " ", 
                 "\"\<[t1-t2 duplex] after anneal\>\""}], "}"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotRange", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"visualFloor", ",", " ", "ceil"}], "}"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"AxesOrigin", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", 
                 RowBox[{"10", "^", 
                  RowBox[{"-", "10.5"}]}]}], "}"}]}]}], " ", 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            "\"\<\>\""}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{"run", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"readState", "[", 
                  RowBox[{"#", ",", "h1A"}], "]"}], " ", "&"}], " ", "/@", 
                " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"labels", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{
              "\"\<cycle\>\"", ",", " ", "\"\<[h1] after anneal\>\""}], 
              "}"}]}], ",", " ", "\[IndentingNewLine]", 
            RowBox[{"PlotRange", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"floor", ",", "ceil"}], "}"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{"run", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"readState", "[", 
                  RowBox[{"#", ",", "h2A"}], "]"}], " ", "&"}], " ", "/@", 
                " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"labels", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{
              "\"\<cycle\>\"", ",", " ", "\"\<[h2] after anneal\>\""}], 
              "}"}]}], ",", " ", "\[IndentingNewLine]", 
            RowBox[{"PlotRange", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"floor", ",", "ceil"}], "}"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{"run", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"readState", "[", 
                   RowBox[{"#", ",", "h1A"}], "]"}], " ", "+", " ", 
                  RowBox[{"readState", "[", 
                   RowBox[{"#", ",", "h2A"}], "]"}]}], " ", "&"}], " ", "/@", 
                " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"labels", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{
              "\"\<cycle\>\"", ",", " ", 
               "\"\<sum of graphs to left (eqn 29)\>\""}], "}"}]}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotRange", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"floor", ",", "ceil"}], "}"}]}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"row", "[", 
         RowBox[{
          RowBox[{"showExtraPlots", " ", "//.", " ", "renderOptions"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"plot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{"run", ",", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "h1"}], "]"}], " ", "&"}], " ", "/@", 
                  " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
              "\[IndentingNewLine]", 
              RowBox[{"labels", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                "\"\<cycle\>\"", ",", " ", "\"\<[h1] after extension\>\""}], 
                "}"}]}], ",", " ", "\[IndentingNewLine]", 
              RowBox[{"PlotRange", " ", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"floor", ",", "ceil"}], "}"}]}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"plot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{"run", ",", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "h2"}], "]"}], " ", "&"}], " ", "/@", 
                  " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
              "\[IndentingNewLine]", 
              RowBox[{"labels", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                "\"\<cycle\>\"", ",", " ", "\"\<[h2] after extension\>\""}], 
                "}"}]}], ",", " ", "\[IndentingNewLine]", 
              RowBox[{"PlotRange", " ", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"floor", ",", "ceil"}], "}"}]}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"plot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{"run", ",", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "h1"}], "]"}], " ", "+", " ", 
                    RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "h2"}], "]"}]}], " ", "&"}], " ", "/@", 
                  " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
              "\[IndentingNewLine]", 
              RowBox[{"labels", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                "\"\<cycle\>\"", ",", " ", "\"\<sum of graphs to left\>\""}], 
                "}"}]}], ",", " ", "\[IndentingNewLine]", 
              RowBox[{"PlotRange", " ", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"floor", ",", "ceil"}], "}"}]}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}], 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"row", "[", 
         RowBox[{
          RowBox[{"showExtraPlots", " ", "//.", " ", "renderOptions"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"plot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{"run", ",", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "eh1"}], "]"}], " ", "&"}], " ", "/@", 
                  " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
              "\[IndentingNewLine]", 
              RowBox[{"labels", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                "\"\<cycle\>\"", ",", " ", 
                 "\"\<[poly-h1 complex] after extension\>\""}], "}"}]}], ",", 
              " ", "\[IndentingNewLine]", 
              RowBox[{"PlotRange", " ", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"floor", ",", "ceil"}], "}"}]}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"plot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{"run", ",", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "eh2"}], "]"}], " ", "&"}], " ", "/@", 
                  " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
              "\[IndentingNewLine]", 
              RowBox[{"labels", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                "\"\<cycle\>\"", ",", " ", 
                 "\"\<[poly-h2 complex] after extension\>\""}], "}"}]}], ",", 
              " ", "\[IndentingNewLine]", 
              RowBox[{"PlotRange", " ", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"floor", ",", "ceil"}], "}"}]}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"showU", " ", "//.", " ", "renderOptions"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"plot", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Function", "[", 
                  RowBox[{"run", ",", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "eu"}], "]"}], " ", "&"}], " ", "/@", 
                    " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ",
                 "\[IndentingNewLine]", 
                RowBox[{"labels", "\[Rule]", " ", 
                 RowBox[{"{", 
                  RowBox[{
                  "\"\<cycle\>\"", ",", " ", 
                   "\"\<[t1-t2-poly' complex] after extension\>\""}], "}"}]}],
                 ",", " ", "\[IndentingNewLine]", 
                RowBox[{"PlotRange", " ", "\[Rule]", " ", 
                 RowBox[{"{", 
                  RowBox[{"floor", ",", "ceil"}], "}"}]}]}], 
               "\[IndentingNewLine]", "]"}], ",", "\"\<\>\""}], "]"}]}], 
           "\[IndentingNewLine]", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{"run", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"readState", "[", 
                  RowBox[{"#", ",", "\[Epsilon]Ann"}], "]"}], " ", "&"}], " ",
                 "/@", " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", 
            " ", "\[IndentingNewLine]", 
            RowBox[{"plotFunc", " ", "\[Rule]", " ", "ListPlot"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"labels", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{
              "\"\<cycle\>\"", ",", " ", 
               "\"\<anneal efficiency (eqn 31)\>\""}], "}"}]}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotRange", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", "1.1"}], "}"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{"run", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"readState", "[", 
                  RowBox[{"#", ",", "\[Epsilon]Ext"}], "]"}], " ", "&"}], " ",
                 "/@", " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", 
            " ", "\[IndentingNewLine]", 
            RowBox[{"plotFunc", " ", "\[Rule]", " ", "ListPlot"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"labels", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{
              "\"\<cycle\>\"", ",", " ", 
               "\"\<extension efficiency (eqn 32)\>\""}], "}"}]}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotRange", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", "1.1"}], "}"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{"run", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"readState", "[", 
                   RowBox[{"#", ",", "\[Epsilon]Ann"}], "]"}], " ", "*", " ", 
                  RowBox[{"readState", "[", 
                   RowBox[{"#", ",", "\[Epsilon]Ext"}], "]"}]}], "&"}], " ", "/@",
                 " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"plotFunc", " ", "\[Rule]", " ", "ListPlot"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"labels", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{
              "\"\<cycle\>\"", ",", " ", 
               "\"\<overall efficiency (eqn 33)\>\""}], "}"}]}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotRange", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", "1.1"}], "}"}]}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{"run", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"readState", "[", 
                   RowBox[{"#", ",", "eT"}], "]"}], ")"}], " ", "&"}], " ", "/@",
                 " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"labels", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{
              "\"\<cycle\>\"", ",", " ", "\"\<total [polymerase]\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"plotFunc", " ", "\[Rule]", " ", "ListPlot"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"imageLeftPadding", "\[Rule]", " ", "20"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AxesOrigin", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", "0"}], "}"}]}]}], " ", 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"showU", " ", "//.", " ", "renderOptions"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"plot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{"run", ",", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "u"}], "]"}], " ", "+", " ", 
                    RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "eu"}], "]"}]}], ")"}], " ", "/", " ", 
                    RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "eT"}], "]"}]}], ")"}], " ", "&"}], " ",
                   "/@", " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",",
               " ", "\[IndentingNewLine]", 
              RowBox[{"labels", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                "\"\<cycle\>\"", ",", " ", 
                 "\"\<[t1-t2 complex] aft ext'n / total [poly']\>\""}], 
                "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"plotFunc", " ", "\[Rule]", " ", "ListPlot"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"AxesOrigin", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0"}], "}"}]}]}], " ", 
             "\[IndentingNewLine]", "]"}], ",", "\"\<\>\""}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"showU", " ", "//.", " ", "renderOptions"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"plot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{"run", ",", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "eu"}], "]"}], " ", "/", " ", 
                    RowBox[{"readState", "[", 
                    RowBox[{"#", ",", "eT"}], "]"}]}], ")"}], " ", "&"}], " ",
                   "/@", " ", "run"}]}], "]"}], " ", "/@", " ", "runs"}], ",",
               " ", "\[IndentingNewLine]", 
              RowBox[{"labels", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                "\"\<cycle\>\"", ",", " ", 
                 "\"\<[t1-t2-poly' plex] aft ext'n/total [poly']\>\""}], 
                "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"plotFunc", " ", "\[Rule]", " ", "ListPlot"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"AxesOrigin", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0"}], "}"}]}]}], " ", 
             "\[IndentingNewLine]", "]"}], ",", "\"\<\>\""}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"rows", " ", "=", " ", 
      RowBox[{"rows", " ", "/.", " ", 
       RowBox[{"norow", " ", "\[Rule]", " ", 
        RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Grid", "[", "rows", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.634502167796359*^9, 3.634502207421415*^9}, {
   3.634502276414513*^9, 3.634502279474518*^9}, {3.634504397071741*^9, 
   3.6345044593398285`*^9}, {3.6345088801919923`*^9, 
   3.6345088814880667`*^9}, {3.634573436680793*^9, 3.6345734390607967`*^9}, {
   3.6345736029060273`*^9, 3.6345737699512615`*^9}, {3.634573998671583*^9, 
   3.6345739989215837`*^9}, {3.634574042114644*^9, 3.6345740480256524`*^9}, {
   3.634574089698711*^9, 3.634574091808714*^9}, {3.634574121854757*^9, 
   3.6345741223047576`*^9}, {3.6345741793508377`*^9, 
   3.6345741797508383`*^9}, {3.6345743611320934`*^9, 
   3.6345743713031073`*^9}, {3.6345750774276094`*^9, 3.634575077987611*^9}, {
   3.634575108030653*^9, 3.634575109990656*^9}, {3.634575166035734*^9, 
   3.6345752584648643`*^9}, {3.634575875035799*^9, 3.6345759001078343`*^9}, {
   3.6345775085601635`*^9, 3.634577545893216*^9}, {3.6345820081910496`*^9, 
   3.634582131516223*^9}, {3.634582183831297*^9, 3.634582223916353*^9}, {
   3.6345824325384703`*^9, 3.6345824335184717`*^9}, {3.6345830527953424`*^9, 
   3.6345830813383827`*^9}, {3.634583148725477*^9, 3.634583253046625*^9}, {
   3.6345833314797354`*^9, 3.6345833438407526`*^9}, {3.6345833869658136`*^9, 
   3.6345834577339134`*^9}, {3.6345836223761454`*^9, 
   3.6345836314081583`*^9}, {3.6345836665322075`*^9, 3.634583670472213*^9}, {
   3.6345837311872983`*^9, 3.634583736027305*^9}, {3.6345838534094715`*^9, 
   3.634583955941617*^9}, {3.634584054351755*^9, 3.63458417140292*^9}, {
   3.6345843996622925`*^9, 3.6345844662103863`*^9}, {3.6345845311164775`*^9, 
   3.6345845957065687`*^9}, {3.6345894061478133`*^9, 
   3.6345894130662093`*^9}, {3.63458945294549*^9, 3.634589460128901*^9}, {
   3.634589661335409*^9, 3.634589726264123*^9}, {3.634589772695779*^9, 
   3.6345899027342167`*^9}, {3.634589947077753*^9, 3.6345899474537745`*^9}, {
   3.634589994005437*^9, 3.6345899942134485`*^9}, {3.6345900305485272`*^9, 
   3.6345900679646673`*^9}, {3.6345901048217754`*^9, 3.634590242705662*^9}, {
   3.634590340914279*^9, 3.634590349905793*^9}, {3.634598619095764*^9, 
   3.634598620111822*^9}, {3.6345988743493633`*^9, 3.6345989427162743`*^9}, {
   3.6345989793173676`*^9, 3.6345990359646072`*^9}, {3.6346469002752895`*^9, 
   3.6346469082907476`*^9}, 3.6346562942052097`*^9, {3.634656386117339*^9, 
   3.634656394399351*^9}, {3.6346564382984133`*^9, 3.6346564416584187`*^9}, {
   3.634668219548682*^9, 3.634668383068035*^9}, {3.634668427474575*^9, 
   3.6346684410673523`*^9}, 3.6346685340976734`*^9, {3.6346687332734594`*^9, 
   3.6346687391654673`*^9}, {3.634668822339585*^9, 3.6346689750078*^9}, {
   3.6346690410338936`*^9, 3.634669045025899*^9}, {3.6346702249308653`*^9, 
   3.6346702393446894`*^9}, {3.6346705804371986`*^9, 
   3.6346705921108665`*^9}, {3.634670656901572*^9, 3.6346706613978295`*^9}, {
   3.6346707041742764`*^9, 3.6346707117737107`*^9}, {3.634671004115432*^9, 
   3.6346710193403025`*^9}, {3.63467110163501*^9, 3.634671172066038*^9}, {
   3.634672982445586*^9, 3.6346730557977815`*^9}, {3.6346736469345922`*^9, 
   3.6346736487166944`*^9}, 3.6346742427216697`*^9, {3.634696656494664*^9, 
   3.634696666717249*^9}, {3.6346967081196165`*^9, 3.6346967344941254`*^9}, {
   3.6347364228051667`*^9, 3.6347365034377785`*^9}, {3.63473657461885*^9, 
   3.634736596148082*^9}, {3.634736943538951*^9, 3.63473696676928*^9}, {
   3.634737135568935*^9, 3.6347371360569625`*^9}, {3.634737172185029*^9, 
   3.634737258287954*^9}, {3.6347372988632746`*^9, 3.6347373157502403`*^9}, {
   3.634737364190011*^9, 3.6347373809659705`*^9}, {3.6347375036939907`*^9, 
   3.6347375615012965`*^9}, {3.6347375953962355`*^9, 
   3.6347376565897355`*^9}, {3.634737694125882*^9, 3.634737720205374*^9}, {
   3.6347377620457673`*^9, 3.634737762285781*^9}, {3.634750665505803*^9, 
   3.6347507084582596`*^9}, {3.6347507394650335`*^9, 3.634750756394001*^9}, {
   3.6347507901609325`*^9, 3.634750828125104*^9}, {3.6347508942888885`*^9, 
   3.6347509146410522`*^9}, {3.634750949712058*^9, 3.634751007903387*^9}, {
   3.6347511613181615`*^9, 3.6347511686775827`*^9}, {3.6347512293650537`*^9, 
   3.6347512455169773`*^9}, {3.634751398102705*^9, 3.6347514002938304`*^9}, {
   3.6347514443533506`*^9, 3.6347515746198015`*^9}, {3.634751610371846*^9, 
   3.634751627075802*^9}, {3.634760911457838*^9, 3.6347609235535297`*^9}, {
   3.634761071905015*^9, 3.634761078161373*^9}, {3.6347632423061547`*^9, 
   3.634763245952363*^9}, {3.63476333418541*^9, 3.6347633389996853`*^9}, {
   3.6348301618820157`*^9, 3.63483016720732*^9}, {3.6348308099140806`*^9, 
   3.6348308268580503`*^9}, {3.634832929591319*^9, 3.6348329358126755`*^9}, {
   3.63483573466076*^9, 3.6348357412451367`*^9}, {3.634836026861473*^9, 
   3.634836326721624*^9}, {3.634836742219389*^9, 3.6348367476907024`*^9}, {
   3.634836779954548*^9, 3.6348368523216867`*^9}, 3.634852613435171*^9, {
   3.6348526467710776`*^9, 3.634852652634413*^9}, 3.6348527091466455`*^9, {
   3.6348527518630886`*^9, 3.634852752798142*^9}, {3.6349213740081577`*^9, 
   3.6349213893741846`*^9}, {3.634921490633962*^9, 3.634921557152479*^9}, {
   3.634921735211192*^9, 3.6349217427616053`*^9}, {3.634921867327824*^9, 
   3.634921890930665*^9}, {3.635009853956784*^9, 3.6350099042118545`*^9}, {
   3.635018312548682*^9, 3.635018314859686*^9}, {3.6350183944487977`*^9, 
   3.635018395228799*^9}, {3.6350186898682137`*^9, 3.6350187604973125`*^9}, {
   3.635019115486812*^9, 3.635019118596816*^9}, {3.6350193336801186`*^9, 
   3.6350193475121384`*^9}, {3.635019446096277*^9, 3.6350195125923705`*^9}, {
   3.63501955510643*^9, 3.635019595720487*^9}, {3.63501966170758*^9, 
   3.635019664697584*^9}, {3.6350197367686853`*^9, 3.635019740448691*^9}, {
   3.635019799401785*^9, 3.6350198202738147`*^9}, {3.6350198640878763`*^9, 
   3.635019919314954*^9}, {3.6350199857450485`*^9, 3.635019991686057*^9}, {
   3.6350200561361475`*^9, 3.635020112753227*^9}, {3.6350202773164587`*^9, 
   3.635020280956464*^9}, {3.6350203279605303`*^9, 3.635020333550538*^9}, 
   3.6350203888866158`*^9, {3.6350204262106686`*^9, 3.635020432651677*^9}, {
   3.6350223041806364`*^9, 3.6350223070978413`*^9}, {3.6350225161538086`*^9, 
   3.6350225488982663`*^9}, {3.6350226032799616`*^9, 3.635022606961568*^9}, {
   3.6350226975821276`*^9, 3.6350227634142427`*^9}, {3.6350228075311203`*^9, 
   3.6350228411959796`*^9}, {3.6350228768108425`*^9, 
   3.6350228901020656`*^9}, {3.635022928462533*^9, 3.635022928540533*^9}, {
   3.6350367255117793`*^9, 3.635036729840027*^9}, {3.6351312230027266`*^9, 
   3.6351312415707884`*^9}, {3.635198154857592*^9, 3.6351981617929883`*^9}, {
   3.6351983312636814`*^9, 3.6351983355869293`*^9}, {3.635198747917513*^9, 
   3.635198751996746*^9}, {3.635199154145748*^9, 3.635199163001254*^9}, {
   3.635199592426816*^9, 3.635199600822296*^9}, {3.6351996554054184`*^9, 
   3.635199696084745*^9}, {3.635199823518034*^9, 3.6351998448062515`*^9}, {
   3.635200150067711*^9, 3.6352001570111084`*^9}, {3.6352001931151733`*^9, 
   3.6352001932191796`*^9}, {3.635200248328332*^9, 3.6352002557207546`*^9}, {
   3.635200361647813*^9, 3.635200401024065*^9}, {3.6352004430714703`*^9, 
   3.6352004519109755`*^9}, {3.6352005206229057`*^9, 3.635200526143222*^9}, {
   3.635200565349464*^9, 3.6352005871427107`*^9}, {3.6352007076926055`*^9, 
   3.6352007343331294`*^9}, {3.6352093686259828`*^9, 3.635209506890891*^9}, {
   3.635209801086718*^9, 3.6352098037188683`*^9}, {3.6352098559408555`*^9, 
   3.6352098801732416`*^9}, {3.635209918628441*^9, 3.635209918868455*^9}, {
   3.6352099737815957`*^9, 3.6352100567783427`*^9}, {3.635210200691574*^9, 
   3.635210291459766*^9}, {3.635210348762043*^9, 3.6352103652339854`*^9}, {
   3.635210425248418*^9, 3.635210437105096*^9}, {3.635210471986091*^9, 
   3.635210484936832*^9}, {3.6352105442442245`*^9, 3.635210548314457*^9}, {
   3.6352105856505923`*^9, 3.6352106131701665`*^9}, {3.635210853240898*^9, 
   3.6352108837456427`*^9}, {3.635211461332679*^9, 3.6352114876201825`*^9}, {
   3.6352116157795124`*^9, 3.635211628107218*^9}, {3.635211773858554*^9, 
   3.635211790114484*^9}, {3.6352118239554195`*^9, 3.6352118256825185`*^9}, {
   3.6352119215370007`*^9, 3.635211934823761*^9}, {3.6352121664930115`*^9, 
   3.6352121668210306`*^9}, {3.6352126340847564`*^9, 3.635212635268824*^9}, {
   3.6352163813220863`*^9, 3.635216386042356*^9}, {3.635216428873806*^9, 
   3.6352164412495136`*^9}, {3.6352591238368177`*^9, 3.635259172724614*^9}, {
   3.6352595357453775`*^9, 3.6352596663538485`*^9}, {3.6352597615202913`*^9, 
   3.635259762088324*^9}, {3.6352605027316866`*^9, 3.635260559456931*^9}, {
   3.635260599554224*^9, 3.635260676527627*^9}, {3.6352607200501165`*^9, 
   3.6352607730891495`*^9}, {3.635260991166623*^9, 3.6352609997101116`*^9}, {
   3.6352610455177317`*^9, 3.63526104828489*^9}, {3.6352612240029407`*^9, 
   3.6352612271231194`*^9}, {3.6353583726143246`*^9, 3.635358400115573*^9}, {
   3.6353584429338484`*^9, 3.635358464618286*^9}, {3.635374259016594*^9, 
   3.635374319543679*^9}, {3.6353743545577283`*^9, 3.6353744549648695`*^9}, {
   3.63537449080892*^9, 3.635374499319932*^9}, {3.6353775791632614`*^9, 
   3.6353776423913507`*^9}, {3.635377816330595*^9, 3.635377820581601*^9}, {
   3.6353779296237545`*^9, 3.6353779311337566`*^9}, 3.635378007200864*^9, {
   3.635475337558747*^9, 3.635475343419755*^9}, {3.635475374961799*^9, 
   3.6354754061358433`*^9}, {3.635475499244974*^9, 3.635475501784978*^9}, {
   3.6355118809741445`*^9, 3.635511912448189*^9}, 3.6355122178407183`*^9, {
   3.635512295090827*^9, 3.635512413765994*^9}, {3.635512488594099*^9, 
   3.635512658062337*^9}, {3.6355126928473864`*^9, 3.6355127097084103`*^9}, {
   3.6355127819985113`*^9, 3.6355127841485147`*^9}, {3.635512818501563*^9, 
   3.635512820622566*^9}, {3.6355128610916233`*^9, 3.635512876423645*^9}, {
   3.6355129547937555`*^9, 3.6355130229418507`*^9}, {3.63551308645094*^9, 
   3.6355130908609467`*^9}, {3.635513291783229*^9, 3.6355133007242413`*^9}, {
   3.635513352949315*^9, 3.6355133667313347`*^9}, {3.6355134290804224`*^9, 
   3.6355134291804223`*^9}, {3.6355135197815495`*^9, 3.6355135984216604`*^9}, 
   3.635513666382756*^9, {3.6355137620148907`*^9, 3.6355137685649*^9}, {
   3.6355138662090373`*^9, 3.635513885092064*^9}, {3.6355306763374186`*^9, 
   3.635530697210448*^9}, {3.635530996923869*^9, 3.635531006554883*^9}, {
   3.635545500732263*^9, 3.6355455016422644`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Showing", "Subsubsection",
 CellChangeTimes->{{3.634502418124713*^9, 3.6345024264557247`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"execute", "[", 
    RowBox[{"modelConstantsIn_", ",", " ", "runOptionsIn_"}], " ", "]"}], " ",
    ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
      "renderOptions", ",", " ", "runOptions", ",", " ", "modelConstants", 
       ",", " ", "targetConcentrations", ",", " ", "initialStates", ",", " ", 
       "runs", ",", " ", "annealStep", ",", " ", "extnStep"}], " ", "}"}], 
     ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"runOptions", " ", "=", " ", 
       RowBox[{"preempt", "[", 
        RowBox[{"runOptionsIn", ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"n", "\[Rule]", " ", "35"}], ",", " ", 
           RowBox[{"annealStepName", " ", "\[Rule]", " ", "\"\<kinetic\>\""}],
            ",", " ", 
           RowBox[{
           "extnStepName", " ", "\[Rule]", " ", "\"\<Michaelis-Menton\>\""}], 
           ",", " ", 
           RowBox[{"useExtendDuringAnneal", "\[Rule]", " ", "False"}]}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"modelConstants", " ", "=", " ", 
       RowBox[{"preempt", "[", 
        RowBox[{"modelConstantsIn", ",", " ", "constants"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"targetConcentrations", "  ", "=", 
       RowBox[{
        RowBox[{"Symbol", "[", "\"\<targetConcentrations\>\"", "]"}], " ", "//.",
         " ", "runOptions"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"initialStates", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"state0", "[", 
          RowBox[{"#", ",", " ", "modelConstants"}], "]"}], "&"}], " ", "/@", 
        " ", "targetConcentrations"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"annealStep", " ", "=", " ", 
       RowBox[{"Switch", "[", 
        RowBox[{
         RowBox[{"annealStepName", " ", "//.", " ", "runOptions"}], ",", " ", 
         "\"\<kinetic\>\"", ",", " ", "annealKinetic", ",", " ", 
         "\"\<equilibrium\>\"", ",", " ", "annealEquilibrium"}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"extnStep", " ", "=", " ", 
       RowBox[{"Switch", "[", 
        RowBox[{
         RowBox[{"extnStepName", " ", "//.", " ", "runOptions"}], ",", " ", 
         "\"\<Gevertz\>\"", ",", " ", "extensionStepGevertz", ",", " ", 
         "\"\<Michaelis-Menton\>\"", ",", " ", 
         "extensionStepMichaelisMention"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"runs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"run", "[", 
          RowBox[{
           RowBox[{"n", " ", "//.", " ", "runOptions"}], ",", " ", "#", ",", 
           " ", "annealStep", ",", " ", "extnStep", ",", " ", 
           "modelConstants", ",", " ", "runOptions"}], "]"}], " ", "&"}], " ",
         "/@", " ", "initialStates"}]}], ";", "\[IndentingNewLine]", 
      "runs"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6344909301969604`*^9, 3.634491148484268*^9}, {
   3.6344912135213604`*^9, 3.6344912383063955`*^9}, {3.6344913630885715`*^9, 
   3.634491385460603*^9}, {3.634491443836685*^9, 3.6344914463466887`*^9}, {
   3.6344914864757457`*^9, 3.634491529458806*^9}, {3.63449176642614*^9, 
   3.634491871549288*^9}, {3.6344919758234344`*^9, 3.63449198018344*^9}, {
   3.6344920294305096`*^9, 3.6344920297305098`*^9}, {3.634492092157598*^9, 
   3.634492208327762*^9}, {3.634492880284063*^9, 3.634492890186077*^9}, {
   3.634500329403759*^9, 3.6345003311437616`*^9}, {3.6345006957382755`*^9, 
   3.6345007492143507`*^9}, {3.6345008116814384`*^9, 
   3.6345008497864923`*^9}, {3.634500881927538*^9, 3.6345009102035775`*^9}, {
   3.634500962041651*^9, 3.634501024509739*^9}, {3.634501215398018*^9, 
   3.6345013220891676`*^9}, {3.6345022241134386`*^9, 3.634502250345475*^9}, {
   3.6345022837845235`*^9, 3.6345022840645237`*^9}, {3.634502361207633*^9, 
   3.634502389291672*^9}, {3.634573348864669*^9, 3.634573407617752*^9}, {
   3.634575929789876*^9, 3.634575931890879*^9}, {3.634576673647921*^9, 
   3.6345766758979244`*^9}, 3.6345989557550197`*^9, {3.6346468438960648`*^9, 
   3.6346468460161858`*^9}, 3.6346469210154753`*^9, {3.634653964731439*^9, 
   3.634653975243454*^9}, {3.6346543813835163`*^9, 3.634654450171613*^9}, {
   3.634656502680505*^9, 3.6346565046305075`*^9}, {3.634657257600568*^9, 
   3.63465745724885*^9}, {3.6346574958519163`*^9, 3.6346575392869787`*^9}, {
   3.634662185994934*^9, 3.6346621867593355`*^9}, 3.63466221770979*^9, {
   3.6346624354101725`*^9, 3.63466243954418*^9}, {3.634667765741726*^9, 
   3.6346677665977745`*^9}, {3.634668078818633*^9, 3.634668127187399*^9}, {
   3.634668160169286*^9, 3.6346681630254493`*^9}, {3.6346683972878485`*^9, 
   3.6346684044482574`*^9}, {3.6346690002018356`*^9, 3.634669000381836*^9}, {
   3.634669079967949*^9, 3.6346690802379494`*^9}, {3.6346693641946335`*^9, 
   3.6346693685628834`*^9}, {3.634671287477639*^9, 3.6346712882846856`*^9}, 
   3.6346722161837587`*^9, 3.6346723809331813`*^9, {3.634672739746704*^9, 
   3.634672766506235*^9}, {3.6346747982274427`*^9, 3.6346748008355923`*^9}, {
   3.6346944103461914`*^9, 3.6346944167145557`*^9}, {3.634694599632018*^9, 
   3.6346946201831937`*^9}, {3.634694794623171*^9, 3.634694823781839*^9}, {
   3.6346948694934535`*^9, 3.634694869765469*^9}, 3.634697082740044*^9, {
   3.6347365100951595`*^9, 3.6347365121842794`*^9}, {3.634737330346075*^9, 
   3.6347373306580935`*^9}, 3.634830833973457*^9, {3.634835152271449*^9, 
   3.634835308342376*^9}, 3.634835802995669*^9, {3.6348361180566893`*^9, 
   3.634836118744728*^9}, {3.634836148792447*^9, 3.6348361562628746`*^9}, {
   3.6348368739399233`*^9, 3.634836876045044*^9}, {3.634862832245653*^9, 
   3.6348628405401278`*^9}, {3.634863221521919*^9, 3.634863312379115*^9}, {
   3.634863902925893*^9, 3.634863971748829*^9}, {3.634867212878211*^9, 
   3.634867311214836*^9}, {3.634867351030113*^9, 3.6348673599286222`*^9}, {
   3.634867958207842*^9, 3.6348679961600122`*^9}, {3.6348680463198814`*^9, 
   3.63486816833286*^9}, 3.6348682243310633`*^9, {3.635009798302706*^9, 
   3.6350098466867733`*^9}, {3.635019100555791*^9, 3.6350191266878276`*^9}, {
   3.6350232914439707`*^9, 3.6350233245628285`*^9}, {3.635095199573304*^9, 
   3.635095221581563*^9}, {3.6350954188358455`*^9, 3.635095677829659*^9}, {
   3.6351029489035406`*^9, 3.635102950326622*^9}, {3.6351294164443974`*^9, 
   3.635129433716385*^9}, {3.635129474172699*^9, 3.635129516430116*^9}, {
   3.6352094312925673`*^9, 3.63520943431574*^9}, {3.6353655264112654`*^9, 
   3.6353657391016397`*^9}, {3.6353657693968925`*^9, 3.635365776432505*^9}, {
   3.6353658210641837`*^9, 3.635365873683076*^9}, {3.6353663649210424`*^9, 
   3.6353663705838523`*^9}, {3.6353745384049873`*^9, 
   3.6353745399049892`*^9}, {3.6353775199671783`*^9, 3.63537757055225*^9}, {
   3.6353784234134493`*^9, 3.6353784377654696`*^9}, 3.6353786019997*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"go", "[", "]"}], " ", ":=", " ", 
  RowBox[{"DynamicModule", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"annealExtensionName", " ", "=", " ", "\"\<separate\>\""}], ",",
       "annealStepName", ",", "annealTime", ",", "columnSpacer", ",", 
      "concFormat", ",", "concUnits", ",", "customGraphExpr1", ",", 
      "customGraphExpr2", ",", "customGraphExpr3", ",", "eng", ",", 
      "extensionTime", ",", "extnStepName", ",", "initLinear", ",", "initLog",
       ",", "kdFormat", ",", "kdUnits", ",", "kM", ",", "koff3Var", ",", 
      "koff4Var", ",", " ", "koffFormat", ",", "koffUnits", ",", "kon3Var", 
      ",", " ", "kon4Var", ",", " ", "konFormat", ",", "konUnits", ",", "kS", 
      ",", "linearControl", ",", "logControl", ",", "logEnzyme", ",", 
      "logkcat", ",", "logkoffh1", ",", "logkoffh2", ",", "logkoffu", ",", 
      " ", "logkoffd", ",", " ", "logkoffScale", ",", "logkonh1", ",", 
      "logkonh2", ",", "logkonScale", ",", "logkonu", ",", " ", "logkond", 
      ",", " ", "logP1", ",", "logP2", ",", "makeControlledSetterBar", ",", 
      "makeCustomGraphInput", ",", "manipulateLinearVar", ",", 
      "manipulateLinearVar2", ",", "manipulateLogVar", ",", 
      "manipulateLogVar2", ",", "modelConstants", ",", "n", ",", "noUnits", 
      ",", "polymeraseAnnealEfficiencyVar", ",", 
      RowBox[{"prevModelConstants", "=", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"prevRunOptions", "=", 
       RowBox[{"{", "}"}]}], ",", "renderOptions", ",", "result", ",", 
      "runOptions", ",", "runs", ",", "sameList", ",", "showExtraPlots", ",", 
      "targetConcentrations", ",", 
      RowBox[{"time", "=", "0"}], ",", "timeUnits", ",", "unitsSpacer", ",", 
      "useCustomGraphs", ",", "useEnzymeContention", ",", 
      "useExtendDuringAnneal", ",", "useLinearPlots"}], "\[IndentingNewLine]",
      "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"columnSpacer", " ", "=", " ", 
      RowBox[{"Spacer", "[", "1", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"unitsSpacer", " ", "=", " ", 
      RowBox[{"Spacer", "[", "2.5", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kM", "[", "]"}], " ", ":=", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"10", "^", "logkcat"}], " ", "+", " ", 
         RowBox[{
          RowBox[{"10", "^", "logkcat"}], " ", "*", " ", 
          RowBox[{"10", "^", "logkoffScale"}]}]}], ")"}], " ", "/", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"10", "^", "logkcat"}], " ", "*", " ", 
         RowBox[{"10", "^", "logkonScale"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kS", "[", "]"}], " ", ":=", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"10", "^", "logkcat"}], " ", "*", " ", 
         RowBox[{"10", "^", "logkoffScale"}]}], ")"}], " ", "/", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"10", "^", "logkcat"}], " ", "*", " ", 
         RowBox[{"10", "^", "logkonScale"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"eng", "[", "expr_", "]"}], " ", ":=", " ", 
      RowBox[{"EngineeringForm", "[", 
       RowBox[{
        RowBox[{"expr", " ", "//", " ", "N"}], ",", " ", "4"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"concUnits", "[", "expr_", "]"}], " ", ":=", " ", 
      RowBox[{"Row", "[", 
       RowBox[{"{", 
        RowBox[{"expr", ",", " ", "unitsSpacer", ",", " ", "\"\<M\>\""}], 
        "}"}], "]"}]}], ";", " ", 
     RowBox[{
      RowBox[{"concFormat", "[", "expr_", "]"}], " ", ":=", " ", 
      RowBox[{"concUnits", "[", 
       RowBox[{"eng", "[", "expr", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"koffUnits", "[", "expr_", "]"}], " ", ":=", " ", 
      RowBox[{"Row", "[", 
       RowBox[{"{", 
        RowBox[{"expr", ",", " ", "unitsSpacer", ",", 
         RowBox[{"DisplayForm", "[", 
          RowBox[{"SuperscriptBox", "[", 
           RowBox[{"s", ",", 
            RowBox[{"-", "1"}]}], "]"}], "]"}]}], "}"}], "]"}]}], ";", " ", 
     RowBox[{
      RowBox[{"koffFormat", "[", "expr_", "]"}], " ", ":=", " ", 
      RowBox[{"koffUnits", "[", 
       RowBox[{"eng", "[", "expr", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"konUnits", "[", "expr_", "]"}], " ", ":=", " ", 
      RowBox[{"Row", "[", 
       RowBox[{"{", 
        RowBox[{"expr", ",", "unitsSpacer", ",", " ", 
         RowBox[{"DisplayForm", "[", 
          RowBox[{"SuperscriptBox", "[", 
           RowBox[{"M", ",", 
            RowBox[{"-", "1"}]}], "]"}], "]"}], ",", 
         RowBox[{"DisplayForm", "[", 
          RowBox[{"SuperscriptBox", "[", 
           RowBox[{"s", ",", 
            RowBox[{"-", "1"}]}], "]"}], "]"}]}], "}"}], "]"}]}], ";", " ", 
     RowBox[{
      RowBox[{"konFormat", "[", "expr_", "]"}], " ", ":=", " ", 
      RowBox[{"konUnits", "[", 
       RowBox[{"eng", "[", "expr", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kdUnits", "[", "expr_", "]"}], " ", ":=", " ", 
      RowBox[{"concUnits", "[", "expr", "]"}]}], ";", " ", 
     RowBox[{
      RowBox[{"kdFormat", "[", "expr_", "]"}], " ", ":=", " ", 
      RowBox[{"kdUnits", "[", "expr", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"noUnits", "[", "expr_", "]"}], " ", ":=", " ", "expr"}], ";", 
     " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"timeUnits", "[", "expr_", "]"}], " ", ":=", " ", 
      RowBox[{"Row", "[", 
       RowBox[{"{", 
        RowBox[{"expr", ",", " ", "unitsSpacer", ",", "\"\<s\>\""}], "}"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"initLog", "[", "sym_", "]"}], " ", ":=", " ", 
      RowBox[{
       RowBox[{"Log", "[", 
        RowBox[{"10", ",", " ", 
         RowBox[{"sym", " ", "//.", " ", "constants"}]}], "]"}], " ", "//", 
       " ", "N"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"initLinear", "[", "sym_", "]"}], " ", ":=", " ", 
      RowBox[{
       RowBox[{"sym", " ", "//.", " ", "constants"}], " ", "//", " ", "N"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"logControl", "[", 
       RowBox[{
       "var_", ",", "c_", ",", " ", "low_", ",", " ", "high_", ",", " ", 
        RowBox[{"opts", ":", 
         RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
      RowBox[{"Control", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"var", ",", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"initLog", "[", "c", "]"}], "]"}], ",", " ", "\"\<\>\""}],
           "}"}], ",", " ", "low", ",", "high", ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"ImageSize", " ", "\[Rule]", " ", "Small"}], ",", " ", 
         RowBox[{"Appearance", " ", "\[Rule]", " ", 
          RowBox[{"{", "\"\<Closed\>\"", "}"}]}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"AppearanceElements", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"(*", 
            RowBox[{
            "\"\<PlayPauseButton\>\"", ",", "\"\<StepLeftButton\>\"", ",", 
             "\"\<StepRightButton\>\"", ",", " ", 
             "\"\<FasterSlowerButtons\>\"", ",", " ", 
             "\"\<DirectionButton\>\"", ","}], "*)"}], " ", 
           "\"\<InputField\>\"", "}"}]}], ",", " ", "opts"}], 
        "\[IndentingNewLine]", "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"linearControl", "[", 
       RowBox[{
       "var_", ",", "c_", ",", " ", "low_", ",", " ", "high_", ",", " ", 
        RowBox[{"opts", ":", " ", 
         RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
      RowBox[{"Control", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"var", ",", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"initLinear", "[", "c", "]"}], "]"}], ",", " ", 
           "\"\<\>\""}], "}"}], ",", " ", "low", ",", "high", ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"ImageSize", " ", "\[Rule]", " ", "Small"}], ",", " ", 
         RowBox[{"Appearance", " ", "\[Rule]", " ", 
          RowBox[{"{", "\"\<Closed\>\"", "}"}]}], ",", " ", 
         RowBox[{"AppearanceElements", "\[Rule]", 
          RowBox[{"{", " ", "\"\<InputField\>\"", "}"}]}], ",", " ", "opts"}],
         "\[IndentingNewLine]", "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"manipulateLogVar", "[", 
       RowBox[{
       "label_", ",", " ", "var_", ",", "c_", ",", " ", "low_", ",", " ", 
        "high_", ",", " ", 
        RowBox[{"format_:", " ", "eng"}], ",", " ", 
        RowBox[{"opts", ":", " ", 
         RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"Sequence", "[", "\[IndentingNewLine]", 
       RowBox[{"label", ",", " ", "\[IndentingNewLine]", 
        RowBox[{"logControl", "[", 
         RowBox[{
         "var", ",", " ", "c", ",", " ", "low", ",", " ", "high", ",", " ", 
          "opts"}], "]"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{"Column", "[", 
         RowBox[{"{", 
          RowBox[{"Dynamic", "[", 
           RowBox[{"format", "[", 
            RowBox[{"10", "^", "var"}], "]"}], "]"}], "}"}], "]"}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"manipulateLogVar2", "[", 
       RowBox[{
       "label_", ",", " ", "var_", ",", "c_", ",", " ", "low_", ",", " ", 
        "high_", ",", " ", "expr_", ",", " ", 
        RowBox[{"opts", ":", " ", 
         RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"Sequence", "[", "\[IndentingNewLine]", 
       RowBox[{"label", ",", " ", "\[IndentingNewLine]", 
        RowBox[{"logControl", "[", 
         RowBox[{
         "var", ",", " ", "c", ",", " ", "low", ",", " ", "high", ",", " ", 
          "opts"}], "]"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{"Column", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dynamic", "[", 
            RowBox[{"eng", "[", 
             RowBox[{"10", "^", "var"}], "]"}], "]"}], ",", " ", 
           RowBox[{"Dynamic", "[", "expr", "]"}]}], "}"}], "]"}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"manipulateLinearVar", "[", 
       RowBox[{
       "label_", ",", " ", "var_", ",", "c_", ",", " ", "low_", ",", " ", 
        "high_", ",", 
        RowBox[{"opts", ":", " ", 
         RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
      RowBox[{"Sequence", "[", 
       RowBox[{"label", ",", " ", 
        RowBox[{"linearControl", "[", 
         RowBox[{
         "var", ",", " ", "c", ",", " ", "low", ",", " ", "high", ",", " ", 
          "opts"}], "]"}], ",", " ", 
        RowBox[{"Dynamic", "[", "var", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"manipulateLinearVar2", "[", 
       RowBox[{
       "label_", ",", " ", "var_", ",", "c_", ",", " ", "low_", ",", " ", 
        "high_", ",", " ", "format_", ",", 
        RowBox[{"opts", ":", " ", 
         RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
      RowBox[{"Sequence", "[", 
       RowBox[{"label", ",", " ", 
        RowBox[{"linearControl", "[", 
         RowBox[{
         "var", ",", " ", "c", ",", " ", "low", ",", " ", "high", ",", " ", 
          "opts"}], "]"}], ",", " ", 
        RowBox[{"Dynamic", "[", 
         RowBox[{"format", "[", "var", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"makeControlledSetterBar", "[", 
       RowBox[{"name_", ",", " ", "values_", ",", " ", "expr_"}], "]"}], " ", 
      ":=", " ", 
      RowBox[{"Row", "[", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Spacer", "[", "7", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"SetterBar", "[", 
          RowBox[{
           RowBox[{"Dynamic", "[", "name", "]"}], ",", " ", "values", ",", 
           " ", 
           RowBox[{"Enabled", "\[Rule]", " ", 
            RowBox[{"Dynamic", "[", "expr", "]"}]}], ",", " ", 
           RowBox[{"BaseStyle", "\[Rule]", 
            RowBox[{"Dynamic", "[", 
             RowBox[{"If", "[", 
              RowBox[{"expr", ",", " ", "Black", ",", " ", "Gray"}], "]"}], 
             "]"}]}]}], "]"}]}], "\[IndentingNewLine]", "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"makeCustomGraphInput", "[", 
       RowBox[{"name_", ",", " ", "expr_", ",", " ", "init_"}], "]"}], " ", ":=",
       " ", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "input", "}"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"input", " ", "=", " ", 
          RowBox[{"Row", "[", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"InputField", "[", 
             RowBox[{
              RowBox[{"Dynamic", "[", "name", "]"}], ",", " ", 
              RowBox[{"Hold", "[", "Expression", "]"}], ",", " ", 
              "\[IndentingNewLine]", 
              RowBox[{"ImageSize", "\[Rule]", "105"}], ",", " ", 
              "\[IndentingNewLine]", 
              RowBox[{"Enabled", "\[Rule]", " ", 
               RowBox[{"Dynamic", "[", "expr", "]"}]}], ",", " ", 
              "\[IndentingNewLine]", 
              RowBox[{"BaseStyle", "\[Rule]", 
               RowBox[{"Dynamic", "[", 
                RowBox[{"If", "[", 
                 RowBox[{"expr", ",", " ", "Black", ",", " ", "Gray"}], "]"}],
                 "]"}]}]}], "]"}], "\[IndentingNewLine]", "}"}], "]"}]}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"name", " ", "=", " ", "init"}], ";", "\[IndentingNewLine]", 
         "input"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sameList", "[", 
       RowBox[{"a_List", ",", " ", "b_List"}], "]"}], "  ", ":=", " ", 
      RowBox[{
       RowBox[{"Equal", "[", 
        RowBox[{"a", ",", "b"}], "]"}], "===", "True"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"targetConcentrations", "  ", "=", " ", 
      RowBox[{"Reverse", "[", 
       RowBox[{"Sort", "[", 
        RowBox[{"NestList", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "*", "10"}], "&"}], ",", " ", 
          RowBox[{"10", "^", 
           RowBox[{"-", "14"}]}], ",", " ", "4"}], "]"}], "]"}], "]"}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"update", ";", "\[IndentingNewLine]", 
        RowBox[{"kon3Var", " ", "=", " ", 
         RowBox[{"If", "[", 
          RowBox[{"useEnzymeContention", ",", " ", "kon1", ",", " ", "0"}], 
          "]"}]}], ";", " ", 
        RowBox[{"kon4Var", " ", "=", " ", "kon3Var"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"koff3Var", " ", "=", " ", 
         RowBox[{"If", "[", 
          RowBox[{"useEnzymeContention", ",", " ", "koff1", ",", " ", "0"}], 
          "]"}]}], ";", 
        RowBox[{"koff4Var", " ", "=", " ", "koff3Var"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"modelConstants", " ", "=", " ", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"eStart", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", "logEnzyme"}]}], ",", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"p1Start", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", "logP1"}]}], ",", 
           RowBox[{"koffh1", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", "logkoffh1"}]}], ",", 
           RowBox[{"konh1", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", "logkonh1"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"p2Start", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", "logP2"}]}], ",", " ", 
           RowBox[{"koffh2", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", "logkoffh2"}]}], ",", " ", 
           RowBox[{"konh2", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", "logkonh2"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"koffu", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", "logkoffu"}]}], ",", " ", 
           RowBox[{"konu", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", "logkonu"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"koffd", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", "logkoffd"}]}], ",", " ", 
           RowBox[{"kond", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", " ", "logkond"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"konScale", "\[Rule]", " ", 
            RowBox[{"10", "^", " ", "logkonScale"}]}], ",", " ", 
           RowBox[{"koffScale", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", "logkoffScale"}]}], ",", " ", 
           RowBox[{"kcat", " ", "\[Rule]", " ", 
            RowBox[{"10", "^", "logkcat"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"kon3", " ", "\[Rule]", " ", "kon3Var"}], ",", " ", 
           RowBox[{"kon4", " ", "\[Rule]", " ", "kon4Var"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"koff3", " ", "\[Rule]", " ", "koff3Var"}], ",", 
           RowBox[{"koff4", " ", "\[Rule]", " ", "koff4Var"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\[Tau]ann", " ", "\[Rule]", " ", "annealTime"}], ",", " ", 
           RowBox[{"\[Tau]ext", " ", "\[Rule]", " ", "extensionTime"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
           "polymeraseAnnealEfficiency", " ", "\[Rule]", " ", 
            "polymeraseAnnealEfficiencyVar"}]}], "\[IndentingNewLine]", 
          "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"runOptions", " ", "=", " ", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<n\>\"", "]"}], " ", "\[Rule]", " ", 
            "n"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<annealStepName\>\"", "]"}], " ", 
            "\[Rule]", " ", "annealStepName"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<extnStepName\>\"", "]"}], " ", 
            "\[Rule]", " ", "extnStepName"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<useExtendDuringAnneal\>\"", "]"}], 
            " ", "\[Rule]", " ", "useExtendDuringAnneal"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<targetConcentrations\>\"", "]"}], " ",
             "\[Rule]", " ", "targetConcentrations"}]}], 
          "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"renderOptions", " ", "=", " ", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<showExtraPlots\>\"", "]"}], " ", 
            "\[Rule]", " ", "showExtraPlots"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<useLinearPlots\>\"", "]"}], " ", 
            "\[Rule]", " ", "useLinearPlots"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<showU\>\"", "]"}], " ", "\[Rule]", 
            " ", 
            RowBox[{"annealStepName", "\[Equal]", "\"\<kinetic\>\""}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<targetConcentrations\>\"", "]"}], " ",
             "\[Rule]", " ", "targetConcentrations"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<useCustomGraphs\>\"", "]"}], " ", 
            "\[Rule]", " ", "useCustomGraphs"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<customGraphExpr1\>\"", "]"}], " ", 
            "\[Rule]", " ", "customGraphExpr1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<customGraphExpr2\>\"", "]"}], " ", 
            "\[Rule]", " ", "customGraphExpr2"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Symbol", "[", "\"\<customGraphExpr3\>\"", "]"}], " ", 
            "\[Rule]", " ", "customGraphExpr3"}]}], "\[IndentingNewLine]", 
          "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"time", ",", " ", "result"}], "}"}], "=", 
         RowBox[{"Timing", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Not", "[", 
              RowBox[{"And", "[", 
               RowBox[{
                RowBox[{"sameList", "[", 
                 RowBox[{"prevModelConstants", ",", "modelConstants"}], "]"}],
                 ",", 
                RowBox[{"sameList", "[", 
                 RowBox[{"prevRunOptions", ",", "runOptions"}], "]"}]}], 
               "]"}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"runs", " ", "=", " ", 
               RowBox[{"execute", "[", 
                RowBox[{"modelConstants", ",", " ", "runOptions"}], "]"}]}], 
              ";", " ", "\[IndentingNewLine]", 
              RowBox[{"prevModelConstants", " ", "=", " ", "modelConstants"}],
               ";", " ", "\[IndentingNewLine]", 
              RowBox[{"prevRunOptions", " ", "=", " ", "runOptions"}]}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"plotRuns", "[", 
            RowBox[{
            "runs", ",", " ", "modelConstants", ",", " ", "renderOptions"}], 
            "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
        "\[IndentingNewLine]", "result"}], ",", " ", "\[IndentingNewLine]", 
       RowBox[{"Grid", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"\"\<cycle count\>\"", ",", " ", 
             RowBox[{"Control", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"n", ",", " ", "35", ",", " ", "\"\<\>\""}], "}"}], 
                ",", " ", 
                RowBox[{"Range", "[", 
                 RowBox[{"1", ",", "50"}], "]"}]}], "}"}], "]"}], ",", " ", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"columnSpacer", ","}], "*)"}], " ", 
             RowBox[{"Item", "[", 
              RowBox[{"\"\<show linear graphs\>\"", ",", " ", 
               RowBox[{"Alignment", "\[Rule]", "Right"}]}], "]"}], ",", " ", 
             "SpanFromLeft", ",", "\[IndentingNewLine]", 
             RowBox[{"Row", "[", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Control", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    "useLinearPlots", ",", " ", "False", ",", " ", 
                    "\"\<\>\""}], "}"}], ",", " ", 
                   RowBox[{"{", 
                    RowBox[{"True", ",", " ", "False"}], "}"}], ",", " ", 
                   RowBox[{"Enabled", " ", "\[Rule]", " ", "True"}]}], "}"}], 
                 "]"}], ",", " ", "\[IndentingNewLine]", 
                RowBox[{"Spacer", "[", "15", "]"}], ",", "  ", 
                "\"\<show extra graphs\>\"", ",", " ", 
                RowBox[{"Spacer", "[", "5", "]"}], ",", " ", 
                RowBox[{"Control", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    "showExtraPlots", ",", " ", "False", ",", " ", 
                    "\"\<\>\""}], "}"}], ",", " ", 
                   RowBox[{"{", 
                    RowBox[{"True", ",", " ", "False"}], "}"}], ",", " ", 
                   RowBox[{"Enabled", " ", "\[Rule]", " ", "True"}]}], "}"}], 
                 "]"}], ",", "\[IndentingNewLine]", 
                RowBox[{"Spacer", "[", "15", "]"}], ",", " ", 
                "\"\<show custom graphs\>\"", ",", " ", 
                RowBox[{"Spacer", "[", "5", "]"}], ",", " ", 
                RowBox[{"Control", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    "useCustomGraphs", ",", " ", "False", ",", " ", 
                    "\"\<\>\""}], "}"}], ",", " ", 
                   RowBox[{"{", 
                    RowBox[{"True", ",", " ", "False"}], "}"}], ",", " ", 
                   RowBox[{"Enabled", " ", "\[Rule]", " ", "True"}]}], "}"}], 
                 "]"}]}], "\[IndentingNewLine]", "}"}], "]"}], ",", 
             "\[IndentingNewLine]", "SpanFromLeft"}], "\[IndentingNewLine]", 
            "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
            "\"\<anneal algorithm\>\"", ",", " ", "\[IndentingNewLine]", 
             RowBox[{"makeControlledSetterBar", "[", 
              RowBox[{"annealStepName", ",", " ", 
               RowBox[{"{", 
                RowBox[{"\"\<kinetic\>\"", ",", " ", "\"\<equilibrium\>\""}], 
                "}"}], ",", " ", 
               RowBox[{
               "annealExtensionName", "\[Equal]", "\"\<separate\>\""}]}], 
              "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"columnSpacer", ","}], "*)"}], " ", 
             RowBox[{"Item", "[", 
              RowBox[{"\"\<poly' active in anneal\>\"", ",", " ", 
               RowBox[{"Alignment", "\[Rule]", "Right"}]}], "]"}], ",", " ", 
             "SpanFromLeft", ",", "\[IndentingNewLine]", 
             RowBox[{"Control", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                 "useExtendDuringAnneal", ",", " ", "False", ",", " ", 
                  "\"\<\>\""}], "}"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"True", ",", " ", "False"}], "}"}], ",", " ", 
                RowBox[{"Enabled", " ", "\[Rule]", " ", 
                 RowBox[{
                 "extnStepName", "\[Equal]", "\"\<Michaelis-Menton\>\""}]}]}],
                "}"}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
            "\"\<ext'n algorithm\>\"", ",", " ", "\[IndentingNewLine]", 
             RowBox[{"makeControlledSetterBar", "[", 
              RowBox[{"extnStepName", ",", " ", 
               RowBox[{"{", 
                RowBox[{
                "\"\<Michaelis-Menton\>\"", ",", " ", "\"\<Gevertz\>\""}], 
                "}"}], ",", " ", 
               RowBox[{
               "annealExtensionName", "\[Equal]", "\"\<separate\>\""}]}], 
              "]"}], ",", "\[IndentingNewLine]", "SpanFromLeft"}], 
            "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"manipulateLogVar", "[", 
              RowBox[{
              "\"\<primer p1 conc\>\"", ",", " ", "logP1", ",", " ", 
               "p1Start", ",", " ", 
               RowBox[{"-", "10"}], ",", " ", 
               RowBox[{"-", "3"}], ",", " ", "concFormat"}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"columnSpacer", ","}], "*)"}], 
             RowBox[{"manipulateLogVar", "[", 
              RowBox[{
              "\"\<koffh1\>\"", ",", " ", "logkoffh1", ",", " ", "koffh1", 
               ",", " ", 
               RowBox[{"-", "10"}], ",", " ", "0", ",", " ", "koffFormat"}], 
              "]"}], ",", " ", "\[IndentingNewLine]", "columnSpacer", ",", 
             RowBox[{"manipulateLogVar", "[", 
              RowBox[{
              "\"\<konh1\>\"", ",", " ", "logkonh1", ",", " ", "konh1", ",", 
               " ", "0", ",", " ", "20", ",", " ", "konFormat"}], "]"}], ",", 
             "\[IndentingNewLine]", "columnSpacer", ",", " ", 
             "\"\<koffh1/konh1\>\"", ",", " ", 
             RowBox[{"Dynamic", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"10", "^", "logkoffh1"}], " ", "/", " ", 
                RowBox[{"10", "^", "logkonh1"}]}], " ", "//", " ", 
               "kdFormat"}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"manipulateLogVar", "[", 
              RowBox[{
              "\"\<primer p2 conc\>\"", ",", " ", "logP2", ",", " ", 
               "p2Start", ",", " ", 
               RowBox[{"-", "10"}], ",", " ", 
               RowBox[{"-", "3"}], ",", " ", "concFormat"}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"columnSpacer", ","}], "*)"}], 
             RowBox[{"manipulateLogVar", "[", 
              RowBox[{
              "\"\<koffh2\>\"", ",", " ", "logkoffh2", ",", " ", "koffh2", 
               ",", " ", 
               RowBox[{"-", "10"}], ",", " ", "0", ",", " ", "koffFormat"}], 
              "]"}], ",", "\[IndentingNewLine]", "columnSpacer", ",", 
             RowBox[{"manipulateLogVar", "[", 
              RowBox[{
              "\"\<konh2\>\"", ",", " ", "logkonh2", ",", " ", "konh2", ",", 
               " ", "0", ",", "20", ",", " ", "konFormat"}], "]"}], ",", 
             "\[IndentingNewLine]", "columnSpacer", ",", " ", 
             "\"\<koffh2/konh2\>\"", ",", " ", 
             RowBox[{"Dynamic", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"10", "^", "logkoffh2"}], " ", "/", " ", 
                RowBox[{"10", "^", "logkonh2"}]}], " ", "//", " ", 
               "kdFormat"}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "\"\<t1-t2 duplex\>\"", ",", " ", "\"\<\>\"", ",", " ", 
             "\"\<\>\"", ",", " ", "\[IndentingNewLine]", 
             RowBox[{"manipulateLogVar", "[", 
              RowBox[{
              "\"\<koffu\>\"", ",", " ", "logkoffu", ",", " ", "koffu", ",", 
               " ", 
               RowBox[{"-", "60"}], ",", " ", 
               RowBox[{"-", "10"}], ",", " ", "koffFormat"}], "]"}], ",", 
             "\[IndentingNewLine]", "columnSpacer", ",", 
             RowBox[{"manipulateLogVar", "[", 
              RowBox[{
              "\"\<konu\>\"", ",", " ", "logkonu", ",", " ", "konu", ",", " ",
                "0", ",", "20", ",", " ", "konFormat"}], "]"}], ",", 
             "\[IndentingNewLine]", "columnSpacer", ",", " ", 
             "\"\<koffu/konu\>\"", ",", " ", 
             RowBox[{"Dynamic", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"10", "^", "logkoffu"}], " ", "/", " ", 
                RowBox[{"10", "^", "logkonu"}]}], " ", "//", " ", 
               "kdFormat"}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "\"\<p1-p2 dimer\>\"", ",", " ", "\"\<\>\"", ",", " ", "\"\<\>\"",
              ",", " ", "\[IndentingNewLine]", 
             RowBox[{"manipulateLogVar", "[", 
              RowBox[{
              "\"\<koffd\>\"", ",", " ", "logkoffd", ",", " ", "koffd", ",", 
               " ", 
               RowBox[{"-", "10"}], ",", " ", "5", ",", " ", "koffFormat"}], 
              "]"}], ",", "\[IndentingNewLine]", "columnSpacer", ",", 
             RowBox[{"manipulateLogVar", "[", 
              RowBox[{
              "\"\<kond\>\"", ",", " ", "logkond", ",", " ", "kond", ",", " ",
                "0", ",", "20", ",", " ", "konFormat"}], "]"}], ",", 
             "\[IndentingNewLine]", "columnSpacer", ",", " ", 
             "\"\<koffd/kond\>\"", ",", "  ", 
             RowBox[{"Dynamic", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"10", "^", "logkoffd"}], " ", "/", " ", 
                RowBox[{"10", "^", "logkond"}]}], " ", "//", " ", 
               "kdFormat"}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", "\[IndentingNewLine]", "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"manipulateLogVar", "[", 
              RowBox[{
              "\"\<polymerase conc\>\"", ",", " ", "logEnzyme", ",", " ", 
               "eStart", ",", " ", 
               RowBox[{"-", "10"}], ",", " ", 
               RowBox[{"-", "3"}], ",", " ", "concFormat"}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"columnSpacer", ","}], "*)"}], " ", 
             RowBox[{"manipulateLogVar2", "[", 
              RowBox[{
              "\"\<koff/kcat\>\"", ",", " ", "logkoffScale", ",", " ", 
               "koffScale", ",", " ", 
               RowBox[{"-", "10"}], ",", " ", "10", ",", " ", 
               RowBox[{"Item", "[", 
                RowBox[{
                 RowBox[{"koffFormat", "[", 
                  RowBox[{
                   RowBox[{"10", "^", "logkoffScale"}], " ", "*", " ", 
                   RowBox[{"10", "^", "logkcat"}]}], "]"}], ",", " ", 
                 RowBox[{"BaseStyle", "\[Rule]", "Gray"}]}], "]"}], ",", " ", 
               RowBox[{"Enabled", " ", "\[Rule]", " ", 
                RowBox[{
                "extnStepName", "\[Equal]", "\"\<Michaelis-Menton\>\""}]}]}], 
              "]"}], ",", "\[IndentingNewLine]", "columnSpacer", ",", " ", 
             RowBox[{"manipulateLogVar2", "[", 
              RowBox[{
              "\"\<kon/kcat\>\"", ",", " ", "logkonScale", ",", " ", 
               "konScale", ",", " ", "0", ",", " ", "20", ",", " ", 
               RowBox[{"Item", "[", 
                RowBox[{
                 RowBox[{"konFormat", "[", 
                  RowBox[{
                   RowBox[{"10", "^", "logkonScale"}], " ", "*", " ", 
                   RowBox[{"10", "^", "logkcat"}]}], "]"}], ",", " ", 
                 RowBox[{"BaseStyle", "\[Rule]", "Gray"}]}], "]"}], ",", "  ", 
               RowBox[{"Enabled", " ", "\[Rule]", " ", 
                RowBox[{
                "extnStepName", "\[Equal]", "\"\<Michaelis-Menton\>\""}]}]}], 
              "]"}], ",", "\[IndentingNewLine]", "columnSpacer", ",", " ", 
             "\"\<Ks=koff/kon\>\"", ",", " ", 
             RowBox[{"Dynamic", "[", 
              RowBox[{"kdFormat", "[", 
               RowBox[{"kS", "[", "]"}], "]"}], "]"}]}], 
            "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", " ", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Column", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"\"\<polymerase\>\"", ",", "\"\<contention\>\""}], 
                "}"}], ",", " ", 
               RowBox[{"Alignment", "\[Rule]", "Right"}]}], "]"}], "*)"}], 
            " ", 
            RowBox[{"\"\<polymerase contention\>\"", ",", " ", 
             RowBox[{"Control", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                 "useEnzymeContention", ",", " ", "False", ",", " ", 
                  "\"\<\>\""}], "}"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"True", ",", " ", "False"}], "}"}], ",", " ", 
                RowBox[{"Enabled", " ", "\[Rule]", " ", 
                 RowBox[{
                 "extnStepName", "\[Equal]", "\"\<Michaelis-Menton\>\""}]}]}],
                "}"}], "]"}], ",", " ", "\"\<\>\"", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"columnSpacer", ","}], "*)"}], " ", 
             RowBox[{"manipulateLogVar", "[", 
              RowBox[{
              "\"\<kcat\>\"", ",", " ", "logkcat", ",", " ", "kcat", ",", " ", 
               RowBox[{"-", "5"}], ",", " ", "5", ",", " ", "koffFormat"}], 
              "]"}], ",", "\[IndentingNewLine]", "columnSpacer", ",", " ", 
             "\"\<\>\"", ",", " ", "\"\<\>\"", ",", " ", "\"\<\>\"", ",", " ",
              "\[IndentingNewLine]", "columnSpacer", ",", "  ", 
             "\"\<Km=(kcat+koff)/kon\>\"", ",", " ", 
             RowBox[{"Dynamic", "[", 
              RowBox[{"kdFormat", "[", 
               RowBox[{"kM", "[", "]"}], "]"}], "]"}]}], 
            "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"manipulateLinearVar2", "[", 
              RowBox[{
              "\"\<anneal time\>\"", ",", " ", "annealTime", ",", " ", 
               "\[Tau]ann", ",", " ", "0", ",", " ", "120", ",", " ", 
               "timeUnits", ",", " ", 
               RowBox[{"Enabled", " ", "\[Rule]", " ", 
                RowBox[{"annealStepName", "\[Equal]", "\"\<kinetic\>\""}]}]}],
               "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"columnSpacer", ","}], "*)"}], " ", 
             RowBox[{"manipulateLinearVar2", "[", 
              RowBox[{
              "\"\<ext'n time\>\"", ",", " ", "extensionTime", ",", " ", 
               "\[Tau]ext", ",", " ", "0", ",", " ", "120", ",", " ", 
               "timeUnits"}], "]"}], ",", "\[IndentingNewLine]", 
             "columnSpacer", ",", " ", 
             RowBox[{"manipulateLinearVar", "[", 
              RowBox[{
               RowBox[{"Column", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                  "\"\<poly' anneal\>\"", ",", " ", "\"\<efficiency\>\""}], 
                  "}"}], ",", " ", 
                 RowBox[{"Alignment", "\[Rule]", "Right"}]}], "]"}], ",", " ",
                "polymeraseAnnealEfficiencyVar", ",", " ", 
               "polymeraseAnnealEfficiency", ",", " ", "0", ",", " ", "1", 
               ",", " ", 
               RowBox[{"Enabled", " ", "\[Rule]", 
                RowBox[{"Dynamic", "[", "useExtendDuringAnneal", "]"}]}]}], 
              "]"}], ",", "\[IndentingNewLine]", "columnSpacer", ",", "  ", 
             "\"\<kcat/Km\>\"", ",", " ", 
             RowBox[{"Dynamic", "[", 
              RowBox[{"konFormat", "[", 
               RowBox[{
                RowBox[{"10", "^", "logkcat"}], "/", 
                RowBox[{"kM", "[", "]"}]}], "]"}], "]"}]}], 
            "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Item", "[", 
              RowBox[{"\"\<1st custom graph\>\"", ",", " ", 
               RowBox[{"BaseStyle", "\[Rule]", 
                RowBox[{"Dynamic", "[", 
                 RowBox[{"If", "[", 
                  RowBox[{
                  "useCustomGraphs", ",", " ", "Black", ",", " ", "Gray"}], 
                  "]"}], "]"}]}]}], "]"}], ",", 
             RowBox[{"makeCustomGraphInput", "[", 
              RowBox[{
              "customGraphExpr1", ",", " ", "useCustomGraphs", ",", " ", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"h1", "+", "eh1"}], ")"}], " ", "/", " ", "t1T"}]}], 
              "]"}], ",", "\[IndentingNewLine]", "columnSpacer", ",", " ", 
             RowBox[{"Item", "[", 
              RowBox[{"\"\<2nd graph\>\"", ",", " ", 
               RowBox[{"BaseStyle", "\[Rule]", 
                RowBox[{"Dynamic", "[", 
                 RowBox[{"If", "[", 
                  RowBox[{
                  "useCustomGraphs", ",", " ", "Black", ",", " ", "Gray"}], 
                  "]"}], "]"}]}]}], "]"}], ",", " ", 
             RowBox[{"makeCustomGraphInput", "[", 
              RowBox[{
              "customGraphExpr2", ",", " ", "useCustomGraphs", ",", " ", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"u", "+", "eu"}], ")"}], "/", "t1T"}]}], "]"}], ",", 
             " ", "\"\<\>\"", ",", " ", "\[IndentingNewLine]", "columnSpacer",
              ",", " ", 
             RowBox[{"Item", "[", 
              RowBox[{"\"\<3rd graph\>\"", ",", " ", 
               RowBox[{"BaseStyle", "\[Rule]", 
                RowBox[{"Dynamic", "[", 
                 RowBox[{"If", "[", 
                  RowBox[{
                  "useCustomGraphs", ",", " ", "Black", ",", " ", "Gray"}], 
                  "]"}], "]"}]}]}], "]"}], ",", " ", 
             RowBox[{"makeCustomGraphInput", "[", 
              RowBox[{
              "customGraphExpr3", ",", " ", "useCustomGraphs", ",", " ", 
               RowBox[{"t1", "/", "t1T"}]}], "]"}]}], "\[IndentingNewLine]", 
            "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"\"\<\>\"", ",", " ", "\[IndentingNewLine]", 
             RowBox[{"Grid", "[", 
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Button", "[", 
                  RowBox[{"\"\<Update\>\"", ",", " ", 
                   RowBox[{"update", " ", "=", " ", 
                    RowBox[{"Not", "[", "update", "]"}]}], ",", " ", 
                   RowBox[{"ImageSize", "\[Rule]", "80"}]}], "]"}], ",", "  ",
                  "\[IndentingNewLine]", 
                 RowBox[{"Button", "[", 
                  RowBox[{"\"\<Reset\>\"", ",", " ", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"annealTime", " ", "=", " ", 
                    RowBox[{"initLinear", "[", "\[Tau]ann", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"extensionTime", " ", "=", " ", 
                    RowBox[{"initLinear", "[", "\[Tau]ext", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"polymeraseAnnealEfficiencyVar", " ", "=", " ", 
                    RowBox[{
                    "initLinear", "[", "polymeraseAnnealEfficiency", "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"logEnzyme", " ", "=", " ", 
                    RowBox[{"initLog", "[", "eStart", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logP1", " ", "=", 
                    RowBox[{"initLog", "[", "p1Start", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logP2", " ", "=", 
                    RowBox[{"initLog", "[", "p2Start", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logkoffScale", " ", "=", " ", 
                    RowBox[{"initLog", "[", "koffScale", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logkonScale", " ", "=", " ", 
                    RowBox[{"initLog", "[", "konScale", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logkcat", " ", "=", 
                    RowBox[{"initLog", "[", "kcat", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logkonu", " ", "=", " ", 
                    RowBox[{"initLog", "[", "konu", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logkoffu", " ", "=", " ", 
                    RowBox[{"initLog", "[", "koffu", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logkond", " ", "=", " ", 
                    RowBox[{"initLog", "[", "kond", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logkoffd", " ", "=", " ", 
                    RowBox[{"initLog", "[", "koffd", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logkoffh1", " ", "=", " ", 
                    RowBox[{"initLog", "[", "koffh1", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logkoffh2", " ", "=", " ", 
                    RowBox[{"initLog", "[", "koffh2", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logkonh1", " ", "=", " ", 
                    RowBox[{"initLog", "[", "konh1", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"logkonh2", " ", "=", " ", 
                    RowBox[{"initLog", "[", "konh2", "]"}]}]}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"ImageSize", "\[Rule]", "80"}]}], "]"}]}], "}"}], 
               "}"}], "]"}], ",", "\[IndentingNewLine]", "SpanFromLeft"}], 
            "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{",", 
            RowBox[{"{", " ", 
             RowBox[{"\"\<elapsed\>\"", ",", 
              RowBox[{"Dynamic", "[", "time", "]"}]}], "}"}]}], "*)"}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Alignment", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{
            "Right", ",", " ", "Left", ",", " ", "Left", ",", " ", "Right", 
             ",", " ", "Left", ",", " ", "Left", ",", " ", "Left", ",", " ", 
             "Right", ",", " ", "Left", ",", " ", "Left", ",", " ", "Left", 
             ",", " ", "Right", ",", " ", "Left"}], "}"}], "}"}]}]}], 
        "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"update", ",", " ", 
         RowBox[{"{", 
          RowBox[{"True", ",", " ", "False"}], "}"}], ",", " ", 
         RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"TrackedSymbols", "\[RuleDelayed]", 
        RowBox[{"{", 
         RowBox[{
         "update", ",", " ", "useLinearPlots", ",", " ", "showExtraPlots"}], 
         "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"Deployed", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
       RowBox[{"SynchronousUpdating", "\[Rule]", "False"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], " ", "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{
  3.6345926393607426`*^9, {3.634597599627454*^9, 3.634597616539421*^9}, {
   3.6345976832832384`*^9, 3.634597688362529*^9}, {3.6345977415565715`*^9, 
   3.6345977455548*^9}, {3.6345977849460535`*^9, 3.634597786034116*^9}, {
   3.634597829266588*^9, 3.6345979270811825`*^9}, {3.634598006352717*^9, 
   3.6345980131451054`*^9}, {3.63459805744864*^9, 3.6345980598407764`*^9}, {
   3.634598356918768*^9, 3.6345983670703487`*^9}, {3.634598498605872*^9, 
   3.634598577965411*^9}, {3.634646951776235*^9, 3.634646971343354*^9}, {
   3.634647048831786*^9, 3.634647061199494*^9}, {3.6346471054790263`*^9, 
   3.634647157711014*^9}, {3.6346529962145586`*^9, 3.6346530284086037`*^9}, {
   3.6346531926728354`*^9, 3.6346532067978563`*^9}, {3.634653238672901*^9, 
   3.634653254113922*^9}, {3.6346537486231346`*^9, 3.6346537895781927`*^9}, {
   3.634653836594259*^9, 3.634653889310333*^9}, {3.634654508940696*^9, 
   3.6346546039818296`*^9}, {3.6346546423458834`*^9, 3.6346546784199343`*^9}, 
   3.6346621108900013`*^9, 3.6346627963208065`*^9, {3.6346679831411605`*^9, 
   3.634667989646532*^9}, 3.634668471423088*^9, {3.634669826687087*^9, 
   3.6346698293502393`*^9}, 3.6346698920868273`*^9, {3.634669964989997*^9, 
   3.6346699661820655`*^9}, {3.634670088783078*^9, 3.63467017623608*^9}, 
   3.6346706695072937`*^9, 3.6346713260878477`*^9, {3.6346720724715385`*^9, 
   3.6346721379032807`*^9}, {3.634672168238016*^9, 3.6346721847329597`*^9}, {
   3.6346722380780106`*^9, 3.634672240254135*^9}, 3.6346723933328905`*^9, 
   3.6346945564665494`*^9, {3.6346949913004203`*^9, 3.634695000982974*^9}, {
   3.634696036846222*^9, 3.634696043185585*^9}, {3.6346961223821144`*^9, 
   3.634696124981263*^9}, {3.6347728353278437`*^9, 3.6347728608003016`*^9}, {
   3.6347730067586493`*^9, 3.6347730108788853`*^9}, {3.634773055273424*^9, 
   3.6347731865899353`*^9}, {3.634773245158285*^9, 3.6347732745019636`*^9}, {
   3.634773314061226*^9, 3.6347733353484435`*^9}, {3.6347735586122136`*^9, 
   3.634773560348313*^9}, {3.6347737068826942`*^9, 3.6347737148421497`*^9}, {
   3.6347755900934076`*^9, 3.6347758763157787`*^9}, {3.6347759300188503`*^9, 
   3.634775930202861*^9}, {3.6347759790106525`*^9, 3.634776195601041*^9}, {
   3.634776254560413*^9, 3.6347763766313953`*^9}, 3.6347765231267743`*^9, {
   3.6347766038403907`*^9, 3.634776711767564*^9}, 3.6347767790934143`*^9, {
   3.6348298117979918`*^9, 3.6348298683742275`*^9}, {3.6348298986859617`*^9, 
   3.6348299066294155`*^9}, {3.6348299610935307`*^9, 3.634830023941126*^9}, {
   3.6348303715630083`*^9, 3.6348307279213915`*^9}, {3.634830846424169*^9, 
   3.6348309655859847`*^9}, 3.6348325329496326`*^9, {3.6348325784922376`*^9, 
   3.6348327596666*^9}, {3.634832798321811*^9, 3.634832804906188*^9}, {
   3.6348328453945036`*^9, 3.634832870524941*^9}, {3.6348330143321667`*^9, 
   3.634833179248599*^9}, {3.6348332110714192`*^9, 3.6348333278740997`*^9}, {
   3.634833386830472*^9, 3.6348333952139516`*^9}, {3.634833601611757*^9, 
   3.6348336021167855`*^9}, {3.6348336710687294`*^9, 3.63483385482724*^9}, {
   3.634833910284412*^9, 3.6348340604109983`*^9}, {3.634834094121927*^9, 
   3.634834108722762*^9}, {3.6348341732894545`*^9, 3.63483420467325*^9}, {
   3.634834234904979*^9, 3.6348342506808815`*^9}, {3.634834291337207*^9, 
   3.6348342954174404`*^9}, {3.634834418919504*^9, 3.634834521407366*^9}, {
   3.6348346619424043`*^9, 3.634834689926005*^9}, {3.6348348234056396`*^9, 
   3.6348348456619124`*^9}, {3.6348349039002433`*^9, 
   3.6348349232443495`*^9}, {3.6348350167156963`*^9, 3.634835020154893*^9}, {
   3.6348351849223166`*^9, 3.6348351899866066`*^9}, 3.6348352565074115`*^9, {
   3.6348353155537887`*^9, 3.634835316889865*^9}, {3.634835389481017*^9, 
   3.6348354393888717`*^9}, {3.6348355081678057`*^9, 
   3.6348355332402396`*^9}, {3.634836942510845*^9, 3.6348369687553463`*^9}, {
   3.634837029086797*^9, 3.634837034223091*^9}, {3.6348370804297338`*^9, 
   3.63483711096148*^9}, {3.634837217484573*^9, 3.6348372438300796`*^9}, {
   3.6348373482040496`*^9, 3.634837359944721*^9}, {3.634837408859519*^9, 
   3.6348374093835487`*^9}, {3.6348374488368053`*^9, 
   3.6348374676648827`*^9}, {3.6348375744429893`*^9, 
   3.6348376460980883`*^9}, {3.634837821300109*^9, 3.6348378485406675`*^9}, {
   3.6348379015687003`*^9, 3.6348379140084114`*^9}, {3.6348379558798065`*^9, 
   3.634837994769031*^9}, {3.634838149317871*^9, 3.634838159854473*^9}, {
   3.634838197525628*^9, 3.634838222840076*^9}, {3.6348383376386423`*^9, 
   3.6348385071083355`*^9}, {3.634838669698635*^9, 3.6348388378582525`*^9}, {
   3.6348388750173783`*^9, 3.6348389191459026`*^9}, {3.6348389519127765`*^9, 
   3.634839136479333*^9}, {3.6348393340466332`*^9, 3.634839335011688*^9}, {
   3.6348396580721664`*^9, 3.6348396642925224`*^9}, {3.6348534139629583`*^9, 
   3.6348536692555604`*^9}, {3.634863092409534*^9, 3.6348632108173065`*^9}, {
   3.6348642745541487`*^9, 3.6348642748961687`*^9}, {3.6348645235583906`*^9, 
   3.634864627662345*^9}, {3.6348646707238083`*^9, 3.6348646959852533`*^9}, {
   3.634864796002974*^9, 3.6348648291128674`*^9}, {3.6348660150717006`*^9, 
   3.6348660175318413`*^9}, {3.6348660701048484`*^9, 
   3.6348661002325716`*^9}, {3.6348661312813473`*^9, 3.634866166432358*^9}, {
   3.6348661983681846`*^9, 3.634866358490343*^9}, {3.634866404257961*^9, 
   3.634866438193902*^9}, {3.6348664812723656`*^9, 3.6348664841115284`*^9}, {
   3.6348665214786654`*^9, 3.6348665596988516`*^9}, {3.6348667216731157`*^9, 
   3.634866769616858*^9}, {3.634866806236953*^9, 3.634866825668064*^9}, {
   3.634866950655213*^9, 3.6348670049023156`*^9}, {3.6348673680590873`*^9, 
   3.634867390578375*^9}, {3.634867535185646*^9, 3.634867568039525*^9}, {
   3.634867668856292*^9, 3.6348677018961816`*^9}, {3.6348677384482718`*^9, 
   3.6348677399913607`*^9}, {3.634868289555794*^9, 3.6348683206585727`*^9}, {
   3.6348683525183945`*^9, 3.634868427918708*^9}, {3.6349155803869667`*^9, 
   3.6349156114934216`*^9}, {3.634915666935919*^9, 3.6349156708515263`*^9}, {
   3.6349157476504607`*^9, 3.634915886147504*^9}, {3.6349159281427774`*^9, 
   3.6349159763312626`*^9}, {3.634916059682209*^9, 3.6349160789014425`*^9}, {
   3.6349161808164215`*^9, 3.6349162255417*^9}, {3.6349163003750315`*^9, 
   3.6349164079528203`*^9}, {3.634916471408532*^9, 3.63491647602614*^9}, {
   3.6349168689536314`*^9, 3.634916870888035*^9}, {3.6349169009024878`*^9, 
   3.6349169348793473`*^9}, {3.6349169771710215`*^9, 
   3.6349170425195365`*^9}, {3.63491711257926*^9, 3.6349171388341055`*^9}, {
   3.6349171940426025`*^9, 3.63491729505278*^9}, {3.634917328530439*^9, 
   3.634917387248942*^9}, {3.6349174255314093`*^9, 3.6349174615206723`*^9}, {
   3.634919480570819*^9, 3.634919495671645*^9}, {3.6349195373705187`*^9, 
   3.63491953835332*^9}, {3.6349195693505745`*^9, 3.63491963479109*^9}, {
   3.6349196690497503`*^9, 3.634919709453821*^9}, {3.634919742463479*^9, 
   3.63491974274428*^9}, {3.6349197883753595`*^9, 3.6349197887965603`*^9}, {
   3.6349222183752403`*^9, 3.6349222352388697`*^9}, {3.6349222719145346`*^9, 
   3.634922339415853*^9}, {3.6349223742663145`*^9, 3.6349223771835194`*^9}, {
   3.634922416199188*^9, 3.6349224616108675`*^9}, {3.6349224991445336`*^9, 
   3.6349225051973443`*^9}, {3.6349260563269825`*^9, 3.6349260642517962`*^9}, 
   3.634926537307027*^9, {3.6349265903783197`*^9, 3.6349266463668184`*^9}, {
   3.6349266876756907`*^9, 3.6349266920280986`*^9}, {3.634926776705047*^9, 
   3.6349267969070826`*^9}, {3.634926840509159*^9, 3.634926846140769*^9}, {
   3.6349268940494537`*^9, 3.634926896405058*^9}, {3.6349403353355765`*^9, 
   3.6349403664003534`*^9}, {3.634940886197084*^9, 3.6349409184289274`*^9}, {
   3.6349409945882835`*^9, 3.6349410860435143`*^9}, {3.634941122979627*^9, 
   3.634941152133295*^9}, {3.6349411943377085`*^9, 3.6349411975538926`*^9}, {
   3.6349412330419226`*^9, 3.6349412334429455`*^9}, {3.634941273921261*^9, 
   3.6349412834888077`*^9}, {3.6349418257178216`*^9, 
   3.6349418461569905`*^9}, {3.6349418887974296`*^9, 
   3.6349418918806057`*^9}, {3.6350062410939736`*^9, 3.63500627410802*^9}, {
   3.635006943408961*^9, 3.635006955489978*^9}, {3.6350069906340275`*^9, 
   3.635007057499121*^9}, {3.63500710652919*^9, 3.635007163934271*^9}, {
   3.635008459083315*^9, 3.63500863263356*^9}, 3.6350086884236393`*^9, {
   3.635008742160715*^9, 3.6350087830507727`*^9}, {3.635009293795286*^9, 
   3.635009325708331*^9}, {3.6350108731162157`*^9, 3.6350108828772297`*^9}, {
   3.6350132894744024`*^9, 3.6350133034874225`*^9}, {3.6350133556034956`*^9, 
   3.6350133717545185`*^9}, {3.635013537764752*^9, 3.635013538674753*^9}, {
   3.6350161787431035`*^9, 3.6350161807431064`*^9}, {3.6350162158161554`*^9, 
   3.635016237459186*^9}, {3.6350163020883417`*^9, 3.635016377905448*^9}, {
   3.635016437762532*^9, 3.635016439672535*^9}, {3.6350165002406206`*^9, 
   3.635016506311629*^9}, {3.6350165560646987`*^9, 3.635016622411792*^9}, {
   3.635016657084841*^9, 3.6350166991689005`*^9}, 3.6350167333029485`*^9, {
   3.6350167763670087`*^9, 3.635016792670032*^9}, {3.635016843634104*^9, 
   3.6350168535551176`*^9}, {3.6350169830292997`*^9, 3.635017030404366*^9}, {
   3.6350179525421753`*^9, 3.635017955122179*^9}, {3.6350181189594097`*^9, 
   3.6350181251494184`*^9}, {3.6350188817104836`*^9, 
   3.6350190168566732`*^9}, {3.635019146539856*^9, 3.63501915000086*^9}, {
   3.6350206543919897`*^9, 3.635020662063*^9}, {3.635020780682167*^9, 
   3.6350208196972227`*^9}, {3.635020887334317*^9, 3.635020991596464*^9}, {
   3.635021026710513*^9, 3.6350210270605135`*^9}, {3.635021064045566*^9, 
   3.6350210679355717`*^9}, {3.6350216090003347`*^9, 3.635021613341341*^9}, {
   3.6350230693307805`*^9, 3.6350230742135887`*^9}, {3.635027308144137*^9, 
   3.6350273083681498`*^9}, {3.6350276256652975`*^9, 3.635027625737302*^9}, {
   3.6350351730529833`*^9, 3.6350352114791813`*^9}, {3.6350352488043165`*^9, 
   3.635035256955783*^9}, {3.6350353095877934`*^9, 3.6350353550843954`*^9}, {
   3.635035431027739*^9, 3.63503544817872*^9}, {3.6350354791304903`*^9, 
   3.6350354804345646`*^9}, {3.635035543833191*^9, 3.635035601122468*^9}, {
   3.6350356847852535`*^9, 3.6350356998571153`*^9}, {3.6350357401614203`*^9, 
   3.6350357458017435`*^9}, {3.6350358541619406`*^9, 3.635035900055566*^9}, {
   3.6350359420559683`*^9, 3.635035942807011*^9}, {3.6350359847514105`*^9, 
   3.635036080044861*^9}, {3.6350361187640753`*^9, 3.635036137612153*^9}, {
   3.635036188971091*^9, 3.6350362021318436`*^9}, {3.6350362751810217`*^9, 
   3.635036325924924*^9}, {3.635093928958629*^9, 3.6350939570542364`*^9}, {
   3.6350940435621843`*^9, 3.6350940564419208`*^9}, {3.635094102284543*^9, 
   3.6350941374025517`*^9}, {3.635094183731201*^9, 3.6350941912526317`*^9}, {
   3.6350942777395782`*^9, 3.635094340500168*^9}, {3.6350943776412926`*^9, 
   3.6350944322804174`*^9}, {3.63509447288374*^9, 3.6350945858091993`*^9}, {
   3.6350947295754223`*^9, 3.6350948063838153`*^9}, {3.6350951841164203`*^9, 
   3.635095187412609*^9}, {3.6350953099156156`*^9, 3.635095387741067*^9}, {
   3.635095727833519*^9, 3.6350957640655913`*^9}, {3.6350961523818016`*^9, 
   3.6350961582851396`*^9}, {3.6350962111001606`*^9, 
   3.6350962400758176`*^9}, {3.6350962815071874`*^9, 
   3.6350963297329454`*^9}, {3.6350963801248283`*^9, 3.635096419027053*^9}, {
   3.6350964633165865`*^9, 3.6350964978755627`*^9}, {3.635096537090806*^9, 
   3.6350965724008255`*^9}, {3.635096633465318*^9, 3.635096655897601*^9}, {
   3.6350966962869115`*^9, 3.635096703591329*^9}, {3.63509706813518*^9, 
   3.6350970723754225`*^9}, {3.635098266190705*^9, 3.6350982756622467`*^9}, {
   3.6350983068880324`*^9, 3.6350983179186635`*^9}, {3.6350983655263863`*^9, 
   3.635098416316292*^9}, {3.63509846943633*^9, 3.6350985319239035`*^9}, {
   3.635098568095973*^9, 3.6350986470864906`*^9}, {3.635098686004717*^9, 
   3.635098701757618*^9}, {3.635098826242738*^9, 3.6350988318350577`*^9}, {
   3.6350988631578493`*^9, 3.635098923611307*^9}, {3.6350989675938225`*^9, 
   3.6350989971475134`*^9}, {3.6350990374878206`*^9, 3.63509903992796*^9}, {
   3.6350993355688696`*^9, 3.635099344192363*^9}, {3.6350995861021996`*^9, 
   3.635099593436619*^9}, {3.6350996399882812`*^9, 3.6350996491648064`*^9}, {
   3.63510284451257*^9, 3.635102850264899*^9}, {3.635131223903778*^9, 
   3.6351312428718634`*^9}, {3.6351982389234*^9, 3.6351982864461184`*^9}, {
   3.6352079699349823`*^9, 3.635208113470192*^9}, {3.635208146222065*^9, 
   3.635208158085744*^9}, 3.6352136451495857`*^9, {3.6353566363531675`*^9, 
   3.635356640159574*^9}, {3.6353566704860272`*^9, 3.6353567350233407`*^9}, {
   3.635357465179427*^9, 3.6353575496269755`*^9}, {3.6353583739871273`*^9, 
   3.6353584646338863`*^9}, {3.6353587854592505`*^9, 3.635358792916064*^9}, {
   3.635358862679386*^9, 3.63535897883819*^9}, {3.635359045887108*^9, 
   3.635359053265921*^9}, {3.6353590953547955`*^9, 3.6353592419960527`*^9}, {
   3.635359288313534*^9, 3.635359317875586*^9}, {3.6353593648316684`*^9, 
   3.6353593772648907`*^9}, {3.6353659836164694`*^9, 3.635366077344434*^9}, {
   3.6353745652380247`*^9, 3.635374608043085*^9}, {3.6353773612289553`*^9, 
   3.635377402903014*^9}, {3.6353774360970607`*^9, 3.6353775107551656`*^9}, {
   3.635378135078044*^9, 3.6353782673332295`*^9}, {3.635378342793336*^9, 
   3.6353783498643456`*^9}, {3.6353784669285107`*^9, 
   3.6353784756195226`*^9}, {3.6353787265778756`*^9, 
   3.6353787595319223`*^9}, {3.635379081579375*^9, 3.635379167698496*^9}, {
   3.635379218924568*^9, 3.635379297992679*^9}, {3.6353793419477406`*^9, 
   3.6353793711697817`*^9}, {3.6353794269758606`*^9, 3.635379460028907*^9}, {
   3.635379511414979*^9, 3.6353795544610395`*^9}, {3.6353796262891407`*^9, 
   3.6353796443811665`*^9}, {3.635379700377245*^9, 3.6353797076982555`*^9}, {
   3.635380301133622*^9, 3.635380320315649*^9}, {3.6353803694117184`*^9, 
   3.6353804165557847`*^9}, {3.6353804510898333`*^9, 
   3.6353804578408427`*^9}, {3.6353805077369127`*^9, 3.635380535250952*^9}, {
   3.6353806090780554`*^9, 3.635380715630205*^9}, {3.6353807612092695`*^9, 
   3.635380774472288*^9}, {3.6353808610154104`*^9, 3.6353808647564154`*^9}, {
   3.6353808958084593`*^9, 3.6353808983294625`*^9}, {3.6353809835585823`*^9, 
   3.6353812090849*^9}, {3.6353812548999643`*^9, 3.635381335308077*^9}, {
   3.6353813654301195`*^9, 3.635381467621263*^9}, {3.635381759027178*^9, 
   3.635381907554387*^9}, {3.6353819504914474`*^9, 3.6353819539814525`*^9}, {
   3.635382316761965*^9, 3.635382328643982*^9}, {3.6353823648780327`*^9, 
   3.6353825570313025`*^9}, {3.6353826208883924`*^9, 3.635382622578395*^9}, {
   3.6353826913854914`*^9, 3.6353827576325846`*^9}, {3.6353828001476445`*^9, 
   3.6353828519637175`*^9}, {3.635382894367777*^9, 3.6353829912599134`*^9}, {
   3.635383590102268*^9, 3.6353835915422707`*^9}, {3.635383658159364*^9, 
   3.635383773951527*^9}, {3.6353838049345703`*^9, 3.6353838332776103`*^9}, {
   3.635383894143696*^9, 3.6353839292577453`*^9}, {3.635384007284855*^9, 
   3.6353840116058607`*^9}, {3.635384090574972*^9, 3.6353841181680107`*^9}, {
   3.6353841651820765`*^9, 3.635384170162084*^9}, 3.6353842443301883`*^9, 
   3.635384627520727*^9, {3.6353846785157986`*^9, 3.635384693226819*^9}, {
   3.635384875138075*^9, 3.635384875188075*^9}, {3.6353928887011433`*^9, 
   3.635392956549239*^9}, {3.63539302874734*^9, 3.635393031148344*^9}, {
   3.6353931495235105`*^9, 3.6353931572645216`*^9}, {3.6353932626176696`*^9, 
   3.6353932841897*^9}, {3.6353935451836915`*^9, 3.6353935571133738`*^9}, {
   3.6353936211040125`*^9, 3.635393630480549*^9}, {3.635393671210868*^9, 
   3.635393696645318*^9}, {3.6353938355172467`*^9, 3.635393837937384*^9}, {
   3.63539392845154*^9, 3.635393948583687*^9}, {3.635394296106537*^9, 
   3.635394373439928*^9}, {3.6353944262499323`*^9, 3.635394445152012*^9}, 
   3.6353944916536646`*^9, {3.6353945578934245`*^9, 3.635394558211443*^9}, {
   3.635427214011295*^9, 3.635427270012374*^9}, {3.635427319674444*^9, 
   3.6354273921515465`*^9}, {3.6354275733498025`*^9, 3.635427580711813*^9}, {
   3.6354276163988633`*^9, 3.635427617649865*^9}, {3.6354279212572947`*^9, 
   3.6354279249582996`*^9}, {3.635427964137355*^9, 3.6354279748383703`*^9}, {
   3.635428018539432*^9, 3.6354280739065104`*^9}, {3.6354281080415583`*^9, 
   3.635428146439613*^9}, {3.635428228649729*^9, 3.635428337419883*^9}, {
   3.635428450488044*^9, 3.635428471854074*^9}, {3.635428558192196*^9, 
   3.635428574707219*^9}, {3.6354287571574774`*^9, 3.635428760257482*^9}, {
   3.6354288553576164`*^9, 3.6354288597486224`*^9}, {3.6354288902036653`*^9, 
   3.635428899766679*^9}, {3.6354289354817295`*^9, 3.6354289597677636`*^9}, {
   3.635429000505821*^9, 3.6354290010658216`*^9}, {3.635429065008912*^9, 
   3.635429114419982*^9}, {3.635429148982031*^9, 3.63542917673807*^9}, {
   3.6354292156181335`*^9, 3.6354292320311565`*^9}, {3.6354292626181993`*^9, 
   3.6354292649582033`*^9}, {3.6354293031912584`*^9, 3.635429307322264*^9}, {
   3.6354293409693117`*^9, 3.635429345900319*^9}, {3.635473937972274*^9, 
   3.6354739497842903`*^9}, {3.6354739960683556`*^9, 
   3.6354740066193705`*^9}, {3.6354750380913253`*^9, 3.635475068545368*^9}, {
   3.635475103890418*^9, 3.635475171208513*^9}, {3.6354752942436857`*^9, 
   3.6354752961636887`*^9}, {3.63547541817686*^9, 3.6354754227578664`*^9}, {
   3.6354755787930856`*^9, 3.635475579654087*^9}, {3.635475634369164*^9, 
   3.635475654422192*^9}, {3.6354756980872536`*^9, 3.6354757374523087`*^9}, {
   3.6354758104214125`*^9, 3.635475810691413*^9}, {3.6354758768855076`*^9, 
   3.635475990279667*^9}, {3.6354761413458796`*^9, 3.635476187803945*^9}, {
   3.6354785629782896`*^9, 3.6354785657592936`*^9}, {3.6354786030013466`*^9, 
   3.635478620383371*^9}, {3.6354786610104284`*^9, 3.635478665130434*^9}, {
   3.6354787082684946`*^9, 3.6354787180695086`*^9}, {3.635478768214579*^9, 
   3.635478771764584*^9}, {3.63547891813579*^9, 3.635478918985791*^9}, {
   3.6354790239069386`*^9, 3.635479066041998*^9}, {3.6355147547922883`*^9, 
   3.635514768744308*^9}, {3.635530219630776*^9, 3.635530230131791*^9}, {
   3.635530431570074*^9, 3.635530433370077*^9}, {3.635530528730211*^9, 
   3.635530534431219*^9}, {3.635531219220182*^9, 3.635531400719437*^9}, {
   3.6355314312424803`*^9, 3.6355314412844944`*^9}, {3.6355314727075386`*^9, 
   3.6355317201488867`*^9}, {3.635531763113947*^9, 3.635531801340001*^9}, {
   3.6355375729057283`*^9, 3.635537640113823*^9}, {3.63555214814607*^9, 
   3.635552166502096*^9}, {3.635785233655405*^9, 3.635785238976413*^9}}]
}, Closed]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Using the Model", "Section",
 CellChangeTimes->{{3.6348396881578875`*^9, 3.634839729397246*^9}, 
   3.635198268400086*^9, 3.635258774157818*^9}],

Cell[BoxData[
 RowBox[{"go", "[", "]"}]], "Input",
 CellChangeTimes->{{3.6350178140329804`*^9, 3.635017816822984*^9}, {
  3.6617993792788897`*^9, 3.661799380991827*^9}, {3.661959807331978*^9, 
  3.661959808519784*^9}}]
}, Open  ]]
},
WindowSize->{1262, 1548},
WindowMargins->{{Automatic, -7}, {Automatic, 0}},
CellContext->Notebook,
InputAliases->{"intt" -> RowBox[{"\[Integral]", 
     RowBox[{"\[SelectionPlaceholder]", 
       RowBox[{"\[DifferentialD]", "\[Placeholder]"}]}]}], "dintt" -> RowBox[{
     SubsuperscriptBox[
     "\[Integral]", "\[SelectionPlaceholder]", "\[Placeholder]"], 
     RowBox[{"\[Placeholder]", 
       RowBox[{"\[DifferentialD]", "\[Placeholder]"}]}]}], "sumt" -> RowBox[{
     UnderoverscriptBox["\[Sum]", 
      RowBox[{"\[SelectionPlaceholder]", "=", "\[Placeholder]"}], 
      "\[Placeholder]"], "\[Placeholder]"}], "prodt" -> RowBox[{
     UnderoverscriptBox["\[Product]", 
      RowBox[{"\[SelectionPlaceholder]", "=", "\[Placeholder]"}], 
      "\[Placeholder]"], "\[Placeholder]"}], "dt" -> RowBox[{
     SubscriptBox["\[PartialD]", "\[Placeholder]"], " ", 
     "\[SelectionPlaceholder]"}], "ket" -> 
  TemplateBox[{"\[Placeholder]"}, "Ket"], "bra" -> 
  TemplateBox[{"\[Placeholder]"}, "Bra"], "braket" -> 
  TemplateBox[{"\[Placeholder]", "\[Placeholder]"}, "BraKet"], "notation" -> 
  RowBox[{"Notation", "[", 
     RowBox[{
       TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
       "\[DoubleLongLeftRightArrow]", " ", 
       TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
  "notation>" -> RowBox[{"Notation", "[", 
     RowBox[{
       TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
       "\[DoubleLongRightArrow]", " ", 
       TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
  "notation<" -> RowBox[{"Notation", "[", 
     RowBox[{
       TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], " ", 
       "\[DoubleLongLeftArrow]", " ", 
       TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
  "symb" -> RowBox[{"Symbolize", "[", 
     TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], "]"}], 
  "infixnotation" -> RowBox[{"InfixNotation", "[", 
     RowBox[{
       TemplateBox[{"\[SelectionPlaceholder]"}, "NotationTemplateTag"], ",", 
       "\[Placeholder]"}], "]"}], "addia" -> RowBox[{"AddInputAlias", "[", 
     RowBox[{"\"\[SelectionPlaceholder]\"", "\[Rule]", 
       TemplateBox[{"\[Placeholder]"}, "NotationTemplateTag"]}], "]"}], 
  "pattwraper" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "NotationPatternTag"], 
  "madeboxeswraper" -> 
  TemplateBox[{"\[SelectionPlaceholder]"}, "NotationMadeBoxesTag"], "rxn" -> 
  OverscriptBox["\[RightArrow]", "\[Placeholder]"], "erxn" -> RowBox[{
     UnderoverscriptBox[
      TagBox[
       TagBox["\[Equilibrium]", DisplayForm], DisplayForm], "\[Placeholder]", 
      "\[Placeholder]"], " "}]},
Magnification:>0.95 Inherited,
FrontEndVersion->"10.3 for Microsoft Windows (64-bit) (October 9, 2015)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 92, 1, 67, "Section"],
Cell[CellGroupData[{
Cell[697, 27, 97, 1, 46, "Subsection"],
Cell[797, 30, 1670, 27, 54, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[2504, 62, 166, 2, 38, "Subsection"],
Cell[2673, 66, 2953, 75, 93, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[5663, 146, 97, 1, 38, "Subsection"],
Cell[5763, 149, 254, 5, 19, "Text"],
Cell[6020, 156, 1814, 42, 155, "Input"],
Cell[7837, 200, 6080, 173, 304, "Input"],
Cell[13920, 375, 2385, 63, 99, "Input"],
Cell[16308, 440, 699, 19, 29, "Input"],
Cell[17010, 461, 528, 14, 29, "Input"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[17587, 481, 107, 1, 67, "Section"],
Cell[17697, 484, 290, 7, 29, "Text"],
Cell[17990, 493, 75, 1, 30, "Input"],
Cell[CellGroupData[{
Cell[18090, 498, 264, 7, 46, "Subsection"],
Cell[18357, 507, 283, 5, 25, "Text"],
Cell[18643, 514, 2997, 63, 280, "Input"],
Cell[21643, 579, 1552, 35, 171, "Input"],
Cell[23198, 616, 1157, 29, 117, "Input"],
Cell[24358, 647, 20172, 515, 912, "Input"],
Cell[44533, 1164, 97, 1, 25, "Text"],
Cell[44633, 1167, 2243, 64, 153, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[46913, 1236, 122, 1, 38, "Subsection"],
Cell[47038, 1239, 145, 1, 29, "Text"],
Cell[47186, 1242, 3092, 85, 271, "Input"],
Cell[50281, 1329, 404, 7, 48, "Text"],
Cell[50688, 1338, 1498, 38, 111, "Input"],
Cell[52189, 1378, 194, 4, 29, "Text"],
Cell[52386, 1384, 1168, 29, 111, "Input"],
Cell[53557, 1415, 510, 8, 67, "Text"],
Cell[54070, 1425, 5729, 126, 464, "Input"],
Cell[59802, 1553, 249, 4, 29, "Text"],
Cell[60054, 1559, 1517, 42, 91, "Input"],
Cell[61574, 1603, 350, 6, 48, "Text"],
Cell[61927, 1611, 1190, 29, 91, "Input"],
Cell[63120, 1642, 255, 3, 29, "Text"],
Cell[63378, 1647, 1701, 32, 151, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[65128, 1685, 126, 1, 67, "Section"],
Cell[CellGroupData[{
Cell[65279, 1690, 150, 2, 46, "Subsection"],
Cell[65432, 1694, 136, 1, 29, "Text"],
Cell[65571, 1697, 737, 17, 71, "Input"],
Cell[66311, 1716, 122, 1, 29, "Text"],
Cell[66436, 1719, 2308, 56, 211, "Input"],
Cell[68747, 1777, 160, 2, 29, "Text"],
Cell[68910, 1781, 634, 17, 71, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[69581, 1803, 114, 1, 38, "Subsection"],
Cell[69698, 1806, 368, 8, 29, "Text"],
Cell[70069, 1816, 3995, 100, 191, "Input"],
Cell[74067, 1918, 250, 5, 29, "Text"],
Cell[74320, 1925, 3532, 94, 304, "Input"],
Cell[77855, 2021, 234, 5, 29, "Text"],
Cell[78092, 2028, 861, 22, 51, "Input"],
Cell[78956, 2052, 194, 6, 29, "Text"],
Cell[79153, 2060, 816, 23, 51, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[80006, 2088, 118, 1, 38, "Subsection"],
Cell[80127, 2091, 156, 3, 29, "Text"],
Cell[80286, 2096, 1517, 35, 111, "Input"],
Cell[81806, 2133, 244, 5, 29, "Text"],
Cell[82053, 2140, 9403, 193, 611, "Input"],
Cell[91459, 2335, 104, 1, 29, "Text"],
Cell[91566, 2338, 1191, 25, 111, "Input"],
Cell[92760, 2365, 123, 1, 29, "Text"],
Cell[92886, 2368, 2075, 53, 238, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[94998, 2426, 127, 1, 46, "Subsection"],
Cell[95128, 2429, 147, 2, 30, "Input"],
Cell[95278, 2433, 254, 5, 51, "Input"],
Cell[95535, 2440, 7184, 156, 631, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[102756, 2601, 273, 7, 38, "Subsection"],
Cell[103032, 2610, 314, 6, 29, "Text"],
Cell[103349, 2618, 5844, 143, 531, "Input"],
Cell[109196, 2763, 218, 6, 29, "Text"],
Cell[109417, 2771, 2888, 67, 291, "Input"],
Cell[112308, 2840, 126, 1, 29, "Text"],
Cell[112437, 2843, 79, 1, 30, "Input"],
Cell[112519, 2846, 285, 7, 29, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[112841, 2858, 95, 1, 38, "Subsection"],
Cell[112939, 2861, 2230, 53, 191, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[115218, 2920, 180, 2, 67, "Section"],
Cell[CellGroupData[{
Cell[115423, 2926, 99, 1, 46, "Subsection"],
Cell[115525, 2929, 13414, 254, 780, "Input"],
Cell[128942, 3185, 558, 10, 42, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[129537, 3200, 103, 1, 38, "Subsection"],
Cell[CellGroupData[{
Cell[129665, 3205, 171, 2, 38, "Subsubsection"],
Cell[129839, 3209, 2444, 49, 116, "Input"],
Cell[132286, 3260, 248, 5, 13, "Text"],
Cell[132537, 3267, 8524, 180, 218, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[141098, 3452, 117, 1, 32, "Subsubsection"],
Cell[141218, 3455, 498, 8, 33, "Text"],
Cell[141719, 3465, 2188, 56, 208, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[143944, 3526, 167, 2, 32, "Subsubsection"],
Cell[144114, 3530, 247, 3, 25, "Text"],
Cell[144364, 3535, 1914, 50, 214, "Input"],
Cell[146281, 3587, 196, 4, 25, "Text"],
Cell[146480, 3593, 574, 13, 45, "Input"],
Cell[147057, 3608, 359, 7, 25, "Text"],
Cell[147419, 3617, 17303, 360, 1056, "Input"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[164771, 3983, 105, 1, 46, "Subsection"],
Cell[CellGroupData[{
Cell[164901, 3988, 105, 1, 38, "Subsubsection"],
Cell[165009, 3991, 674, 11, 23, "Text"],
Cell[165686, 4004, 2996, 63, 71, "Input"],
Cell[168685, 4069, 142, 1, 13, "Text"],
Cell[168830, 4072, 3529, 71, 93, "Input"],
Cell[172362, 4145, 466, 7, 23, "Text"],
Cell[172831, 4154, 7341, 147, 262, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[180209, 4306, 196, 2, 32, "Subsubsection"],
Cell[180408, 4310, 282, 5, 25, "Text"],
Cell[180693, 4317, 366, 7, 25, "Text"],
Cell[181062, 4326, 171, 3, 26, "Input"],
Cell[181236, 4331, 11512, 224, 839, "Input"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[192797, 4561, 108, 1, 46, "Subsection"],
Cell[192908, 4564, 277, 5, 18, "Text"],
Cell[193188, 4571, 6267, 133, 285, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[199492, 4709, 242, 3, 38, "Subsection"],
Cell[199737, 4714, 12859, 230, 759, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[212633, 4949, 149, 2, 38, "Subsection"],
Cell[CellGroupData[{
Cell[212807, 4955, 103, 1, 19, "Subsubsection"],
Cell[212913, 4958, 458, 12, 11, "Input"],
Cell[213374, 4972, 45918, 948, 1732, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[259329, 5925, 100, 1, 16, "Subsubsection"],
Cell[259432, 5928, 6989, 119, 171, "Input"],
Cell[266424, 6049, 64700, 1205, 2554, "Input"]
}, Closed]]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[331185, 7261, 150, 2, 67, "Section"],
Cell[331338, 7265, 218, 4, 30, "Input"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
